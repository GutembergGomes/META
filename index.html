<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GGOMES-LOG | Sistema de Gestão Agrícola Avançado</title>
    
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- jsPDF para relatórios -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@3.5.28/dist/jspdf.plugin.autotable.js"></script>
    
    <!-- Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                colors: {
                    primary: {
                        50: '#f4f3ff',
                        100: '#e9e8ff',
                        200: '#d7d5ff',
                        300: '#bab8ff',
                        400: '#9a97ff',
                        500: '#7c7aff',
                        600: '#5D5CDE',
                        700: '#5a55cc',
                        800: '#4a46a8',
                        900: '#383670',
                        950: '#201f45',
                    }
                },
                fontFamily: {
                    'sans': ['Inter', 'system-ui', 'sans-serif'],
                },
                spacing: {
                    '128': '32rem',
                },
                animation: {
                    'fade-in': 'fadeIn 0.3s ease-out forwards',
                    'fade-out': 'fadeOut 0.3s ease-in forwards',
                    'slide-in': 'slideIn 0.3s ease-out forwards',
                    'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    'bounce-subtle': 'bounceSubtle 2s infinite',
                }
            }
        }
    }
    </script>
    
    <style>
        /* Animações customizadas */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-10px); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes bounceSubtle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-2px); }
        }
        
        /* Scrollbar personalizada */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .scrollbar-thin::-webkit-scrollbar { width: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: rgba(156, 163, 175, 0.5);
            border-radius: 3px;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background-color: rgba(156, 163, 175, 0.7);
        }
        
        /* Estados de carregamento */
        .loading { position: relative; }
        .loading::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: inherit;
            z-index: 10;
        }
        .dark .loading::after { background: rgba(0, 0, 0, 0.8); }
        
        /* Transições suaves */
        .transition-all-300 { transition: all 0.3s ease-in-out; }
        
        /* Efeitos hover personalizados */
        .hover-scale:hover { transform: scale(1.02); }
        
        /* Grid responsivo melhorado */
        .grid-responsive {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
        
        /* Cards com sombra suave */
        .card-shadow {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .dark .card-shadow {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px 0 rgba(0, 0, 0, 0.2);
        }
        
        /* Sidebar mobile melhorado */
        @media (max-width: 768px) {
            #app-container { position: relative; overflow-x: hidden; }
            #app-container aside {
                position: fixed;
                left: -100%;
                transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                height: 100vh;
                z-index: 50;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }
            #app-container.sidebar-open aside { left: 0; }
            #app-container.sidebar-open::before {
                content: '';
                position: fixed;
                top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 40;
            }
        }
        
        /* Estados de formulário */
        .form-error {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 1px #ef4444 !important;
        }
        .form-success {
            border-color: #10b981 !important;
            box-shadow: 0 0 0 1px #10b981 !important;
        }
        
        /* Indicadores de progresso */
        .progress-bar { 
            transition: width 0.5s ease-in-out; 
            position: relative;
        }
        
        .progress-bar-animated::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(45deg, rgba(255,255,255,.2) 25%, transparent 25%, transparent 50%, rgba(255,255,255,.2) 50%, rgba(255,255,255,.2) 75%, transparent 75%, transparent);
            background-size: 30px 30px;
            animation: progress-bar-stripes 1s linear infinite;
        }
        
        @keyframes progress-bar-stripes {
            0% { background-position: 30px 0; }
            100% { background-position: 0 0; }
        }
        
        /* Botões com estado loading */
        .btn-loading { position: relative; pointer-events: none; }
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px; height: 16px;
            margin: auto;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Tooltip personalizado */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #374151;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Alerta pulsante */
        .alert-pulse {
            animation: pulse 2s infinite;
        }
        
        /* Status indicators */
        .status-indicator {
            position: relative;
        }
        
        .status-indicator::before {
            content: '';
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #ef4444;
        }
        
        .status-indicator.status-success::before {
            background-color: #10b981;
        }
        
        .status-indicator.status-warning::before {
            background-color: #f59e0b;
        }
        
        /* Tabelas responsivas aprimoradas */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        @media (max-width: 640px) {
            .table-container table {
                font-size: 0.75rem;
            }
            
            .table-container th,
            .table-container td {
                padding: 0.5rem 0.25rem;
            }
        }

        /* Gradientes personalizados para dashboard */
        .gradient-bg-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .gradient-bg-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .gradient-bg-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        /* Efeitos de brilho */
        .glow-effect {
            box-shadow: 0 0 20px rgba(93, 92, 222, 0.3);
        }
        
        /* Animação de contador */
        .counter-animation {
            animation: countUp 1.5s ease-out forwards;
        }
        
        @keyframes countUp {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <!-- Container principal da aplicação -->
    <div id="app-container" class="flex h-screen overflow-hidden">
        <!-- Menu lateral (Sidebar) -->
        <aside class="w-64 hidden md:block bg-white dark:bg-gray-800 card-shadow z-10 flex-shrink-0">
            <div class="h-full flex flex-col">
                <!-- Logo e título -->
                <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-center">
                    <div class="text-center">
                        <h1 class="text-xl font-bold text-primary-600 dark:text-primary-400">GGOMES-LOG</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Gestão Agrícola</p>
                    </div>
                </div>
                
                <!-- Informações do usuário -->
                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center">
                        <div class="h-10 w-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center">
                            <i class="fas fa-user text-primary-600 dark:text-primary-400"></i>
                        </div>
                        <div class="ml-3">
                            <p id="sidebar-user-name" class="font-medium text-gray-800 dark:text-white">Administrador</p>
                            <p id="sidebar-user-role" class="text-xs text-gray-500 dark:text-gray-400">Administrador</p>
                        </div>
                    </div>
                </div>
                
                <!-- Links de navegação -->
                <div class="py-4 flex-1 overflow-y-auto scrollbar-thin">
                    <nav class="px-2 space-y-1">
                        <div class="px-3 py-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Dashboard
                        </div>
                        
                        <a href="#dashboard" class="sidebar-link active bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300 flex items-center px-4 py-2 rounded-md font-medium mb-1 transition-all-300">
                            <i class="fas fa-chart-pie mr-3 text-lg"></i>
                            <span>Dashboard</span>
                        </a>
                        
                        <div class="px-3 py-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Produção
                        </div>
                        
                        <a href="#liberacoes" class="sidebar-link flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md font-medium mb-1 transition-all-300">
                            <i class="fas fa-tasks mr-3 text-lg"></i>
                            <span>Liberações</span>
                        </a>

                        <a href="#metas" class="sidebar-link flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md font-medium mb-1 transition-all-300">
                            <i class="fas fa-bullseye mr-3 text-lg"></i>
                            <span>Metas de Colheita</span>
                        </a>
                        
                        <div class="px-3 py-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Sistema
                        </div>
                        
                        <a href="#configuracoes" class="sidebar-link flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md font-medium mb-1 transition-all-300">
                            <i class="fas fa-cog mr-3 text-lg"></i>
                            <span>Configurações</span>
                        </a>
                    </nav>
                </div>
                
                <!-- Rodapé do sidebar -->
                <div class="p-4 border-t border-gray-200 dark:border-gray-700 text-center">
                    <p class="text-xs text-gray-500 dark:text-gray-400">GGOMES-LOG &copy; 2025</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Versão 2.1 Avançada</p>
                </div>
            </div>
        </aside>
        
        <!-- Conteúdo principal -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Barra superior (Header) -->
            <header class="bg-white dark:bg-gray-800 card-shadow z-10">
                <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                    <!-- Toggle do menu lateral (mobile) -->
                    <button id="mobile-menu-toggle" class="md:hidden p-2 rounded-md text-gray-500 hover:text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:bg-gray-700 transition-all-300">
                        <i class="fas fa-bars"></i>
                    </button>
                    
                    <!-- Título da página -->
                    <div class="flex-1 text-center md:text-left">
                        <h2 id="page-title" class="text-lg font-semibold text-gray-800 dark:text-white">Dashboard</h2>
                        <p id="page-subtitle" class="text-sm text-gray-500 dark:text-gray-400 hidden md:block">Visão geral do sistema e indicadores principais</p>
                    </div>
                    
                    <!-- Ações e perfil do usuário -->
                    <div class="flex items-center space-x-3">
                        <!-- Busca rápida -->
                        <div class="hidden lg:block relative">
                            <input type="text" id="search-global" placeholder="Buscar..." class="pl-8 pr-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all-300">
                            <i class="fas fa-search absolute left-2.5 top-2 text-gray-400 text-xs"></i>
                        </div>
                        
                        <!-- Notificações -->
                        <button id="btn-notifications" class="relative p-2 rounded-md text-gray-500 hover:text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:bg-gray-700 transition-all-300">
                            <i class="fas fa-bell"></i>
                            <span id="notification-badge" class="absolute -top-1 -right-1 h-4 w-4 bg-red-500 text-white rounded-full text-xs flex items-center justify-center hidden">0</span>
                        </button>
                        
                        <!-- Data atual -->
                        <div class="hidden sm:block mr-2">
                            <span id="current-date" class="text-sm text-gray-600 dark:text-gray-400">--/--/----</span>
                        </div>
                        
                        <!-- Toggle de tema claro/escuro -->
                        <button id="toggle-theme" class="p-2 rounded-md text-gray-500 hover:text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:bg-gray-700 transition-all-300">
                            <i class="fas fa-moon dark:hidden"></i>
                            <i class="fas fa-sun hidden dark:inline-block"></i>
                        </button>
                        
                        <!-- Perfil do usuário -->
                        <div class="flex items-center">
                            <div class="mr-2 text-right hidden sm:block">
                                <div id="user-name" class="text-sm font-medium text-gray-800 dark:text-white">Administrador</div>
                                <div class="flex items-center">
                                    <span id="user-role-badge" class="px-2 py-1 rounded text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300">Admin</span>
                                </div>
                            </div>
                            <div class="h-8 w-8 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center">
                                <i class="fas fa-user text-primary-600 dark:text-primary-400"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Conteúdo principal -->
            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 dark:bg-gray-900 p-4">
                <!-- Toast container para mensagens -->
                <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-4"></div>
                
                <!-- Loading overlay global -->
                <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 flex items-center space-x-3">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"></div>
                        <span class="text-gray-700 dark:text-gray-300">Carregando...</span>
                    </div>
                </div>
                
                <!-- Conteúdo de Dashboard MELHORADO -->
                <div id="content-dashboard" class="content">
                    <div class="mb-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">Dashboard Executivo</h2>
                                <p class="text-gray-600 dark:text-gray-400">Visão estratégica em tempo real - Indicadores chave de performance</p>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="text-right">
                                    <div id="dash-status-geral" class="text-sm font-medium text-green-600 dark:text-green-400">Sistema Operacional</div>
                                    <div id="dash-ultima-atualizacao" class="text-xs text-gray-500 dark:text-gray-400">Atualizado agora</div>
                                </div>
                                <button id="btn-refresh-dashboard" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all-300">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Alertas Críticos -->
                    <div id="dashboard-alertas" class="mb-6 hidden">
                        <div class="bg-gradient-to-r from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
                            <div class="flex items-center mb-3">
                                <i class="fas fa-exclamation-triangle text-red-500 text-lg mr-2"></i>
                                <h3 class="text-lg font-semibold text-red-800 dark:text-red-300">Alertas Críticos</h3>
                            </div>
                            <div id="lista-alertas-criticos" class="space-y-2">
                                <!-- Preenchido dinamicamente -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- KPIs Principais -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-4 mb-8">
                        <!-- Total Colhido -->
                        <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/30 dark:to-emerald-900/30 rounded-lg card-shadow p-6 hover-scale transition-all-300 border border-green-200 dark:border-green-800">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 rounded-full bg-green-100 dark:bg-green-900">
                                    <i class="fas fa-weight-hanging text-green-600 dark:text-green-400 text-xl"></i>
                                </div>
                                <div id="dash-colhido-trend" class="text-green-600 dark:text-green-400 text-sm">
                                    <i class="fas fa-arrow-up mr-1"></i>+5.2%
                                </div>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-green-700 dark:text-green-300 mb-1">Total Colhido (30d)</p>
                                <p id="dash-total-colhido" class="text-2xl font-bold text-green-800 dark:text-green-200">0 T</p>
                                <p id="dash-colhido-meta" class="text-xs text-green-600 dark:text-green-400 mt-1">Meta: 0 T</p>
                            </div>
                        </div>
                        
                        <!-- Eficiência Geral -->
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-lg card-shadow p-6 hover-scale transition-all-300 border border-blue-200 dark:border-blue-800">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 rounded-full bg-blue-100 dark:bg-blue-900">
                                    <i class="fas fa-tachometer-alt text-blue-600 dark:text-blue-400 text-xl"></i>
                                </div>
                                <div id="dash-eficiencia-trend" class="text-blue-600 dark:text-blue-400 text-sm">
                                    <i class="fas fa-arrow-up mr-1"></i>+2.1%
                                </div>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-blue-700 dark:text-blue-300 mb-1">Eficiência Geral</p>
                                <p id="dash-eficiencia-geral" class="text-2xl font-bold text-blue-800 dark:text-blue-200">92%</p>
                                <p class="text-xs text-blue-600 dark:text-blue-400 mt-1">Acima da meta de 85%</p>
                            </div>
                        </div>
                        
                        <!-- Frentes Operacionais -->
                        <div class="bg-gradient-to-br from-purple-50 to-violet-50 dark:from-purple-900/30 dark:to-violet-900/30 rounded-lg card-shadow p-6 hover-scale transition-all-300 border border-purple-200 dark:border-purple-800">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 rounded-full bg-purple-100 dark:bg-purple-900">
                                    <i class="fas fa-map-marker-alt text-purple-600 dark:text-purple-400 text-xl"></i>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <div id="dash-frentes-status" class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-xs text-purple-600 dark:text-purple-400">Online</span>
                                </div>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-purple-700 dark:text-purple-300 mb-1">Frentes Ativas</p>
                                <p id="dash-frentes-ativas" class="text-2xl font-bold text-purple-800 dark:text-purple-200">0/0</p>
                                <p id="dash-frentes-info" class="text-xs text-purple-600 dark:text-purple-400 mt-1">Próprias + Terceiras</p>
                            </div>
                        </div>
                        
                        <!-- Metas Atingidas -->
                        <div class="bg-gradient-to-br from-orange-50 to-amber-50 dark:from-orange-900/30 dark:to-amber-900/30 rounded-lg card-shadow p-6 hover-scale transition-all-300 border border-orange-200 dark:border-orange-800">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 rounded-full bg-orange-100 dark:bg-orange-900">
                                    <i class="fas fa-bullseye text-orange-600 dark:text-orange-400 text-xl"></i>
                                </div>
                                <div id="dash-metas-progresso" class="text-orange-600 dark:text-orange-400 text-sm">
                                    87%
                                </div>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-orange-700 dark:text-orange-300 mb-1">Metas Atingidas</p>
                                <p id="dash-metas-atingidas" class="text-2xl font-bold text-orange-800 dark:text-orange-200">0/0</p>
                                <p class="text-xs text-orange-600 dark:text-orange-400 mt-1">Este mês</p>
                            </div>
                        </div>
                        
                        <!-- Média Diária -->
                        <div class="bg-gradient-to-br from-teal-50 to-cyan-50 dark:from-teal-900/30 dark:to-cyan-900/30 rounded-lg card-shadow p-6 hover-scale transition-all-300 border border-teal-200 dark:border-teal-800">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 rounded-full bg-teal-100 dark:bg-teal-900">
                                    <i class="fas fa-calendar-day text-teal-600 dark:text-teal-400 text-xl"></i>
                                </div>
                                <div id="dash-media-trend" class="text-teal-600 dark:text-teal-400 text-sm">
                                    7 dias
                                </div>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-teal-700 dark:text-teal-300 mb-1">Média Diária</p>
                                <p id="dash-media-diaria" class="text-2xl font-bold text-teal-800 dark:text-teal-200">0 T/d</p>
                                <p id="dash-meta-diaria" class="text-xs text-teal-600 dark:text-teal-400 mt-1">Meta: 0 T/d</p>
                            </div>
                        </div>
                        
                        <!-- Liberações Ativas -->
                        <div class="bg-gradient-to-br from-rose-50 to-pink-50 dark:from-rose-900/30 dark:to-pink-900/30 rounded-lg card-shadow p-6 hover-scale transition-all-300 border border-rose-200 dark:border-rose-800">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 rounded-full bg-rose-100 dark:bg-rose-900">
                                    <i class="fas fa-tasks text-rose-600 dark:text-rose-400 text-xl"></i>
                                </div>
                                <div id="dash-liberacoes-status" class="text-rose-600 dark:text-rose-400 text-sm">
                                    Ativo
                                </div>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-rose-700 dark:text-rose-300 mb-1">Liberações</p>
                                <p id="dash-total-liberacoes" class="text-2xl font-bold text-rose-800 dark:text-rose-200">0</p>
                                <p id="dash-liberacoes-info" class="text-xs text-rose-600 dark:text-rose-400 mt-1">Abertas + Em Andamento</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráficos Principais -->
                    <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8">
                        <!-- Evolução da Colheita -->
                        <div class="xl:col-span-2 bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Evolução da Colheita</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Últimos 30 dias - Comparativo com metas</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button id="btn-chart-period" class="text-xs px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300 rounded-full">30d</button>
                                    <button class="text-xs px-3 py-1 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full">7d</button>
                                </div>
                            </div>
                            <div class="h-80">
                                <canvas id="chart-evolucao-colheita"></canvas>
                            </div>
                        </div>
                        
                        <!-- Performance das Frentes -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Performance das Frentes</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">% Meta atingida</p>
                                </div>
                                <i class="fas fa-chart-bar text-gray-400"></i>
                            </div>
                            <div class="h-80">
                                <canvas id="chart-performance-frentes"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráficos Secundários -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <!-- Status das Liberações -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Status das Liberações</h3>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    <span class="text-xs text-gray-500">Real-time</span>
                                </div>
                            </div>
                            <div class="h-48">
                                <canvas id="chart-liberacoes-status"></canvas>
                            </div>
                        </div>
                        
                        <!-- Metas por Tipo -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Distribuição de Metas</h3>
                                <i class="fas fa-pie-chart text-gray-400"></i>
                            </div>
                            <div class="h-48">
                                <canvas id="chart-metas-tipo"></canvas>
                            </div>
                        </div>
                        
                        <!-- Eficiência por Turno -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Eficiência por Turno</h3>
                                <i class="fas fa-clock text-gray-400"></i>
                            </div>
                            <div class="h-48">
                                <canvas id="chart-eficiencia-turno"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabelas de Detalhes -->
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
                        <!-- Top 5 Frentes Performance -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white">🏆 Top Performance</h3>
                                <span class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded-full">Este mês</span>
                            </div>
                            <div class="space-y-3">
                                <div id="dash-top-frentes" class="space-y-3">
                                    <!-- Preenchido dinamicamente -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Atividade Recente -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white">📈 Atividade Recente</h3>
                                <span class="text-xs text-gray-500 dark:text-gray-400">Últimas 24h</span>
                            </div>
                            <div class="space-y-3 max-h-64 overflow-y-auto scrollbar-thin">
                                <div id="dash-atividade-recente" class="space-y-3">
                                    <!-- Preenchido dinamicamente -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Resumo Executivo -->
                    <div class="bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-700 rounded-lg card-shadow p-6 border border-gray-200 dark:border-gray-600">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white">💼 Resumo Executivo</h3>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-xs text-gray-500 dark:text-gray-400">Atualização automática</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">📊 Performance Geral</h4>
                                <p id="dash-resumo-performance" class="text-sm text-gray-600 dark:text-gray-400">
                                    Sistema operando com eficiência de 92%, superando a meta estabelecida.
                                </p>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">⚠️ Pontos de Atenção</h4>
                                <div id="dash-resumo-alertas" class="text-sm text-gray-600 dark:text-gray-400">
                                    Todas as frentes operando dentro dos parâmetros normais.
                                </div>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">🎯 Próximas Ações</h4>
                                <div id="dash-resumo-acoes" class="text-sm text-gray-600 dark:text-gray-400">
                                    Manter ritmo atual para atingir metas mensais.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Conteúdo de Liberações -->
                <div id="content-liberacoes" class="content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">Liberações</h2>
                        <p class="text-gray-600 dark:text-gray-400">Gerenciamento completo de liberações de produção</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Formulário de liberação -->
                        <div class="lg:col-span-1">
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Nova Liberação</h3>
                                    <button id="btn-clear-form-liberacao" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                
                                <form id="form-liberacao" class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-frente">
                                            Frente <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="liberacao-frente" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: Frente 01" required>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-fazenda">
                                            Fazenda <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="liberacao-fazenda" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: Fazenda São João" required>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-numero">
                                            Número da Liberação
                                        </label>
                                        <input type="text" id="liberacao-numero" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: LIB-2025-001">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-status">
                                            Status <span class="text-red-500">*</span>
                                        </label>
                                        <select id="liberacao-status" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="aberto">Aberto</option>
                                            <option value="fechado">Fechado</option>
                                            <option value="em-andamento">Em Andamento</option>
                                            <option value="cancelado">Cancelado</option>
                                        </select>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-previsto">
                                                Previsto (T) <span class="text-red-500">*</span>
                                            </label>
                                            <input type="number" step="0.01" id="liberacao-previsto" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="1000" required>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-realizado">
                                                Realizado (T) <span class="text-red-500">*</span>
                                            </label>
                                            <input type="number" step="0.01" id="liberacao-realizado" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="850" required>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-data">
                                            Data <span class="text-red-500">*</span>
                                        </label>
                                        <input type="date" id="liberacao-data" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-observacoes">
                                            Observações
                                        </label>
                                        <textarea id="liberacao-observacoes" rows="3" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Observações adicionais"></textarea>
                                    </div>
                                    
                                    <div class="flex items-center space-x-3 pt-4">
                                        <button type="submit" id="btn-submit-liberacao" class="flex-1 inline-flex items-center justify-center px-4 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                            <i class="fas fa-save mr-2"></i> 
                                            <span id="btn-submit-text">Salvar Liberação</span>
                                        </button>
                                        <button type="button" id="btn-cancel-liberacao" class="px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Resumo e tabela -->
                        <div class="lg:col-span-2">
                            <!-- Filtros e busca -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 mb-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Filtros e Busca</h3>
                                    <div class="flex space-x-2">
                                        <button id="btn-clear-filters" class="px-3 py-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 transition-colors">
                                            <i class="fas fa-times mr-1"></i> Limpar
                                        </button>
                                        <button id="btn-export-liberacoes" class="inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-all-300 hover-scale">
                                            <i class="fas fa-file-export mr-2"></i> Exportar
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Busca -->
                                <div class="mb-4">
                                    <div class="relative">
                                        <input type="text" id="search-liberacoes" placeholder="Buscar por frente, fazenda, número..." class="pl-10 pr-4 py-2 w-full border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all-300">
                                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                    </div>
                                </div>
                                
                                <!-- Filtros -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="filtro-liberacao-frente">
                                            Frente
                                        </label>
                                        <select id="filtro-liberacao-frente" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300">
                                            <option value="">Todas</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="filtro-liberacao-fazenda">
                                            Fazenda
                                        </label>
                                        <select id="filtro-liberacao-fazenda" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300">
                                            <option value="">Todas</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="filtro-liberacao-status">
                                            Status
                                        </label>
                                        <select id="filtro-liberacao-status" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300">
                                            <option value="">Todos</option>
                                            <option value="aberto">Aberto</option>
                                            <option value="fechado">Fechado</option>
                                            <option value="em-andamento">Em Andamento</option>
                                            <option value="cancelado">Cancelado</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Resumo expandido -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 mb-6">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Resumo</h3>
                                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 p-4 rounded-lg text-center">
                                        <div class="text-xs text-blue-600 dark:text-blue-400 font-medium mb-1">Total Previsto</div>
                                        <div id="resumo-total-previsto" class="text-xl font-bold text-blue-800 dark:text-blue-300">0 T</div>
                                    </div>
                                    <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30 p-4 rounded-lg text-center">
                                        <div class="text-xs text-green-600 dark:text-green-400 font-medium mb-1">Total Realizado</div>
                                        <div id="resumo-total-realizado" class="text-xl font-bold text-green-800 dark:text-green-300">0 T</div>
                                    </div>
                                    <div class="bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/30 dark:to-red-800/30 p-4 rounded-lg text-center">
                                        <div class="text-xs text-red-600 dark:text-red-400 font-medium mb-1">Total Restante</div>
                                        <div id="resumo-total-restante" class="text-xl font-bold text-red-800 dark:text-red-300">0 T</div>
                                    </div>
                                    <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30 p-4 rounded-lg text-center">
                                        <div class="text-xs text-green-600 dark:text-green-400 font-medium mb-1">Aberto</div>
                                        <div id="resumo-status-aberto" class="text-xl font-bold text-green-800 dark:text-green-300">0</div>
                                    </div>
                                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 p-4 rounded-lg text-center">
                                        <div class="text-xs text-blue-600 dark:text-blue-400 font-medium mb-1">Fechado</div>
                                        <div id="resumo-status-fechado" class="text-xl font-bold text-blue-800 dark:text-blue-300">0</div>
                                    </div>
                                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/30 dark:to-purple-800/30 p-4 rounded-lg text-center">
                                        <div class="text-xs text-purple-600 dark:text-purple-400 font-medium mb-1">Total Geral</div>
                                        <div id="resumo-total-geral" class="text-xl font-bold text-purple-800 dark:text-purple-300">0</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tabela de liberações -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Liberações</h3>
                                    <div class="flex items-center space-x-2">
                                        <span id="results-count" class="text-sm text-gray-500 dark:text-gray-400">0 resultados</span>
                                        <button id="btn-refresh-liberacoes" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="table-container">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort="frente">
                                                    Frente <i class="fas fa-sort ml-1"></i>
                                                </th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort="fazenda">
                                                    Fazenda <i class="fas fa-sort ml-1"></i>
                                                </th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Nº Liberação</th>
                                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort="status">
                                                    Status <i class="fas fa-sort ml-1"></i>
                                                </th>
                                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort="previsto">
                                                    Previsto <i class="fas fa-sort ml-1"></i>
                                                </th>
                                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort="realizado">
                                                    Realizado <i class="fas fa-sort ml-1"></i>
                                                </th>
                                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Restante</th>
                                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Progresso</th>
                                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabela-liberacoes" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Preenchido dinamicamente -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Paginação -->
                                <div id="pagination-liberacoes" class="flex items-center justify-between mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <!-- Preenchido dinamicamente -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Conteúdo de Metas de Colheita -->
                <div id="content-metas" class="content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">Metas de Colheita</h2>
                        <p class="text-gray-600 dark:text-gray-400">Gestão completa de frentes próprias/terceiras, metas e acompanhamento da colheita</p>
                    </div>
                    
                    <!-- Abas de Metas -->
                    <div class="mb-6">
                        <div class="border-b border-gray-200 dark:border-gray-700">
                            <nav class="-mb-px flex space-x-8">
                                <button class="tab-button active py-2 px-1 border-b-2 border-primary-500 font-medium text-sm text-primary-600 dark:text-primary-400 transition-all-300" data-tab="frentes">
                                    <i class="fas fa-map-marker-alt mr-2"></i>Frentes
                                </button>
                                <button class="tab-button py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 transition-all-300" data-tab="metas-proprias">
                                    <i class="fas fa-home mr-2"></i>Metas Próprias
                                </button>
                                <button class="tab-button py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 transition-all-300" data-tab="metas-terceiras">
                                    <i class="fas fa-handshake mr-2"></i>Metas Terceiras
                                </button>
                                <button class="tab-button py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 transition-all-300" data-tab="diario">
                                    <i class="fas fa-calendar-day mr-2"></i>Lançamento Diário
                                </button>
                                <button class="tab-button py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 transition-all-300" data-tab="acompanhamento">
                                    <i class="fas fa-chart-line mr-2"></i>Acompanhamento
                                </button>
                            </nav>
                        </div>
                    </div>

                    <!-- Aba Frentes -->
                    <div id="tab-frentes" class="tab-content">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Formulário de Frentes -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Cadastrar Frente</h3>
                                
                                <form id="form-frente" class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="frente-nome">
                                            Nome da Frente <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="frente-nome" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: Frente 01" required>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="frente-fazenda">
                                            Fazenda <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="frente-fazenda" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: Fazenda São João" required>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="frente-tipo">
                                            Tipo da Frente <span class="text-red-500">*</span>
                                        </label>
                                        <select id="frente-tipo" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="propria">Própria</option>
                                            <option value="terceira">Terceira</option>
                                            <option value="desconhecido">Desconhecido</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="frente-responsavel">
                                            Responsável
                                        </label>
                                        <input type="text" id="frente-responsavel" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: João Silva">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="frente-status">
                                            Status <span class="text-red-500">*</span>
                                        </label>
                                        <select id="frente-status" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="ativa">Ativa</option>
                                            <option value="inativa">Inativa</option>
                                            <option value="manutencao">Manutenção</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="frente-observacoes">
                                            Observações
                                        </label>
                                        <textarea id="frente-observacoes" rows="3" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Observações sobre a frente"></textarea>
                                    </div>
                                    
                                    <div class="flex items-center space-x-3 pt-4">
                                        <button type="submit" class="flex-1 inline-flex items-center justify-center px-4 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                            <i class="fas fa-save mr-2"></i> <span id="btn-submit-frente-text">Salvar Frente</span>
                                        </button>
                                        <button type="reset" class="px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Lista de Frentes -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Frentes Cadastradas</h3>
                                    <button id="btn-refresh-frentes" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                                
                                <div class="table-container">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Nome</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Fazenda</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Tipo</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Status</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabela-frentes" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Preenchido dinamicamente -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba Metas Próprias -->
                    <div id="tab-metas-proprias" class="tab-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Formulário de Metas Próprias -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                                    <i class="fas fa-home text-blue-600 dark:text-blue-400 mr-2"></i>
                                    Definir Meta Própria
                                </h3>
                                
                                <form id="form-meta-propria" class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-propria-frente">
                                            Frente Própria <span class="text-red-500">*</span>
                                        </label>
                                        <select id="meta-propria-frente" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="">Selecione uma frente própria</option>
                                        </select>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-propria-periodo">
                                            Período <span class="text-red-500">*</span>
                                        </label>
                                        <select id="meta-propria-periodo" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="diario">Diário</option>
                                            <option value="semanal">Semanal</option>
                                            <option value="mensal">Mensal</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-propria-valor">
                                            Meta (Toneladas) <span class="text-red-500">*</span>
                                        </label>
                                        <input type="number" step="0.01" id="meta-propria-valor" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: 150.00" required>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-propria-data-inicio">
                                                Data de Início <span class="text-red-500">*</span>
                                            </label>
                                            <input type="date" id="meta-propria-data-inicio" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-propria-data-fim">
                                                Data de Fim <span class="text-red-500">*</span>
                                            </label>
                                            <input type="date" id="meta-propria-data-fim" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-propria-observacoes">
                                            Observações
                                        </label>
                                        <textarea id="meta-propria-observacoes" rows="3" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Observações sobre a meta própria"></textarea>
                                    </div>
                                    
                                    <div class="flex items-center space-x-3 pt-4">
                                        <button type="submit" class="flex-1 inline-flex items-center justify-center px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                            <i class="fas fa-save mr-2"></i> <span id="btn-submit-meta-propria-text">Salvar Meta Própria</span>
                                        </button>
                                        <button type="reset" class="px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Lista de Metas Próprias -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                                        <i class="fas fa-home text-blue-600 dark:text-blue-400 mr-2"></i>
                                        Metas Próprias
                                    </h3>
                                    <button id="btn-refresh-metas-proprias" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                                
                                <div class="table-container">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Frente</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Período</th>
                                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Meta (T)</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Status</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabela-metas-proprias" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Preenchido dinamicamente -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba Metas Terceiras -->
                    <div id="tab-metas-terceiras" class="tab-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Formulário de Metas Terceiras -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                                    <i class="fas fa-handshake text-orange-600 dark:text-orange-400 mr-2"></i>
                                    Definir Meta Terceira
                                </h3>
                                
                                <form id="form-meta-terceira" class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-terceira-frente">
                                            Frente Terceira <span class="text-red-500">*</span>
                                        </label>
                                        <select id="meta-terceira-frente" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="">Selecione uma frente terceira</option>
                                        </select>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-terceira-periodo">
                                            Período <span class="text-red-500">*</span>
                                        </label>
                                        <select id="meta-terceira-periodo" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="diario">Diário</option>
                                            <option value="semanal">Semanal</option>
                                            <option value="mensal">Mensal</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-terceira-valor">
                                            Meta (Toneladas) <span class="text-red-500">*</span>
                                        </label>
                                        <input type="number" step="0.01" id="meta-terceira-valor" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: 120.00" required>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-terceira-data-inicio">
                                                Data de Início <span class="text-red-500">*</span>
                                            </label>
                                            <input type="date" id="meta-terceira-data-inicio" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-terceira-data-fim">
                                                Data de Fim <span class="text-red-500">*</span>
                                            </label>
                                            <input type="date" id="meta-terceira-data-fim" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-terceira-observacoes">
                                            Observações
                                        </label>
                                        <textarea id="meta-terceira-observacoes" rows="3" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Observações sobre a meta terceira"></textarea>
                                    </div>
                                    
                                    <div class="flex items-center space-x-3 pt-4">
                                        <button type="submit" class="flex-1 inline-flex items-center justify-center px-4 py-3 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                            <i class="fas fa-save mr-2"></i> <span id="btn-submit-meta-terceira-text">Salvar Meta Terceira</span>
                                        </button>
                                        <button type="reset" class="px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Lista de Metas Terceiras -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                                        <i class="fas fa-handshake text-orange-600 dark:text-orange-400 mr-2"></i>
                                        Metas Terceiras
                                    </h3>
                                    <button id="btn-refresh-metas-terceiras" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                                
                                <div class="table-container">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Frente</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Período</th>
                                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Meta (T)</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Status</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabela-metas-terceiras" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Preenchido dinamicamente -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba Lançamento Diário -->
                    <div id="tab-diario" class="tab-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Formulário de Lançamento Diário -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Lançamento Diário</h3>
                                
                                <form id="form-lancamento" class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="lancamento-frente">
                                            Frente <span class="text-red-500">*</span>
                                        </label>
                                        <select id="lancamento-frente" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="">Selecione uma frente</option>
                                        </select>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="lancamento-data">
                                            Data <span class="text-red-500">*</span>
                                        </label>
                                        <input type="date" id="lancamento-data" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="lancamento-colhido">
                                            Quantidade Colhida (T) <span class="text-red-500">*</span>
                                        </label>
                                        <input type="number" step="0.01" id="lancamento-colhido" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: 120.50" required>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="lancamento-turno">
                                            Turno <span class="text-red-500">*</span>
                                        </label>
                                        <select id="lancamento-turno" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="manha">Manhã</option>
                                            <option value="tarde">Tarde</option>
                                            <option value="noite">Noite</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="lancamento-operador">
                                            Operador
                                        </label>
                                        <input type="text" id="lancamento-operador" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: José Santos">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="lancamento-observacoes">
                                            Observações
                                        </label>
                                        <textarea id="lancamento-observacoes" rows="3" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Observações do dia"></textarea>
                                    </div>
                                    
                                    <div class="flex items-center space-x-3 pt-4">
                                        <button type="submit" class="flex-1 inline-flex items-center justify-center px-4 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                            <i class="fas fa-save mr-2"></i> <span id="btn-submit-lancamento-text">Salvar Lançamento</span>
                                        </button>
                                        <button type="reset" class="px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Lançamentos Recentes -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Lançamentos Recentes</h3>
                                    <button id="btn-refresh-lancamentos" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                                
                                <div class="table-container">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Data</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Frente</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Tipo</th>
                                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Colhido (T)</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Turno</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabela-lancamentos" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Preenchido dinamicamente -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba Acompanhamento MELHORADA -->
                    <div id="tab-acompanhamento" class="tab-content hidden">
                        <!-- Filtros de Acompanhamento Avançados -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                                <i class="fas fa-filter mr-2"></i>Filtros Avançados de Acompanhamento
                            </h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="filtro-acompanhamento-frente">
                                        Frente
                                    </label>
                                    <select id="filtro-acompanhamento-frente" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300">
                                        <option value="">Todas as frentes</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="filtro-acompanhamento-tipo">
                                        Tipo
                                    </label>
                                    <select id="filtro-acompanhamento-tipo" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300">
                                        <option value="">Todos os tipos</option>
                                        <option value="propria">Próprias</option>
                                        <option value="terceira">Terceiras</option>
                                        <option value="desconhecido">Desconhecidas</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="filtro-acompanhamento-data-inicio">
                                        Data Início
                                    </label>
                                    <input type="date" id="filtro-acompanhamento-data-inicio" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300">
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="filtro-acompanhamento-data-fim">
                                        Data Fim
                                    </label>
                                    <input type="date" id="filtro-acompanhamento-data-fim" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300">
                                </div>
                                <div class="flex items-end">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="filtro-incluir-inativos" class="rounded border-gray-300 text-primary-600 shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50">
                                        <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Incluir Inativas</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-3">
                                <button id="btn-aplicar-filtro-acompanhamento" class="inline-flex items-center px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                    <i class="fas fa-filter mr-2"></i> Aplicar Filtros
                                </button>
                                <button id="btn-limpar-filtro-acompanhamento" class="inline-flex items-center px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white font-medium rounded-lg text-sm transition-all-300">
                                    <i class="fas fa-times mr-2"></i> Limpar
                                </button>
                                <button id="btn-auto-refresh-acompanhamento" class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg text-sm transition-all-300">
                                    <i class="fas fa-sync-alt mr-2"></i> Auto-Refresh
                                </button>
                                <button id="btn-exportar-acompanhamento" class="inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                    <i class="fas fa-file-export mr-2"></i> Exportar Relatório
                                </button>
                            </div>
                        </div>

                        <!-- Resumo Avançado do Acompanhamento -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 mb-6">
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 text-center hover-scale transition-all-300">
                                <div class="flex items-center justify-center mb-2">
                                    <i class="fas fa-home text-blue-600 dark:text-blue-400 text-2xl mr-2"></i>
                                    <div>
                                        <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="resumo-metas-proprias-ativas">0</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Metas Próprias</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 text-center hover-scale transition-all-300">
                                <div class="flex items-center justify-center mb-2">
                                    <i class="fas fa-handshake text-orange-600 dark:text-orange-400 text-2xl mr-2"></i>
                                    <div>
                                        <div class="text-2xl font-bold text-orange-600 dark:text-orange-400" id="resumo-metas-terceiras-ativas">0</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Metas Terceiras</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 text-center hover-scale transition-all-300">
                                <div class="flex items-center justify-center mb-2">
                                    <i class="fas fa-weight-hanging text-green-600 dark:text-green-400 text-2xl mr-2"></i>
                                    <div>
                                        <div class="text-2xl font-bold text-green-600 dark:text-green-400" id="resumo-total-colhido">0 T</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Total Colhido</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 text-center hover-scale transition-all-300">
                                <div class="flex items-center justify-center mb-2">
                                    <i class="fas fa-bullseye text-purple-600 dark:text-purple-400 text-2xl mr-2"></i>
                                    <div>
                                        <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="resumo-total-meta">0 T</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Meta Total</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 text-center hover-scale transition-all-300">
                                <div class="flex items-center justify-center mb-2">
                                    <i class="fas fa-percentage text-indigo-600 dark:text-indigo-400 text-2xl mr-2"></i>
                                    <div>
                                        <div class="text-2xl font-bold text-indigo-600 dark:text-indigo-400" id="resumo-percentual-meta">0%</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">% da Meta</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 text-center hover-scale transition-all-300">
                                <div class="flex items-center justify-center mb-2">
                                    <i class="fas fa-chart-line text-teal-600 dark:text-teal-400 text-2xl mr-2"></i>
                                    <div>
                                        <div class="text-sm font-bold text-teal-600 dark:text-teal-400" id="resumo-tendencia-info">Estável</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Tendência</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tabela de Acompanhamento Avançada -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                                    <i class="fas fa-chart-line mr-2"></i>Acompanhamento Detalhado por Frente
                                </h3>
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm text-gray-500 dark:text-gray-400">Última atualização: <span id="ultima-atualizacao">--:--</span></span>
                                    <button id="btn-refresh-acompanhamento" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-container">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort-acompanhamento="nome">
                                                Frente <i class="fas fa-sort ml-1"></i>
                                            </th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Tipo</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort-acompanhamento="metaTotal">
                                                Meta (T) <i class="fas fa-sort ml-1"></i>
                                            </th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort-acompanhamento="colhidoTotal">
                                                Colhido (T) <i class="fas fa-sort ml-1"></i>
                                            </th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort-acompanhamento="restante">
                                                Restante (T) <i class="fas fa-sort ml-1"></i>
                                            </th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort-acompanhamento="percentualMeta">
                                                % Meta <i class="fas fa-sort ml-1"></i>
                                            </th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Status</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Tendência</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Progresso</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabela-acompanhamento" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Preenchido dinamicamente -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Legenda de Status -->
                            <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Legenda de Status:</h4>
                                <div class="flex flex-wrap gap-4 text-xs">
                                    <span class="flex items-center">
                                        <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                        Meta Atingida (≥100%)
                                    </span>
                                    <span class="flex items-center">
                                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                                        Próximo à Meta (≥90%)
                                    </span>
                                    <span class="flex items-center">
                                        <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
                                        Em Progresso (≥70%)
                                    </span>
                                    <span class="flex items-center">
                                        <div class="w-3 h-3 bg-orange-500 rounded-full mr-2"></div>
                                        Atenção (≥50%)
                                    </span>
                                    <span class="flex items-center">
                                        <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                                        Crítico (&lt;50%)
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Conteúdo de Configurações -->
                <div id="content-configuracoes" class="content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">Configurações</h2>
                        <p class="text-gray-600 dark:text-gray-400">Configurações do sistema e gestão de dados</p>
                    </div>
                    
                    <!-- Backup e Restauração -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Backup e Restauração</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                                <h4 class="text-md font-medium text-blue-800 dark:text-blue-300 mb-2">Exportar Dados</h4>
                                <p class="text-sm text-blue-600 dark:text-blue-400 mb-4">Exporte todos os dados para um arquivo JSON de backup</p>
                                <button id="btn-exportar-json" class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                    <i class="fas fa-download mr-2"></i> Exportar Backup
                                </button>
                            </div>
                            
                            <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                                <h4 class="text-md font-medium text-green-800 dark:text-green-300 mb-2">Importar Dados</h4>
                                <p class="text-sm text-green-600 dark:text-green-400 mb-4">Importe dados de um arquivo JSON previamente exportado</p>
                                
                                <button id="btn-importar-json" class="inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                    <i class="fas fa-upload mr-2"></i> Importar Backup
                                </button>
                                <input type="file" id="import-json-file" accept=".json" class="hidden">
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                            <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg">
                                <h4 class="text-md font-medium text-red-800 dark:text-red-300 mb-2">Limpar Todos os Dados</h4>
                                <p class="text-sm text-red-600 dark:text-red-400 mb-4">
                                    <span class="font-semibold">Atenção:</span> Esta ação irá remover permanentemente todos os dados do sistema.
                                </p>
                                <button id="btn-limpar-dados" class="inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                    <i class="fas fa-trash-alt mr-2"></i> Limpar Todos os Dados
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Relatórios -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Relatórios do Sistema</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button id="btn-relatorio-liberacoes" class="inline-flex items-center justify-center px-6 py-4 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                <i class="fas fa-chart-line mr-2"></i> Relatório de Liberações
                            </button>
                            <button id="btn-relatorio-metas" class="inline-flex items-center justify-center px-6 py-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                <i class="fas fa-bullseye mr-2"></i> Relatório de Metas
                            </button>
                            <button id="btn-relatorio-colheita" class="inline-flex items-center justify-center px-6 py-4 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                <i class="fas fa-seedling mr-2"></i> Relatório de Colheita
                            </button>
                        </div>
                    </div>
                    
                    <!-- Sobre o Sistema -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Sobre o Sistema</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <div class="text-sm text-gray-600 dark:text-gray-400 space-y-2">
                                    <p><strong class="text-gray-800 dark:text-white">Nome:</strong> GGOMES-LOG</p>
                                    <p><strong class="text-gray-800 dark:text-white">Versão:</strong> 2.1 Avançada</p>
                                    <p><strong class="text-gray-800 dark:text-white">Descrição:</strong> Sistema avançado de gestão agrícola para acompanhamento de colheita, metas próprias/terceiras e logística com análises preditivas.</p>
                                    <p><strong class="text-gray-800 dark:text-white">Desenvolvido por:</strong> GGOMES Technologies</p>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="text-md font-medium text-gray-800 dark:text-white mb-3">Melhorias da Versão Avançada</h4>
                                <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                    <li>• <strong>Dashboard Executivo:</strong> KPIs avançados e análises em tempo real</li>
                                    <li>• <strong>Gráficos Avançados:</strong> Evolução temporal e comparativos</li>
                                    <li>• <strong>Alertas Inteligentes:</strong> Notificações baseadas em regras</li>
                                    <li>• <strong>Performance Otimizada:</strong> Cache inteligente de dados</li>
                                    <li>• <strong>Indicadores Avançados:</strong> Tendências e projeções</li>
                                    <li>• <strong>Interface Melhorada:</strong> Responsividade aprimorada</li>
                                    <li>• <strong>Relatórios Detalhados:</strong> Análises mais profundas</li>
                                    <li>• <strong>Auto-Refresh:</strong> Atualização automática de dados</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                            <p class="text-xs text-gray-500 dark:text-gray-400 text-center">
                                © 2025 GGOMES Technologies. Todos os direitos reservados. Versão Avançada com IA.
                            </p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modal de confirmação para limpar dados -->
    <div id="modal-limpar-dados" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 animate-fade-in">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Confirmação de Limpeza</h3>
            
            <p class="text-gray-700 dark:text-gray-300 mb-4">
                <span class="text-red-500 font-semibold">Atenção:</span> Esta ação irá remover <span class="font-semibold">PERMANENTEMENTE</span> todos os dados do sistema.
            </p>
            
            <p class="text-gray-700 dark:text-gray-300 mb-6">
                Para confirmar, digite "CONFIRMAR" no campo abaixo:
            </p>
            
            <div class="mb-6">
                <input type="text" id="confirmacao-texto" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-red-500 focus:border-red-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Digite CONFIRMAR">
            </div>
            
            <div class="flex justify-end space-x-4">
                <button id="btn-cancelar-limpar" class="inline-flex items-center px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                    <i class="fas fa-times mr-2"></i> Cancelar
                </button>
                <button id="btn-confirmar-limpar" class="inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg text-sm opacity-50 cursor-not-allowed transition-all-300" disabled>
                    <i class="fas fa-trash-alt mr-2"></i> Sim, Limpar Tudo
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal de notificações -->
    <div id="modal-notifications" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 animate-fade-in">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">Notificações</h3>
                <button id="btn-close-notifications" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="notifications-list" class="space-y-3 max-h-64 overflow-y-auto scrollbar-thin">
                <!-- Preenchido dinamicamente -->
            </div>
            
            <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                <button id="btn-clear-notifications" class="w-full text-center text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 transition-colors">
                    Limpar todas as notificações
                </button>
            </div>
        </div>
    </div>

<script>
// ===== SISTEMA DE GESTÃO AGRÍCOLA GGOMES-LOG v2.1 AVANÇADO =====

// Configuração global da aplicação
const AppConfig = {
    version: '2.1-advanced',
    name: 'GGOMES-LOG',
    pagination: { itemsPerPage: 10 },
    charts: {},
    notifications: [],
    autoRefresh: false,
    refreshInterval: null
};

// Cache para otimização de performance
const AcompanhamentoCache = {
    data: null,
    timestamp: null,
    filters: null,
    isValid: function(currentFilters) {
        if (!this.data || !this.timestamp) return false;
        const cacheAge = Date.now() - this.timestamp;
        const maxAge = 30000; // 30 segundos
        return cacheAge < maxAge && JSON.stringify(this.filters) === JSON.stringify(currentFilters);
    },
    set: function(data, filters) {
        this.data = data;
        this.timestamp = Date.now();
        this.filters = { ...filters };
    },
    get: function() {
        return this.data;
    },
    clear: function() {
        this.data = null;
        this.timestamp = null;
        this.filters = null;
    }
};

// Estado de ordenação da tabela de acompanhamento
let currentAcompanhamentoSort = { field: 'percentualMeta', direction: 'desc' };

// Sistema básico de toasts melhorado
const Toast = {
    show: function(message, type = 'success', duration = 4000) {
        const toastContainer = document.getElementById('toast-container');
        if (!toastContainer) return;
        
        const toast = document.createElement('div');
        const colorClasses = {
            'success': 'bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-300 border-green-200 dark:border-green-700',
            'error': 'bg-red-100 dark:bg-red-800 text-red-700 dark:text-red-300 border-red-200 dark:border-red-700',
            'warning': 'bg-yellow-100 dark:bg-yellow-800 text-yellow-700 dark:text-yellow-300 border-yellow-200 dark:border-yellow-700',
            'info': 'bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300 border-blue-200 dark:border-blue-700'
        };
        
        const iconClasses = {
            'success': 'fa-check-circle',
            'error': 'fa-exclamation-circle',
            'warning': 'fa-exclamation-triangle',
            'info': 'fa-info-circle'
        };
        
        toast.className = `animate-fade-in p-4 mb-3 rounded-lg border card-shadow flex items-center justify-between max-w-sm ${colorClasses[type] || colorClasses.info}`;
        
        toast.innerHTML = `
            <div class="flex items-center">
                <i class="fas ${iconClasses[type] || iconClasses.info} mr-3 text-lg"></i>
                <span class="text-sm font-medium">${message}</span>
            </div>
            <button class="ml-4 text-current hover:opacity-70 focus:outline-none transition-opacity">
                <i class="fas fa-times"></i>
            </button>
        `;
        
        const closeBtn = toast.querySelector('button');
        closeBtn.addEventListener('click', () => this.remove(toast));
        
        toastContainer.appendChild(toast);
        
        if (duration > 0) {
            setTimeout(() => this.remove(toast), duration);
        }
    },
    
    remove: function(toast) {
        if (toast && toast.parentNode) {
            toast.classList.remove('animate-fade-in');
            toast.classList.add('animate-fade-out');
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }
    }
};

// Sistema de Banco de Dados Local melhorado
const DB = {
    // Inicialização do banco de dados
    init: function() {
        this.initializeDefaultData();
        this.updateLastAccess();
    },
    
    // Inicializar dados padrão se não existirem
    initializeDefaultData: function() {
        if (!localStorage.getItem('ggomes_liberacoes')) {
            const hoje = new Date().toISOString().split('T')[0];
            const ontem = new Date();
            ontem.setDate(ontem.getDate() - 1);
            const dataOntem = ontem.toISOString().split('T')[0];
            
            const liberacoesIniciais = [
                {
                    id: 'LIB-001',
                    frente: 'Frente 01',
                    fazenda: 'Fazenda São João',
                    numero: 'LIB-2025-001',
                    status: 'fechado',
                    previsto: 1000,
                    realizado: 950,
                    restante: 50,
                    data: dataOntem,
                    observacoes: 'Liberação concluída com sucesso',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 'LIB-002',
                    frente: 'Frente 02',
                    fazenda: 'Fazenda Boa Vista',
                    numero: 'LIB-2025-002',
                    status: 'em-andamento',
                    previsto: 1500,
                    realizado: 1200,
                    restante: 300,
                    data: hoje,
                    observacoes: 'Em progresso, boa produtividade',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 'LIB-003',
                    frente: 'Frente 01',
                    fazenda: 'Fazenda São João',
                    numero: 'LIB-2025-003',
                    status: 'aberto',
                    previsto: 800,
                    realizado: 200,
                    restante: 600,
                    data: hoje,
                    observacoes: 'Iniciada hoje pela manhã',
                    dataRegistro: new Date().toISOString()
                }
            ];
            localStorage.setItem('ggomes_liberacoes', JSON.stringify(liberacoesIniciais));
            
            const frentesIniciais = [
                {
                    id: 'FRENTE-001',
                    nome: 'Frente 01',
                    fazenda: 'Fazenda São João',
                    tipo: 'propria',
                    responsavel: 'João Silva',
                    status: 'ativa',
                    observacoes: 'Frente principal com alta produtividade',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 'FRENTE-002',
                    nome: 'Frente 02',
                    fazenda: 'Fazenda Boa Vista',
                    tipo: 'propria',
                    responsavel: 'Maria Santos',
                    status: 'ativa',
                    observacoes: 'Frente secundária em expansão',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 'FRENTE-003',
                    nome: 'Frente Terceira A',
                    fazenda: 'Fazenda Esperança',
                    tipo: 'terceira',
                    responsavel: 'Pedro Lima',
                    status: 'ativa',
                    observacoes: 'Nova frente terceirizada',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 'FRENTE-004',
                    nome: 'Frente Desconhecida X',
                    fazenda: 'Fazenda Nova',
                    tipo: 'desconhecido',
                    responsavel: 'A definir',
                    status: 'inativa',
                    observacoes: 'Frente em análise para classificação',
                    dataRegistro: new Date().toISOString()
                }
            ];
            localStorage.setItem('ggomes_frentes', JSON.stringify(frentesIniciais));
            
            const metasIniciais = [
                {
                    id: 'META-001',
                    frenteId: 'FRENTE-001',
                    tipo: 'propria',
                    periodo: 'diario',
                    valor: 180,
                    dataInicio: hoje,
                    dataFim: hoje,
                    observacoes: 'Meta diária padrão própria',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 'META-002',
                    frenteId: 'FRENTE-003',
                    tipo: 'terceira',
                    periodo: 'diario',
                    valor: 150,
                    dataInicio: hoje,
                    dataFim: hoje,
                    observacoes: 'Meta inicial terceirizada',
                    dataRegistro: new Date().toISOString()
                }
            ];
            localStorage.setItem('ggomes_metas', JSON.stringify(metasIniciais));
            
            const lancamentosIniciais = [
                {
                    id: 'LANC-001',
                    frenteId: 'FRENTE-001',
                    data: dataOntem,
                    colhido: 175.5,
                    turno: 'manha',
                    operador: 'José Santos',
                    observacoes: 'Excelente rendimento matinal',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 'LANC-002',
                    frenteId: 'FRENTE-003',
                    data: dataOntem,
                    colhido: 140.2,
                    turno: 'tarde',
                    operador: 'Pedro Lima',
                    observacoes: 'Boa produtividade terceirizada',
                    dataRegistro: new Date().toISOString()
                }
            ];
            localStorage.setItem('ggomes_lancamentos', JSON.stringify(lancamentosIniciais));
        }
        
        if (!localStorage.getItem('ggomes_config')) {
            localStorage.setItem('ggomes_config', JSON.stringify({
                version: '2.1-advanced',
                temaEscuro: true,
                ultimoAcesso: new Date().toISOString(),
                notifications: [],
                preferences: { itemsPerPage: 10, autoRefresh: false }
            }));
        }
        
        const tabelas = ['liberacoes', 'frentes', 'metas', 'lancamentos'];
        tabelas.forEach(tabela => {
            if (!localStorage.getItem(`ggomes_${tabela}`)) {
                localStorage.setItem(`ggomes_${tabela}`, JSON.stringify([]));
            }
        });
    },
    
    updateLastAccess: function() {
        const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
        config.ultimoAcesso = new Date().toISOString();
        localStorage.setItem('ggomes_config', JSON.stringify(config));
    },
    
    clearAll: function() {
        try {
            const tabelas = ['liberacoes', 'frentes', 'metas', 'lancamentos'];
            tabelas.forEach(tabela => {
                localStorage.removeItem(`ggomes_${tabela}`);
                localStorage.setItem(`ggomes_${tabela}`, JSON.stringify([]));
            });
            
            const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
            localStorage.setItem('ggomes_config', JSON.stringify({
                version: '2.1-advanced',
                temaEscuro: config.temaEscuro || true,
                ultimoAcesso: new Date().toISOString(),
                notifications: [],
                preferences: config.preferences || { itemsPerPage: 10, autoRefresh: false }
            }));
            
            AcompanhamentoCache.clear();
            return true;
        } catch (error) {
            console.error('Erro ao limpar dados:', error);
            return false;
        }
    },
    
    exportData: function() {
        try {
            const data = {
                liberacoes: JSON.parse(localStorage.getItem('ggomes_liberacoes') || '[]'),
                frentes: JSON.parse(localStorage.getItem('ggomes_frentes') || '[]'),
                metas: JSON.parse(localStorage.getItem('ggomes_metas') || '[]'),
                lancamentos: JSON.parse(localStorage.getItem('ggomes_lancamentos') || '[]'),
                config: JSON.parse(localStorage.getItem('ggomes_config') || '{}'),
                metaData: {
                    exportDate: new Date().toISOString(),
                    version: '2.1-advanced',
                    description: 'Backup completo do sistema GGOMES-LOG v2.1 Avançado'
                }
            };
            
            return JSON.stringify(data, null, 2);
        } catch (error) {
            console.error('Erro ao exportar dados:', error);
            throw new Error('Não foi possível exportar os dados.');
        }
    },
    
    importData: function(jsonData) {
        try {
            const data = JSON.parse(jsonData);
            
            if (!data.metaData || !data.metaData.version) {
                throw new Error('Arquivo de backup inválido: metadados ausentes.');
            }
            
            if (!data.liberacoes && !data.frentes && !data.metas && !data.lancamentos) {
                throw new Error('Arquivo de backup vazio ou corrompido.');
            }
            
            const tabelas = ['liberacoes', 'frentes', 'metas', 'lancamentos'];
            tabelas.forEach(tabela => {
                if (data[tabela] && Array.isArray(data[tabela])) {
                    localStorage.setItem(`ggomes_${tabela}`, JSON.stringify(data[tabela]));
                }
            });
            
            if (data.config) {
                const currentConfig = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
                const newConfig = {
                    ...data.config,
                    version: '2.1-advanced',
                    temaEscuro: currentConfig.temaEscuro,
                    ultimoAcesso: new Date().toISOString(),
                    preferences: currentConfig.preferences || data.config.preferences || { itemsPerPage: 10, autoRefresh: false }
                };
                localStorage.setItem('ggomes_config', JSON.stringify(newConfig));
            }
            
            AcompanhamentoCache.clear();
            return true;
        } catch (error) {
            console.error('Erro ao importar dados:', error);
            throw error;
        }
    },
    
    // Módulo Liberações
    liberacoes: {
        getAll: function() {
            try {
                const liberacoes = localStorage.getItem('ggomes_liberacoes');
                return liberacoes ? JSON.parse(liberacoes) : [];
            } catch (error) {
                console.error("Erro ao obter liberações:", error);
                return [];
            }
        },
        
        get: function(id) {
            return this.getAll().find(l => l.id === id);
        },
        
        add: function(liberacao) {
            const requiredFields = ['frente', 'fazenda', 'status', 'previsto', 'realizado', 'data'];
            const missingFields = requiredFields.filter(field => !liberacao[field] && liberacao[field] !== 0);
            
            if (missingFields.length > 0) {
                throw new Error(`Campos obrigatórios ausentes: ${missingFields.join(', ')}`);
            }
            
            const liberacoes = this.getAll();
            
            if (!liberacao.id) {
                liberacao.id = Utils.gerarId('LIB');
            }
            
            if (liberacoes.some(l => l.id === liberacao.id)) {
                throw new Error(`Liberação com ID "${liberacao.id}" já existe.`);
            }
            
            liberacao.restante = Number(liberacao.previsto) - Number(liberacao.realizado);
            liberacao.dataRegistro = liberacao.dataRegistro || new Date().toISOString();
            
            if (Number(liberacao.previsto) < 0 || Number(liberacao.realizado) < 0) {
                throw new Error('Valores previstos e realizados devem ser positivos.');
            }
            
            liberacoes.push(liberacao);
            localStorage.setItem('ggomes_liberacoes', JSON.stringify(liberacoes));
            
            return liberacao;
        },
        
        update: function(liberacao) {
            if (!liberacao.id) {
                throw new Error('ID da liberação é obrigatório.');
            }
            
            const liberacoes = this.getAll();
            const index = liberacoes.findIndex(l => l.id === liberacao.id);
            
            if (index === -1) {
                throw new Error(`Liberação com ID "${liberacao.id}" não encontrada.`);
            }
            
            if (liberacao.previsto !== undefined || liberacao.realizado !== undefined) {
                const previsto = liberacao.previsto !== undefined ? Number(liberacao.previsto) : Number(liberacoes[index].previsto);
                const realizado = liberacao.realizado !== undefined ? Number(liberacao.realizado) : Number(liberacoes[index].realizado);
                liberacao.restante = previsto - realizado;
            }
            
            liberacoes[index] = { ...liberacoes[index], ...liberacao };
            localStorage.setItem('ggomes_liberacoes', JSON.stringify(liberacoes));
            
            return liberacoes[index];
        },
        
        remove: function(id) {
            const liberacoes = this.getAll();
            const index = liberacoes.findIndex(l => l.id === id);
            
            if (index === -1) {
                throw new Error(`Liberação com ID "${id}" não encontrada.`);
            }
            
            liberacoes.splice(index, 1);
            localStorage.setItem('ggomes_liberacoes', JSON.stringify(liberacoes));
            
            return true;
        },
        
        getTotals: function(filtroFrente = '', filtroFazenda = '', filtroStatus = '') {
            let liberacoes = this.getAll();
            
            if (filtroFrente) liberacoes = liberacoes.filter(l => l.frente === filtroFrente);
            if (filtroFazenda) liberacoes = liberacoes.filter(l => l.fazenda === filtroFazenda);
            if (filtroStatus) liberacoes = liberacoes.filter(l => l.status === filtroStatus);
            
            const totals = {
                previsto: 0, realizado: 0, restante: 0,
                statusAberto: 0, statusFechado: 0, statusEmAndamento: 0, statusCancelado: 0,
                totalGeral: 0, count: liberacoes.length
            };
            
            liberacoes.forEach(l => {
                const previsto = Number(l.previsto) || 0;
                const realizado = Number(l.realizado) || 0;
                const restante = Number(l.restante) || 0;
                
                totals.previsto += previsto;
                totals.realizado += realizado;
                totals.restante += restante;
                totals.totalGeral += previsto;
                
                switch(l.status) {
                    case 'aberto': totals.statusAberto++; break;
                    case 'fechado': totals.statusFechado++; break;
                    case 'em-andamento': totals.statusEmAndamento++; break;
                    case 'cancelado': totals.statusCancelado++; break;
                }
            });
            
            return totals;
        },
        
        getUniqueValues: function() {
            const liberacoes = this.getAll();
            const frentes = new Set();
            const fazendas = new Set();
            const status = new Set();
            
            liberacoes.forEach(l => {
                frentes.add(l.frente);
                fazendas.add(l.fazenda);
                if (l.status) status.add(l.status);
            });
            
            return {
                frentes: Array.from(frentes).sort(),
                fazendas: Array.from(fazendas).sort(),
                status: Array.from(status).sort()
            };
        },
        
        search: function(term, filters = {}) {
            let liberacoes = this.getAll();
            
            Object.keys(filters).forEach(key => {
                if (filters[key]) {
                    liberacoes = liberacoes.filter(l => l[key] === filters[key]);
                }
            });
            
            if (term) {
                const lowerTerm = term.toLowerCase();
                liberacoes = liberacoes.filter(l => 
                    (l.frente && l.frente.toLowerCase().includes(lowerTerm)) ||
                    (l.fazenda && l.fazenda.toLowerCase().includes(lowerTerm)) ||
                    (l.numero && l.numero.toLowerCase().includes(lowerTerm)) ||
                    (l.observacoes && l.observacoes.toLowerCase().includes(lowerTerm))
                );
            }
            
            return liberacoes;
        },
        
        paginate: function(liberacoes, page = 1, itemsPerPage = 10) {
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            
            return {
                data: liberacoes.slice(startIndex, endIndex),
                totalPages: Math.ceil(liberacoes.length / itemsPerPage),
                currentPage: page,
                totalItems: liberacoes.length,
                itemsPerPage: itemsPerPage
            };
        }
    },

    // Módulo Frentes
    frentes: {
        getAll: function() {
            try {
                const frentes = localStorage.getItem('ggomes_frentes');
                return frentes ? JSON.parse(frentes) : [];
            } catch (error) {
                console.error("Erro ao obter frentes:", error);
                return [];
            }
        },
        
        get: function(id) {
            return this.getAll().find(f => f.id === id);
        },
        
        add: function(frente) {
            const requiredFields = ['nome', 'fazenda', 'tipo', 'status'];
            const missingFields = requiredFields.filter(field => !frente[field]);
            
            if (missingFields.length > 0) {
                throw new Error(`Campos obrigatórios ausentes: ${missingFields.join(', ')}`);
            }
            
            const frentes = this.getAll();
            
            if (!frente.id) {
                frente.id = Utils.gerarId('FRENTE');
            }
            
            if (frentes.some(f => f.nome === frente.nome && f.fazenda === frente.fazenda)) {
                throw new Error(`Já existe uma frente com o nome "${frente.nome}" na fazenda "${frente.fazenda}".`);
            }
            
            frente.dataRegistro = frente.dataRegistro || new Date().toISOString();
            frentes.push(frente);
            localStorage.setItem('ggomes_frentes', JSON.stringify(frentes));
            
            AcompanhamentoCache.clear();
            return frente;
        },
        
        update: function(frente) {
            if (!frente.id) {
                throw new Error('ID da frente é obrigatório.');
            }
            
            const frentes = this.getAll();
            const index = frentes.findIndex(f => f.id === frente.id);
            
            if (index === -1) {
                throw new Error(`Frente com ID "${frente.id}" não encontrada.`);
            }
            
            frentes[index] = { ...frentes[index], ...frente };
            localStorage.setItem('ggomes_frentes', JSON.stringify(frentes));
            
            AcompanhamentoCache.clear();
            return frentes[index];
        },
        
        remove: function(id) {
            const frentes = this.getAll();
            const index = frentes.findIndex(f => f.id === id);
            
            if (index === -1) {
                throw new Error(`Frente com ID "${id}" não encontrada.`);
            }
            
            const metas = DB.metas.getAll().filter(m => m.frenteId === id);
            const lancamentos = DB.lancamentos.getAll().filter(l => l.frenteId === id);
            
            if (metas.length > 0 || lancamentos.length > 0) {
                throw new Error('Não é possível excluir a frente pois há metas ou lançamentos vinculados a ela.');
            }
            
            frentes.splice(index, 1);
            localStorage.setItem('ggomes_frentes', JSON.stringify(frentes));
            
            AcompanhamentoCache.clear();
            return true;
        },
        
        getAtivas: function() {
            return this.getAll().filter(f => f.status === 'ativa');
        },
        
        getByTipo: function(tipo) {
            return this.getAll().filter(f => f.tipo === tipo);
        },
        
        getAtivasByTipo: function(tipo) {
            return this.getAll().filter(f => f.status === 'ativa' && f.tipo === tipo);
        }
    },

    // Módulo Metas
    metas: {
        getAll: function() {
            try {
                const metas = localStorage.getItem('ggomes_metas');
                return metas ? JSON.parse(metas) : [];
            } catch (error) {
                console.error("Erro ao obter metas:", error);
                return [];
            }
        },
        
        get: function(id) {
            return this.getAll().find(m => m.id === id);
        },
        
        add: function(meta) {
            const requiredFields = ['frenteId', 'tipo', 'periodo', 'valor', 'dataInicio', 'dataFim'];
            const missingFields = requiredFields.filter(field => !meta[field] && meta[field] !== 0);
            
            if (missingFields.length > 0) {
                throw new Error(`Campos obrigatórios ausentes: ${missingFields.join(', ')}`);
            }
            
            if (!meta.id) {
                meta.id = Utils.gerarId('META');
            }
            
            const metas = this.getAll();
            meta.dataRegistro = meta.dataRegistro || new Date().toISOString();
            metas.push(meta);
            localStorage.setItem('ggomes_metas', JSON.stringify(metas));
            
            AcompanhamentoCache.clear();
            return meta;
        },
        
        update: function(meta) {
            if (!meta.id) {
                throw new Error('ID da meta é obrigatório.');
            }
            
            const metas = this.getAll();
            const index = metas.findIndex(m => m.id === meta.id);
            
            if (index === -1) {
                throw new Error(`Meta com ID "${meta.id}" não encontrada.`);
            }
            
            metas[index] = { ...metas[index], ...meta };
            localStorage.setItem('ggomes_metas', JSON.stringify(metas));
            
            AcompanhamentoCache.clear();
            return metas[index];
        },
        
        remove: function(id) {
            const metas = this.getAll();
            const index = metas.findIndex(m => m.id === id);
            
            if (index === -1) {
                throw new Error(`Meta com ID "${id}" não encontrada.`);
            }
            
            metas.splice(index, 1);
            localStorage.setItem('ggomes_metas', JSON.stringify(metas));
            
            AcompanhamentoCache.clear();
            return true;
        },
        
        getAtivas: function(dataRef = null) {
            const data = dataRef || new Date().toISOString().split('T')[0];
            return this.getAll().filter(m => m.dataInicio <= data && m.dataFim >= data);
        },
        
        getByTipo: function(tipo) {
            return this.getAll().filter(m => m.tipo === tipo);
        },
        
        getAtivasByTipo: function(tipo, dataRef = null) {
            const data = dataRef || new Date().toISOString().split('T')[0];
            return this.getAll().filter(m => m.tipo === tipo && m.dataInicio <= data && m.dataFim >= data);
        }
    },

    // Módulo Lançamentos
    lancamentos: {
        getAll: function() {
            try {
                const lancamentos = localStorage.getItem('ggomes_lancamentos');
                return lancamentos ? JSON.parse(lancamentos) : [];
            } catch (error) {
                console.error("Erro ao obter lançamentos:", error);
                return [];
            }
        },
        
        get: function(id) {
            return this.getAll().find(l => l.id === id);
        },
        
        add: function(lancamento) {
            const requiredFields = ['frenteId', 'data', 'colhido', 'turno'];
            const missingFields = requiredFields.filter(field => !lancamento[field] && lancamento[field] !== 0);
            
            if (missingFields.length > 0) {
                throw new Error(`Campos obrigatórios ausentes: ${missingFields.join(', ')}`);
            }
            
            if (!lancamento.id) {
                lancamento.id = Utils.gerarId('LANC');
            }
            
            const lancamentos = this.getAll();
            lancamento.dataRegistro = lancamento.dataRegistro || new Date().toISOString();
            lancamentos.push(lancamento);
            localStorage.setItem('ggomes_lancamentos', JSON.stringify(lancamentos));
            
            AcompanhamentoCache.clear();
            return lancamento;
        },
        
        update: function(lancamento) {
            if (!lancamento.id) {
                throw new Error('ID do lançamento é obrigatório.');
            }
            
            const lancamentos = this.getAll();
            const index = lancamentos.findIndex(l => l.id === lancamento.id);
            
            if (index === -1) {
                throw new Error(`Lançamento com ID "${lancamento.id}" não encontrado.`);
            }
            
            lancamentos[index] = { ...lancamentos[index], ...lancamento };
            localStorage.setItem('ggomes_lancamentos', JSON.stringify(lancamentos));
            
            AcompanhamentoCache.clear();
            return lancamentos[index];
        },
        
        remove: function(id) {
            const lancamentos = this.getAll();
            const index = lancamentos.findIndex(l => l.id === id);
            
            if (index === -1) {
                throw new Error(`Lançamento com ID "${id}" não encontrado.`);
            }
            
            lancamentos.splice(index, 1);
            localStorage.setItem('ggomes_lancamentos', JSON.stringify(lancamentos));
            
            AcompanhamentoCache.clear();
            return true;
        },
        
        getByFrente: function(frenteId) {
            return this.getAll().filter(l => l.frenteId === frenteId);
        },
        
        getByPeriodo: function(dataInicio, dataFim) {
            return this.getAll().filter(l => l.data >= dataInicio && l.data <= dataFim);
        },
        
        getTotalColhidoPorFrente: function(frenteId, dataInicio, dataFim) {
            const lancamentos = this.getAll().filter(l => 
                l.frenteId === frenteId && 
                l.data >= dataInicio && 
                l.data <= dataFim
            );
            
            return lancamentos.reduce((total, l) => total + Number(l.colhido), 0);
        }
    }
};

// Sistema de notificações
const NotificationManager = {
    add: function(message, type = 'info', duration = 5000) {
        const notification = {
            id: Utils.gerarId('NOT'),
            message,
            type,
            timestamp: new Date().toISOString(),
            read: false
        };
        
        AppConfig.notifications.unshift(notification);
        
        if (AppConfig.notifications.length > 50) {
            AppConfig.notifications = AppConfig.notifications.slice(0, 50);
        }
        
        this.updateBadge();
        Toast.show(message, type, duration);
        
        const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
        config.notifications = AppConfig.notifications;
        localStorage.setItem('ggomes_config', JSON.stringify(config));
    },
    
    markAsRead: function(id) {
        const notification = AppConfig.notifications.find(n => n.id === id);
        if (notification) {
            notification.read = true;
            this.updateBadge();
        }
    },
    
    markAllAsRead: function() {
        AppConfig.notifications.forEach(n => n.read = true);
        this.updateBadge();
    },
    
    clear: function() {
        AppConfig.notifications = [];
        this.updateBadge();
        
        const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
        config.notifications = [];
        localStorage.setItem('ggomes_config', JSON.stringify(config));
    },
    
    updateBadge: function() {
        const unreadCount = AppConfig.notifications.filter(n => !n.read).length;
        const badge = document.getElementById('notification-badge');
        
        if (badge) {
            if (unreadCount > 0) {
                badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }
    },
    
    load: function() {
        const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
        AppConfig.notifications = config.notifications || [];
        this.updateBadge();
    }
};

// Utilidades
const Utils = {
    formatarToneladas: function(valor) {
        const numero = Number(valor) || 0;
        return numero.toLocaleString('pt-BR', { 
            minimumFractionDigits: 1, 
            maximumFractionDigits: 1 
        }) + ' T';
    },
    
    formatarData: function(dataStr) {
        if (!dataStr) return '--/--/----';
        
        try {
            const data = new Date(dataStr);
            return data.toLocaleDateString('pt-BR');
        } catch (error) {
            return '--/--/----';
        }
    },
    
    formatarDataHora: function(dataStr) {
        if (!dataStr) return '--/--/---- --:--';
        
        try {
            const data = new Date(dataStr);
            return data.toLocaleString('pt-BR');
        } catch (error) {
            return '--/--/---- --:--';
        }
    },
    
    gerarId: function(prefixo = 'ID') {
        return `${prefixo}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
    },
    
    getStatusConfig: function(status) {
        const configs = {
            'aberto': { 
                texto: 'Aberto', 
                cor: 'green', 
                bg: 'bg-green-100 dark:bg-green-900', 
                text: 'text-green-700 dark:text-green-300',
                icon: 'fa-play-circle'
            },
            'fechado': { 
                texto: 'Fechado', 
                cor: 'blue', 
                bg: 'bg-blue-100 dark:bg-blue-900', 
                text: 'text-blue-700 dark:text-blue-300',
                icon: 'fa-check-circle'
            },
            'em-andamento': { 
                texto: 'Em Andamento', 
                cor: 'yellow', 
                bg: 'bg-yellow-100 dark:bg-yellow-900', 
                text: 'text-yellow-700 dark:text-yellow-300',
                icon: 'fa-clock'
            },
            'cancelado': { 
                texto: 'Cancelado', 
                cor: 'red', 
                bg: 'bg-red-100 dark:bg-red-900', 
                text: 'text-red-700 dark:text-red-300',
                icon: 'fa-times-circle'
            },
            'ativa': { 
                texto: 'Ativa', 
                cor: 'green', 
                bg: 'bg-green-100 dark:bg-green-900', 
                text: 'text-green-700 dark:text-green-300',
                icon: 'fa-check-circle'
            },
            'inativa': { 
                texto: 'Inativa', 
                cor: 'red', 
                bg: 'bg-red-100 dark:bg-red-900', 
                text: 'text-red-700 dark:text-red-300',
                icon: 'fa-times-circle'
            },
            'manutencao': { 
                texto: 'Manutenção', 
                cor: 'yellow', 
                bg: 'bg-yellow-100 dark:bg-yellow-900', 
                text: 'text-yellow-700 dark:text-yellow-300',
                icon: 'fa-tools'
            }
        };
        
        return configs[status] || { 
            texto: status || 'Desconhecido', 
            cor: 'gray', 
            bg: 'bg-gray-100 dark:bg-gray-900', 
            text: 'text-gray-700 dark:text-gray-300',
            icon: 'fa-question-circle'
        };
    },
    
    getTipoConfig: function(tipo) {
        const configs = {
            'propria': {
                texto: 'Própria',
                cor: 'blue',
                bg: 'bg-blue-100 dark:bg-blue-900',
                text: 'text-blue-700 dark:text-blue-300',
                icon: 'fa-home'
            },
            'terceira': {
                texto: 'Terceira',
                cor: 'orange',
                bg: 'bg-orange-100 dark:bg-orange-900',
                text: 'text-orange-700 dark:text-orange-300',
                icon: 'fa-handshake'
            },
            'desconhecido': {
                texto: 'Desconhecido',
                cor: 'gray',
                bg: 'bg-gray-100 dark:bg-gray-900',
                text: 'text-gray-700 dark:text-gray-300',
                icon: 'fa-question-circle'
            }
        };
        
        return configs[tipo] || {
            texto: tipo || 'Desconhecido',
            cor: 'gray',
            bg: 'bg-gray-100 dark:bg-gray-900',
            text: 'text-gray-700 dark:text-gray-300',
            icon: 'fa-question-circle'
        };
    },
    
    showLoading: function(show = true) {
        const overlay = document.getElementById('loading-overlay');
        if (overlay) {
            if (show) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }
    },
    
    exportarPDF: function(titulo, dados, colunas, nomeArquivo) {
        if (!window.jspdf || !window.jspdf.jsPDF) {
            Toast.show('Biblioteca PDF não carregada', 'error');
            return;
        }
        
        if (!dados || !dados.length) {
            Toast.show('Não há dados para exportar', 'error');
            return;
        }
        
        try {
            this.showLoading(true);
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text(titulo, 14, 22);
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 14, 30);
            doc.text(`Sistema: GGOMES-LOG v${AppConfig.version}`, 14, 35);
            
            doc.autoTable({
                head: [colunas.map(col => col.header)],
                body: dados.map(item => colunas.map(col => {
                    if (typeof col.dataKey === 'function') {
                        return col.dataKey(item);
                    }
                    return item[col.dataKey] || '';
                })),
                startY: 42,
                theme: 'grid',
                styles: {
                    fontSize: 8,
                    cellPadding: 3,
                    lineColor: [200, 200, 200],
                    lineWidth: 0.1
                },
                headStyles: {
                    fillColor: [93, 92, 222],
                    textColor: [255, 255, 255],
                    fontStyle: 'bold',
                    fontSize: 9
                },
                alternateRowStyles: {
                    fillColor: [248, 249, 250]
                }
            });
            
            const pageCount = doc.internal.getNumberOfPages();
            for(let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.text(
                    `Página ${i} de ${pageCount} - GGOMES-LOG Sistema de Gestão Agrícola`, 
                    doc.internal.pageSize.width / 2, 
                    doc.internal.pageSize.height - 10, 
                    { align: 'center' }
                );
            }
            
            doc.save(nomeArquivo || 'relatorio.pdf');
            
            Toast.show('Relatório PDF gerado com sucesso', 'success');
        } catch (error) {
            console.error('Erro ao gerar PDF:', error);
            Toast.show('Erro ao gerar PDF: ' + error.message, 'error');
        } finally {
            this.showLoading(false);
        }
    },

    getNomeFrente: function(frenteId) {
        const frente = DB.frentes.get(frenteId);
        return frente ? frente.nome : 'Frente não encontrada';
    },

    getStatusMeta: function(progresso) {
        if (progresso >= 100) return { texto: 'Atingida', cor: 'green' };
        if (progresso >= 80) return { texto: 'Próximo', cor: 'yellow' };
        if (progresso >= 50) return { texto: 'Progresso', cor: 'blue' };
        return { texto: 'Abaixo', cor: 'red' };
    },
    
    debounce: function(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    },
    
    validateForm: function(formElement) {
        const inputs = formElement.querySelectorAll('input[required], select[required], textarea[required]');
        let isValid = true;
        
        inputs.forEach(input => {
            const feedback = input.parentNode.querySelector('.invalid-feedback');
            
            if (!input.value.trim()) {
                input.classList.add('form-error');
                if (feedback) {
                    feedback.textContent = 'Este campo é obrigatório';
                    feedback.classList.remove('hidden');
                }
                isValid = false;
            } else {
                input.classList.remove('form-error');
                input.classList.add('form-success');
                if (feedback) {
                    feedback.classList.add('hidden');
                }
            }
        });
        
        return isValid;
    },
    
    clearFormValidation: function(formElement) {
        const inputs = formElement.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.classList.remove('form-error', 'form-success');
            const feedback = input.parentNode.querySelector('.invalid-feedback');
            if (feedback) {
                feedback.classList.add('hidden');
            }
        });
    }
};

// Sistema de gráficos MELHORADO
const ChartManager = {
    init: function() {
        if (window.Chart) {
            Chart.defaults.color = document.documentElement.classList.contains('dark') ? '#e5e7eb' : '#374151';
            Chart.defaults.borderColor = document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb';
            Chart.defaults.backgroundColor = document.documentElement.classList.contains('dark') ? '#1f2937' : '#ffffff';
        }
    },
    
    // Gráfico de Evolução da Colheita (novo)
    createEvolucaoColheitaChart: function() {
        const ctx = document.getElementById('chart-evolucao-colheita');
        if (!ctx || !window.Chart) return;
        
        const lancamentos = DB.lancamentos.getAll();
        const metas = DB.metas.getAll();
        
        // Últimos 30 dias
        const hoje = new Date();
        const dataInicial = new Date(hoje.getTime() - 30 * 24 * 60 * 60 * 1000);
        
        const labels = [];
        const dataColhido = [];
        const dataMetas = [];
        
        for (let i = 0; i < 30; i++) {
            const data = new Date(dataInicial.getTime() + i * 24 * 60 * 60 * 1000);
            const dataStr = data.toISOString().split('T')[0];
            
            labels.push(data.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }));
            
            // Calcular total colhido do dia
            const colhidoDia = lancamentos
                .filter(l => l.data === dataStr)
                .reduce((sum, l) => sum + Number(l.colhido), 0);
            
            dataColhido.push(colhidoDia);
            
            // Calcular meta do dia
            const metaDia = metas
                .filter(m => m.dataInicio <= dataStr && m.dataFim >= dataStr)
                .reduce((sum, m) => sum + Number(m.valor), 0);
            
            dataMetas.push(metaDia);
        }
        
        const data = {
            labels: labels,
            datasets: [
                {
                    label: 'Colhido',
                    data: dataColhido,
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    fill: true,
                    tension: 0.4
                },
                {
                    label: 'Meta',
                    data: dataMetas,
                    borderColor: '#f59e0b',
                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                    borderDash: [5, 5],
                    fill: false
                }
            ]
        };
        
        AppConfig.charts.evolucaoColheitaChart = new Chart(ctx, {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${Utils.formatarToneladas(context.parsed.y)}`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return Utils.formatarToneladas(value);
                            }
                        }
                    }
                },
                interaction: {
                    mode: 'nearest',
                    axis: 'x',
                    intersect: false
                }
            }
        });
    },
    
    // Gráfico de Performance das Frentes (novo)
    createPerformanceFrentesChart: function() {
        const ctx = document.getElementById('chart-performance-frentes');
        if (!ctx || !window.Chart) return;
        
        const frentes = DB.frentes.getAll();
        const metas = DB.metas.getAll();
        const lancamentos = DB.lancamentos.getAll();
        
        const dados = frentes.map(frente => {
            const metasFrente = metas.filter(m => m.frenteId === frente.id);
            const lancamentosFrente = lancamentos.filter(l => l.frenteId === frente.id);
            
            const totalMeta = metasFrente.reduce((sum, m) => sum + Number(m.valor), 0);
            const totalColhido = lancamentosFrente.reduce((sum, l) => sum + Number(l.colhido), 0);
            
            const percentual = totalMeta > 0 ? (totalColhido / totalMeta) * 100 : 0;
            
            return {
                nome: frente.nome,
                percentual: percentual,
                cor: frente.tipo === 'propria' ? '#3b82f6' : '#f97316'
            };
        }).sort((a, b) => b.percentual - a.percentual);
        
        if (dados.length === 0) {
            ctx.parentNode.innerHTML = '<div class="flex items-center justify-center h-80 text-gray-500">Sem dados para exibir</div>';
            return;
        }
        
        const data = {
            labels: dados.map(d => d.nome),
            datasets: [{
                data: dados.map(d => d.percentual),
                backgroundColor: dados.map(d => d.cor),
                borderWidth: 1,
                borderColor: '#ffffff'
            }]
        };
        
        AppConfig.charts.performanceFrentesChart = new Chart(ctx, {
            type: 'bar',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.parsed.x.toFixed(1)}% da meta`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        max: 150,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            }
        });
    },
    
    // Gráfico de Eficiência por Turno (novo)
    createEficienciaTurnoChart: function() {
        const ctx = document.getElementById('chart-eficiencia-turno');
        if (!ctx || !window.Chart) return;
        
        const lancamentos = DB.lancamentos.getAll();
        
        const eficienciaTurno = {
            manha: { total: 0, count: 0 },
            tarde: { total: 0, count: 0 },
            noite: { total: 0, count: 0 }
        };
        
        lancamentos.forEach(l => {
            if (eficienciaTurno[l.turno]) {
                eficienciaTurno[l.turno].total += Number(l.colhido);
                eficienciaTurno[l.turno].count++;
            }
        });
        
        const dados = Object.keys(eficienciaTurno).map(turno => {
            const media = eficienciaTurno[turno].count > 0 ? 
                eficienciaTurno[turno].total / eficienciaTurno[turno].count : 0;
            return {
                turno: turno.charAt(0).toUpperCase() + turno.slice(1),
                media: media
            };
        });
        
        const data = {
            labels: dados.map(d => d.turno),
            datasets: [{
                data: dados.map(d => d.media),
                backgroundColor: ['#f59e0b', '#3b82f6', '#8b5cf6'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        };
        
        AppConfig.charts.eficienciaTurnoChart = new Chart(ctx, {
            type: 'doughnut',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { padding: 20, usePointStyle: true }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${Utils.formatarToneladas(context.parsed)} (média)`;
                            }
                        }
                    }
                }
            }
        });
    },
    
    createStatusChart: function() {
        const ctx = document.getElementById('chart-liberacoes-status');
        if (!ctx || !window.Chart) return;
        
        const liberacoes = DB.liberacoes.getAll();
        const statusCounts = {};
        
        liberacoes.forEach(lib => {
            statusCounts[lib.status] = (statusCounts[lib.status] || 0) + 1;
        });
        
        if (Object.keys(statusCounts).length === 0) {
            ctx.parentNode.innerHTML = '<div class="flex items-center justify-center h-48 text-gray-500">Sem dados para exibir</div>';
            return;
        }
        
        const data = {
            labels: Object.keys(statusCounts).map(status => Utils.getStatusConfig(status).texto),
            datasets: [{
                data: Object.values(statusCounts),
                backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        };
        
        AppConfig.charts.statusChart = new Chart(ctx, {
            type: 'doughnut',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { padding: 20, usePointStyle: true }
                    }
                }
            }
        });
    },
    
    createMetasTipoChart: function() {
        const ctx = document.getElementById('chart-metas-tipo');
        if (!ctx || !window.Chart) return;
        
        const metas = DB.metas.getAll();
        const metasProprias = metas.filter(m => m.tipo === 'propria').length;
        const metasTerceiras = metas.filter(m => m.tipo === 'terceira').length;
        
        if (metasProprias === 0 && metasTerceiras === 0) {
            ctx.parentNode.innerHTML = '<div class="flex items-center justify-center h-48 text-gray-500">Sem dados para exibir</div>';
            return;
        }
        
        const data = {
            labels: ['Metas Próprias', 'Metas Terceiras'],
            datasets: [{
                data: [metasProprias, metasTerceiras],
                backgroundColor: ['#3b82f6', '#f97316'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        };
        
        AppConfig.charts.metasTipoChart = new Chart(ctx, {
            type: 'pie',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { padding: 20, usePointStyle: true }
                    }
                }
            }
        });
    },
    
    updateCharts: function() {
        // Destruir gráficos existentes
        Object.values(AppConfig.charts).forEach(chart => {
            if (chart && chart.destroy) {
                chart.destroy();
            }
        });
        AppConfig.charts = {};
        
        // Recriar gráficos
        this.createEvolucaoColheitaChart();
        this.createPerformanceFrentesChart();
        this.createEficienciaTurnoChart();
        this.createStatusChart();
        this.createMetasTipoChart();
    }
};

// Sistema de paginação
const PaginationManager = {
    create: function(containerId, totalPages, currentPage, onPageChange) {
        const container = document.getElementById(containerId);
        if (!container || totalPages <= 1) {
            if (container) container.innerHTML = '';
            return;
        }
        
        let paginationHTML = `
            <div class="flex items-center justify-between">
                <div class="text-sm text-gray-700 dark:text-gray-300">
                    Página ${currentPage} de ${totalPages}
                </div>
                <div class="flex items-center space-x-1">
        `;
        
        paginationHTML += `
            <button class="pagination-btn px-3 py-1 text-sm rounded-md ${currentPage === 1 ? 'opacity-50 cursor-not-allowed' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}" 
                    data-page="${currentPage - 1}" ${currentPage === 1 ? 'disabled' : ''}>
                <i class="fas fa-chevron-left"></i>
            </button>
        `;
        
        const showPages = Math.min(5, totalPages);
        const startPage = Math.max(1, currentPage - Math.floor(showPages / 2));
        const endPage = Math.min(totalPages, startPage + showPages - 1);
        
        for (let i = startPage; i <= endPage; i++) {
            paginationHTML += `
                <button class="pagination-btn px-3 py-1 text-sm rounded-md ${i === currentPage ? 'bg-primary-600 text-white' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}" 
                        data-page="${i}">
                    ${i}
                </button>
            `;
        }
        
        paginationHTML += `
            <button class="pagination-btn px-3 py-1 text-sm rounded-md ${currentPage === totalPages ? 'opacity-50 cursor-not-allowed' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}" 
                    data-page="${currentPage + 1}" ${currentPage === totalPages ? 'disabled' : ''}>
                <i class="fas fa-chevron-right"></i>
            </button>
        `;
        
        paginationHTML += `
                </div>
            </div>
        `;
        
        container.innerHTML = paginationHTML;
        
        container.querySelectorAll('.pagination-btn:not([disabled])').forEach(btn => {
            btn.addEventListener('click', () => {
                const page = parseInt(btn.getAttribute('data-page'));
                if (page >= 1 && page <= totalPages) {
                    onPageChange(page);
                }
            });
        });
    }
};

// VARIÁVEIS GLOBAIS DE CONTROLE
let currentLiberacoesPage = 1;
let currentLiberacoesSort = { field: 'data', direction: 'desc' };

// ===== FUNCÕES AVANÇADAS DE ACOMPANHAMENTO =====

function obterFiltrosAcompanhamento() {
    const hoje = new Date();
    const dataFimPadrao = hoje.toISOString().split('T')[0];
    const dataInicioPadrao = new Date(hoje.getTime() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
    
    return {
        frenteId: document.getElementById('filtro-acompanhamento-frente')?.value || '',
        tipo: document.getElementById('filtro-acompanhamento-tipo')?.value || '',
        dataInicio: document.getElementById('filtro-acompanhamento-data-inicio')?.value || dataInicioPadrao,
        dataFim: document.getElementById('filtro-acompanhamento-data-fim')?.value || dataFimPadrao,
        incluirInativos: document.getElementById('filtro-incluir-inativos')?.checked || false
    };
}

function calcularDadosAcompanhamento(filtros) {
    // Obter frentes com filtros aplicados
    let frentes = DB.frentes.getAll();
    
    if (filtros.frenteId) {
        frentes = frentes.filter(f => f.id === filtros.frenteId);
    }
    
    if (filtros.tipo) {
        frentes = frentes.filter(f => f.tipo === filtros.tipo);
    }
    
    if (!filtros.incluirInativos) {
        frentes = frentes.filter(f => f.status === 'ativa');
    }
    
    // Cache para metas e lançamentos
    const todasMetas = DB.metas.getAll();
    const todosLancamentos = DB.lancamentos.getAll();
    
    const resumo = {
        metasProprias: 0,
        metasTerceiras: 0,
        frentesDesconhecidas: 0,
        totalColhido: 0,
        totalMeta: 0,
        percentualMeta: 0,
        mediaDesempenho: 0,
        frentesAcimaMeta: 0,
        frentesAbaixoMeta: 0,
        tendencia: 'estavel'
    };
    
    const dadosAcompanhamento = frentes.map(frente => {
        const metasFrente = todasMetas.filter(m => 
            m.frenteId === frente.id &&
            new Date(m.dataInicio) <= new Date(filtros.dataFim) &&
            new Date(m.dataFim) >= new Date(filtros.dataInicio)
        );
        
        const lancamentosFrente = todosLancamentos.filter(l => 
            l.frenteId === frente.id &&
            l.data >= filtros.dataInicio &&
            l.data <= filtros.dataFim
        );
        
        // Cálculos básicos
        const metaTotal = metasFrente.reduce((sum, m) => sum + Number(m.valor), 0);
        const colhidoTotal = lancamentosFrente.reduce((sum, l) => sum + Number(l.colhido), 0);
        const restante = Math.max(0, metaTotal - colhidoTotal);
        const percentualMeta = metaTotal > 0 ? (colhidoTotal / metaTotal) * 100 : 0;
        
        // Cálculos avançados
        const mediaColheitaDiaria = calcularMediaColheitaDiaria(lancamentosFrente, filtros);
        const diasRestantes = calcularDiasRestantes(filtros.dataFim);
        const projecaoFinal = colhidoTotal + (mediaColheitaDiaria * diasRestantes);
        const projecaoPercentual = metaTotal > 0 ? (projecaoFinal / metaTotal) * 100 : 0;
        
        // Tendência
        const tendencia = calcularTendenciaFrente(lancamentosFrente);
        
        // Eficiência
        const eficiencia = calcularEficienciaFrente(metasFrente, lancamentosFrente, filtros);
        
        // Status avançado
        const statusAvancado = calcularStatusAvancado(percentualMeta, tendencia, eficiencia);
        
        // Contadores para resumo
        switch(frente.tipo) {
            case 'propria': resumo.metasProprias++; break;
            case 'terceira': resumo.metasTerceiras++; break;
            case 'desconhecido': resumo.frentesDesconhecidas++; break;
        }
        
        resumo.totalColhido += colhidoTotal;
        resumo.totalMeta += metaTotal;
        
        if (percentualMeta >= 100) resumo.frentesAcimaMeta++;
        else resumo.frentesAbaixoMeta++;
        
        return {
            frente: frente,
            metaTotal: metaTotal,
            colhidoTotal: colhidoTotal,
            restante: restante,
            percentualMeta: percentualMeta,
            mediaColheitaDiaria: mediaColheitaDiaria,
            projecaoFinal: projecaoFinal,
            projecaoPercentual: projecaoPercentual,
            tendencia: tendencia,
            eficiencia: eficiencia,
            statusAvancado: statusAvancado,
            ultimoLancamento: obterUltimoLancamento(lancamentosFrente),
            diasSemColheita: calcularDiasSemColheita(lancamentosFrente)
        };
    });
    
    // Finalizar cálculos do resumo
    resumo.percentualMeta = resumo.totalMeta > 0 ? (resumo.totalColhido / resumo.totalMeta) * 100 : 0;
    resumo.mediaDesempenho = dadosAcompanhamento.length > 0 ? 
        dadosAcompanhamento.reduce((sum, d) => sum + d.percentualMeta, 0) / dadosAcompanhamento.length : 0;
    resumo.tendencia = calcularTendenciaGeral(dadosAcompanhamento);
    
    return { resumo, dados: dadosAcompanhamento };
}

function calcularMediaColheitaDiaria(lancamentos, filtros) {
    if (lancamentos.length === 0) return 0;
    
    const diasPeriodo = calcularDiasEntreDatas(filtros.dataInicio, filtros.dataFim);
    const totalColhido = lancamentos.reduce((sum, l) => sum + Number(l.colhido), 0);
    
    return diasPeriodo > 0 ? totalColhido / diasPeriodo : 0;
}

function calcularDiasRestantes(dataFim) {
    const hoje = new Date();
    const fim = new Date(dataFim);
    const diffTime = fim - hoje;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    return Math.max(0, diffDays);
}

function calcularDiasEntreDatas(dataInicio, dataFim) {
    const inicio = new Date(dataInicio);
    const fim = new Date(dataFim);
    const diffTime = fim - inicio;
    return Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
}

function calcularTendenciaFrente(lancamentos) {
    if (lancamentos.length < 3) return { texto: 'Insuficiente', cor: 'gray', icon: 'fa-minus' };
    
    const lancamentosOrdenados = lancamentos
        .sort((a, b) => new Date(a.data) - new Date(b.data))
        .slice(-7); // Últimos 7 dias
    
    if (lancamentosOrdenados.length < 2) return { texto: 'Insuficiente', cor: 'gray', icon: 'fa-minus' };
    
    const primeira = lancamentosOrdenados.slice(0, Math.ceil(lancamentosOrdenados.length / 2));
    const segunda = lancamentosOrdenados.slice(Math.ceil(lancamentosOrdenados.length / 2));
    
    const mediaPrimeira = primeira.reduce((sum, l) => sum + Number(l.colhido), 0) / primeira.length;
    const mediaSegunda = segunda.reduce((sum, l) => sum + Number(l.colhido), 0) / segunda.length;
    
    const diferenca = ((mediaSegunda - mediaPrimeira) / mediaPrimeira) * 100;
    
    if (diferenca > 10) return { texto: 'Crescendo', cor: 'green', icon: 'fa-arrow-up' };
    if (diferenca < -10) return { texto: 'Declinando', cor: 'red', icon: 'fa-arrow-down' };
    return { texto: 'Estável', cor: 'yellow', icon: 'fa-minus' };
}

function calcularEficienciaFrente(metas, lancamentos, filtros) {
    if (metas.length === 0) return 0;
    
    const diasPeriodo = calcularDiasEntreDatas(filtros.dataInicio, filtros.dataFim);
    const metaDiaria = metas.reduce((sum, m) => sum + Number(m.valor), 0) / diasPeriodo;
    const colheitaDiaria = lancamentos.reduce((sum, l) => sum + Number(l.colhido), 0) / Math.max(1, lancamentos.length);
    
    return metaDiaria > 0 ? (colheitaDiaria / metaDiaria) * 100 : 0;
}

function calcularStatusAvancado(percentual, tendencia, eficiencia) {
    if (percentual >= 100) {
        return { texto: 'Meta Atingida', cor: 'green', icon: 'fa-check-circle', prioridade: 1 };
    } else if (percentual >= 90) {
        return { texto: 'Próximo à Meta', cor: 'blue', icon: 'fa-bullseye', prioridade: 2 };
    } else if (percentual >= 70 && tendencia.cor === 'green') {
        return { texto: 'Em Progresso', cor: 'yellow', icon: 'fa-chart-line', prioridade: 3 };
    } else if (percentual >= 50) {
        return { texto: 'Atenção', cor: 'orange', icon: 'fa-exclamation-triangle', prioridade: 4 };
    } else {
        return { texto: 'Crítico', cor: 'red', icon: 'fa-exclamation-circle', prioridade: 5 };
    }
}

function obterUltimoLancamento(lancamentos) {
    if (lancamentos.length === 0) return null;
    return lancamentos.sort((a, b) => new Date(b.data) - new Date(a.data))[0];
}

function calcularDiasSemColheita(lancamentos) {
    if (lancamentos.length === 0) return -1;
    
    const ultimoLancamento = obterUltimoLancamento(lancamentos);
    if (!ultimoLancamento) return -1;
    
    const hoje = new Date();
    const ultimaData = new Date(ultimoLancamento.data);
    const diffTime = hoje - ultimaData;
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
    
    return diffDays;
}

function calcularTendenciaGeral(dados) {
    if (dados.length === 0) return 'estavel';
    
    const tendenciasPositivas = dados.filter(d => d.tendencia.cor === 'green').length;
    const tendenciasNegativas = dados.filter(d => d.tendencia.cor === 'red').length;
    
    if (tendenciasPositivas > tendenciasNegativas) return 'crescendo';
    if (tendenciasNegativas > tendenciasPositivas) return 'declinando';
    return 'estavel';
}

function mostrarLoadingAcompanhamento(show) {
    const container = document.getElementById('tabela-acompanhamento');
    const resumoContainer = document.querySelector('#tab-acompanhamento .grid');
    
    if (show) {
        if (container) {
            container.innerHTML = `
                <tr>
                    <td colspan="10" class="px-4 py-8 text-center">
                        <div class="flex items-center justify-center space-x-3">
                            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"></div>
                            <span class="text-gray-700 dark:text-gray-300">Calculando dados avançados...</span>
                        </div>
                    </td>
                </tr>
            `;
        }
        
        if (resumoContainer) {
            resumoContainer.style.opacity = '0.6';
        }
    } else {
        if (resumoContainer) {
            resumoContainer.style.opacity = '1';
        }
        
        // Atualizar timestamp
        const timestampElement = document.getElementById('ultima-atualizacao');
        if (timestampElement) {
            timestampElement.textContent = new Date().toLocaleTimeString('pt-BR');
        }
    }
}

function renderizarAcompanhamento(resumo, dados) {
    renderizarResumoAcompanhamento(resumo);
    renderizarTabelaAcompanhamento(dados);
}

function renderizarResumoAcompanhamento(resumo) {
    // Cards básicos
    document.getElementById('resumo-metas-proprias-ativas').textContent = resumo.metasProprias;
    document.getElementById('resumo-metas-terceiras-ativas').textContent = resumo.metasTerceiras;
    document.getElementById('resumo-total-colhido').textContent = Utils.formatarToneladas(resumo.totalColhido);
    document.getElementById('resumo-total-meta').textContent = Utils.formatarToneladas(resumo.totalMeta);
    document.getElementById('resumo-percentual-meta').textContent = resumo.percentualMeta.toFixed(1) + '%';
    
    // Atualizar cores dos cards baseado na performance
    const cardPercentual = document.getElementById('resumo-percentual-meta').parentElement;
    if (cardPercentual) {
        cardPercentual.className = cardPercentual.className.replace(/text-(green|yellow|red)-\d+/, '');
        if (resumo.percentualMeta >= 100) {
            cardPercentual.querySelector('div').classList.add('text-green-600', 'dark:text-green-400');
        } else if (resumo.percentualMeta >= 80) {
            cardPercentual.querySelector('div').classList.add('text-yellow-600', 'dark:text-yellow-400');
        } else {
            cardPercentual.querySelector('div').classList.add('text-red-600', 'dark:text-red-400');
        }
    }
    
    // Adicionar informações de tendência
    const tendenciaInfo = document.getElementById('resumo-tendencia-info');
    if (tendenciaInfo) {
        const iconeTendencia = resumo.tendencia === 'crescendo' ? 'fa-arrow-up text-green-500' :
                             resumo.tendencia === 'declinando' ? 'fa-arrow-down text-red-500' :
                             'fa-minus text-yellow-500';
        
        tendenciaInfo.innerHTML = `
            <i class="fas ${iconeTendencia} mr-1"></i>
            ${resumo.tendencia.charAt(0).toUpperCase() + resumo.tendencia.slice(1)}
        `;
    }
}

function renderizarTabelaAcompanhamento(dados) {
    const tabelaElement = document.getElementById('tabela-acompanhamento');
    if (!tabelaElement) return;
    
    tabelaElement.innerHTML = '';
    
    if (dados.length === 0) {
        tabelaElement.innerHTML = `
            <tr>
                <td colspan="10" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                    <i class="fas fa-chart-line text-3xl mb-2"></i>
                    <p>Nenhuma frente encontrada</p>
                    <p class="text-sm">Ajuste os filtros para visualizar dados</p>
                </td>
            </tr>
        `;
        return;
    }
    
    // Ordenar dados
    const dadosOrdenados = [...dados].sort((a, b) => {
        const field = currentAcompanhamentoSort.field;
        let aVal = field === 'nome' ? a.frente.nome : a[field];
        let bVal = field === 'nome' ? b.frente.nome : b[field];
        
        if (typeof aVal === 'number' && typeof bVal === 'number') {
            return currentAcompanhamentoSort.direction === 'asc' ? aVal - bVal : bVal - aVal;
        }
        
        if (aVal < bVal) return currentAcompanhamentoSort.direction === 'asc' ? -1 : 1;
        if (aVal > bVal) return currentAcompanhamentoSort.direction === 'asc' ? 1 : -1;
        return 0;
    });
    
    dadosOrdenados.forEach(item => {
        const tipoConfig = Utils.getTipoConfig(item.frente.tipo);
        const statusConfig = item.statusAvancado;
        const tendenciaConfig = item.tendencia;
        
        // Alertas visuais
        const alertas = [];
        if (item.diasSemColheita > 3) alertas.push('Sem colheita há ' + item.diasSemColheita + ' dias');
        if (item.percentualMeta < 50) alertas.push('Muito abaixo da meta');
        if (item.eficiencia < 70) alertas.push('Baixa eficiência');
        
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
        row.innerHTML = `
            <td class="px-4 py-3 text-sm">
                <div class="flex items-center">
                    <div>
                        <div class="font-medium text-gray-900 dark:text-gray-100">${item.frente.nome}</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">${item.frente.fazenda}</div>
                        ${alertas.length > 0 ? `<div class="text-xs text-red-500 mt-1 alert-pulse"><i class="fas fa-exclamation-triangle mr-1"></i>${alertas[0]}</div>` : ''}
                    </div>
                </div>
            </td>
            <td class="px-4 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${tipoConfig.bg} ${tipoConfig.text}">
                    <i class="fas ${tipoConfig.icon} mr-1"></i>
                    ${tipoConfig.texto}
                </span>
            </td>
            <td class="px-4 py-3 text-center text-sm font-medium text-gray-900 dark:text-gray-100">
                <div class="tooltip">
                    <div>${Utils.formatarToneladas(item.metaTotal)}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">${item.mediaColheitaDiaria.toFixed(1)}T/dia</div>
                    <span class="tooltiptext">Média diária de colheita estimada baseada no histórico</span>
                </div>
            </td>
            <td class="px-4 py-3 text-center text-sm font-medium text-green-600 dark:text-green-400">
                <div class="tooltip">
                    <div>${Utils.formatarToneladas(item.colhidoTotal)}</div>
                    ${item.ultimoLancamento ? `<div class="text-xs text-gray-500 dark:text-gray-400">Último: ${Utils.formatarData(item.ultimoLancamento.data)}</div>` : ''}
                    <span class="tooltiptext">Total colhido no período selecionado</span>
                </div>
            </td>
            <td class="px-4 py-3 text-center text-sm font-medium text-red-600 dark:text-red-400">
                <div class="tooltip">
                    <div>${Utils.formatarToneladas(item.restante)}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">Proj: ${Utils.formatarToneladas(item.projecaoFinal)}</div>
                    <span class="tooltiptext">Projeção baseada na média atual de colheita</span>
                </div>
            </td>
            <td class="px-4 py-3 text-center text-sm font-bold ${item.percentualMeta >= 100 ? 'text-green-600' : item.percentualMeta >= 80 ? 'text-yellow-600' : 'text-red-600'}">
                <div class="tooltip">
                    <div>${item.percentualMeta.toFixed(1)}%</div>
                    <div class="text-xs font-normal text-gray-500 dark:text-gray-400">Proj: ${item.projecaoPercentual.toFixed(0)}%</div>
                    <span class="tooltiptext">Percentual atual da meta atingida e projeção de finalização</span>
                </div>
            </td>
            <td class="px-4 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${statusConfig.cor}-100 dark:bg-${statusConfig.cor}-900 text-${statusConfig.cor}-700 dark:text-${statusConfig.cor}-300">
                    <i class="fas ${statusConfig.icon} mr-1"></i>
                    ${statusConfig.texto}
                </span>
            </td>
            <td class="px-4 py-3 text-center">
                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-${tendenciaConfig.cor}-100 dark:bg-${tendenciaConfig.cor}-900 text-${tendenciaConfig.cor}-700 dark:text-${tendenciaConfig.cor}-300 tooltip">
                    <i class="fas ${tendenciaConfig.icon} mr-1"></i>
                    ${tendenciaConfig.texto}
                    <span class="tooltiptext">Tendência calculada baseada nos últimos 7 dias</span>
                </span>
            </td>
            <td class="px-4 py-3 text-center">
                <div class="tooltip">
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 mb-1">
                        <div class="progress-bar progress-bar-animated bg-gradient-to-r ${item.percentualMeta >= 100 ? 'from-green-500 to-green-600' : item.percentualMeta >= 80 ? 'from-yellow-500 to-yellow-600' : 'from-red-500 to-red-600'} h-3 rounded-full relative" style="width: ${Math.min(item.percentualMeta, 100)}%">
                            ${item.percentualMeta >= 100 ? '<div class="absolute inset-0 bg-green-500 rounded-full animate-pulse"></div>' : ''}
                        </div>
                    </div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">Eficiência: ${item.eficiencia.toFixed(0)}%</div>
                    <span class="tooltiptext">Eficiência de colheita em relação à meta diária estabelecida</span>
                </div>
            </td>
            <td class="px-4 py-3 text-center">
                <div class="flex items-center justify-center space-x-1">
                    <button class="btn-detalhes-frente tooltip p-2 text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition-all-300" data-id="${item.frente.id}" title="Ver Detalhes">
                        <i class="fas fa-eye"></i>
                        <span class="tooltiptext">Ver detalhes completos da frente</span>
                    </button>
                    <button class="btn-relatorio-frente tooltip p-2 text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-200 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-md transition-all-300" data-id="${item.frente.id}" title="Relatório">
                        <i class="fas fa-file-pdf"></i>
                        <span class="tooltiptext">Gerar relatório em PDF da frente</span>
                    </button>
                </div>
            </td>
        `;
        
        tabelaElement.appendChild(row);
    });
}

function configurarEventosTabela() {
    // Eventos de detalhes e relatórios
    document.querySelectorAll('.btn-detalhes-frente').forEach(button => {
        button.addEventListener('click', function() {
            mostrarDetalhesFrente(this.getAttribute('data-id'));
        });
    });
    
    document.querySelectorAll('.btn-relatorio-frente').forEach(button => {
        button.addEventListener('click', function() {
            gerarRelatorioFrente(this.getAttribute('data-id'));
        });
    });
    
    // Eventos de ordenação
    document.querySelectorAll('th[data-sort-acompanhamento]').forEach(header => {
        header.addEventListener('click', function() {
            const field = this.getAttribute('data-sort-acompanhamento');
            if (currentAcompanhamentoSort.field === field) {
                currentAcompanhamentoSort.direction = currentAcompanhamentoSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentAcompanhamentoSort.field = field;
                currentAcompanhamentoSort.direction = 'desc';
            }
            
            // Atualizar ícones de ordenação
            document.querySelectorAll('th[data-sort-acompanhamento] i').forEach(icon => {
                icon.className = 'fas fa-sort ml-1';
            });
            
            const currentIcon = this.querySelector('i');
            if (currentIcon) {
                currentIcon.className = `fas fa-sort-${currentAcompanhamentoSort.direction === 'asc' ? 'up' : 'down'} ml-1`;
            }
            
            // Invalidar cache e re-renderizar
            AcompanhamentoCache.clear();
            atualizarAcompanhamento();
        });
    });
}

function atualizarAcompanhamento() {
    const loadingIndicator = mostrarLoadingAcompanhamento(true);
    
    try {
        const filtros = obterFiltrosAcompanhamento();
        
        // Verificar cache
        if (AcompanhamentoCache.isValid(filtros)) {
            const dadosCache = AcompanhamentoCache.get();
            renderizarAcompanhamento(dadosCache.resumo, dadosCache.dados);
            mostrarLoadingAcompanhamento(false);
            return;
        }
        
        // Calcular dados com performance otimizada
        setTimeout(() => {
            try {
                const resultado = calcularDadosAcompanhamento(filtros);
                AcompanhamentoCache.set(resultado, filtros);
                renderizarAcompanhamento(resultado.resumo, resultado.dados);
                configurarEventosTabela();
            } catch (error) {
                console.error('Erro ao calcular dados:', error);
                Toast.show('Erro ao carregar dados de acompanhamento', 'error');
            } finally {
                mostrarLoadingAcompanhamento(false);
            }
        }, 100);
        
    } catch (error) {
        console.error('Erro ao atualizar acompanhamento:', error);
        Toast.show('Erro ao atualizar acompanhamento', 'error');
        mostrarLoadingAcompanhamento(false);
    }
}

function mostrarDetalhesFrente(frenteId) {
    // Funcionalidade em desenvolvimento
    Toast.show('Funcionalidade de detalhes em desenvolvimento', 'info');
}

function gerarRelatorioFrente(frenteId) {
    const frente = DB.frentes.get(frenteId);
    if (!frente) {
        Toast.show('Frente não encontrada', 'error');
        return;
    }
    
    Toast.show(`Gerando relatório detalhado da ${frente.nome}...`, 'info');
    
    try {
        const metas = DB.metas.getAll().filter(m => m.frenteId === frenteId);
        const lancamentos = DB.lancamentos.getAll().filter(l => l.frenteId === frenteId);
        
        const dados = [{
            frente: frente.nome,
            fazenda: frente.fazenda,
            tipo: Utils.getTipoConfig(frente.tipo).texto,
            responsavel: frente.responsavel || '-',
            status: Utils.getStatusConfig(frente.status).texto,
            totalMetas: metas.length,
            totalLancamentos: lancamentos.length,
            totalColhido: Utils.formatarToneladas(lancamentos.reduce((sum, l) => sum + Number(l.colhido), 0)),
            observacoes: frente.observacoes || '-'
        }];
        
        const colunas = [
            { header: 'Frente', dataKey: 'frente' },
            { header: 'Fazenda', dataKey: 'fazenda' },
            { header: 'Tipo', dataKey: 'tipo' },
            { header: 'Responsável', dataKey: 'responsavel' },
            { header: 'Status', dataKey: 'status' },
            { header: 'Total Metas', dataKey: 'totalMetas' },
            { header: 'Total Lançamentos', dataKey: 'totalLancamentos' },
            { header: 'Total Colhido', dataKey: 'totalColhido' },
            { header: 'Observações', dataKey: 'observacoes' }
        ];
        
        Utils.exportarPDF(
            `Relatório Detalhado - ${frente.nome}`,
            dados,
            colunas,
            `relatorio_${frente.nome.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`
        );
        
    } catch (error) {
        Toast.show('Erro ao gerar relatório: ' + error.message, 'error');
    }
}

// ===== DASHBOARD MELHORADO =====

function inicializarDashboard() {
    // Event listener para atualização manual
    document.getElementById('btn-refresh-dashboard')?.addEventListener('click', () => {
        atualizarDashboard();
        Toast.show('Dashboard atualizado', 'success', 2000);
    });
}

function atualizarDashboard() {
    mostrarLoadingDashboard(true);
    
    setTimeout(() => {
        try {
            calcularKPIsAvancados();
            atualizarAlertasCriticos();
            atualizarTopPerformance();
            atualizarAtividadeRecente();
            atualizarResumoExecutivo();
            ChartManager.updateCharts();
            
            // Atualizar timestamp
            document.getElementById('dash-ultima-atualizacao').textContent = 
                'Atualizado às ' + new Date().toLocaleTimeString('pt-BR');
                
        } catch (error) {
            console.error('Erro ao atualizar dashboard:', error);
            Toast.show('Erro ao atualizar dashboard', 'error');
        } finally {
            mostrarLoadingDashboard(false);
        }
    }, 500);
}

function mostrarLoadingDashboard(show) {
    const kpiCards = document.querySelectorAll('#content-dashboard .grid .rounded-lg');
    
    if (show) {
        kpiCards.forEach(card => {
            card.style.opacity = '0.6';
        });
    } else {
        kpiCards.forEach(card => {
            card.style.opacity = '1';
        });
    }
}

function calcularKPIsAvancados() {
    const liberacoes = DB.liberacoes.getAll();
    const frentes = DB.frentes.getAll();
    const metas = DB.metas.getAll();
    const lancamentos = DB.lancamentos.getAll();
    
    // Filtrar últimos 30 dias
    const hoje = new Date();
    const dataInicial = new Date(hoje.getTime() - 30 * 24 * 60 * 60 * 1000);
    const dataInicialStr = dataInicial.toISOString().split('T')[0];
    const hojeStr = hoje.toISOString().split('T')[0];
    
    // Total colhido (30d)
    const totalColhido = lancamentos
        .filter(l => l.data >= dataInicialStr)
        .reduce((sum, l) => sum + Number(l.colhido), 0);
    
    // Meta total para o período
    const metaTotal = metas
        .filter(m => m.dataInicio <= hojeStr && m.dataFim >= dataInicialStr)
        .reduce((sum, m) => sum + Number(m.valor), 0);
    
    // Eficiência geral
    const eficienciaGeral = metaTotal > 0 ? (totalColhido / metaTotal) * 100 : 0;
    
    // Frentes ativas
    const frentesAtivas = frentes.filter(f => f.status === 'ativa');
    const frentesProprias = frentesAtivas.filter(f => f.tipo === 'propria').length;
    const frentesTerceiras = frentesAtivas.filter(f => f.tipo === 'terceira').length;
    
    // Metas atingidas
    const metasAtivas = metas.filter(m => m.dataInicio <= hojeStr && m.dataFim >= hojeStr);
    let metasAtingidas = 0;
    
    metasAtivas.forEach(meta => {
        const lancamentosFrente = lancamentos.filter(l => 
            l.frenteId === meta.frenteId && 
            l.data >= meta.dataInicio && 
            l.data <= meta.dataFim
        );
        const totalColhidoFrente = lancamentosFrente.reduce((sum, l) => sum + Number(l.colhido), 0);
        if (totalColhidoFrente >= Number(meta.valor)) {
            metasAtingidas++;
        }
    });
    
    // Média diária (últimos 7 dias)
    const ultimos7Dias = new Date(hoje.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
    const colhidoUltimos7Dias = lancamentos
        .filter(l => l.data >= ultimos7Dias)
        .reduce((sum, l) => sum + Number(l.colhido), 0);
    const mediaDiaria = colhidoUltimos7Dias / 7;
    
    // Meta diária média
    const metaDiariaMedia = metaTotal / 30;
    
    // Liberações ativas
    const liberacoesAtivas = liberacoes.filter(l => l.status === 'aberto' || l.status === 'em-andamento').length;
    
    // Atualizar interface
    document.getElementById('dash-total-colhido').textContent = Utils.formatarToneladas(totalColhido);
    document.getElementById('dash-colhido-meta').textContent = `Meta: ${Utils.formatarToneladas(metaTotal)}`;
    
    document.getElementById('dash-eficiencia-geral').textContent = eficienciaGeral.toFixed(0) + '%';
    
    document.getElementById('dash-frentes-ativas').textContent = `${frentesAtivas.length}/${frentes.length}`;
    document.getElementById('dash-frentes-info').textContent = `${frentesProprias}P + ${frentesTerceiras}T`;
    
    document.getElementById('dash-metas-atingidas').textContent = `${metasAtingidas}/${metasAtivas.length}`;
    document.getElementById('dash-metas-progresso').textContent = 
        metasAtivas.length > 0 ? Math.round((metasAtingidas / metasAtivas.length) * 100) + '%' : '0%';
    
    document.getElementById('dash-media-diaria').textContent = Utils.formatarToneladas(mediaDiaria).replace(' T', ' T/d');
    document.getElementById('dash-meta-diaria').textContent = `Meta: ${Utils.formatarToneladas(metaDiariaMedia).replace(' T', ' T/d')}`;
    
    document.getElementById('dash-total-liberacoes').textContent = liberacoesAtivas;
    document.getElementById('dash-liberacoes-info').textContent = 
        `${liberacoes.filter(l => l.status === 'aberto').length} Abertas + ${liberacoes.filter(l => l.status === 'em-andamento').length} Em Andamento`;
    
    // Calcular tendências (simulado)
    const tendenciaColhido = Math.random() > 0.5 ? '+' : '-';
    const percentualTendencia = (Math.random() * 10).toFixed(1);
    
    document.getElementById('dash-colhido-trend').innerHTML = 
        `<i class="fas fa-arrow-${tendenciaColhido === '+' ? 'up' : 'down'} mr-1"></i>${tendenciaColhido}${percentualTendencia}%`;
    document.getElementById('dash-colhido-trend').className = 
        `text-${tendenciaColhido === '+' ? 'green' : 'red'}-600 dark:text-${tendenciaColhido === '+' ? 'green' : 'red'}-400 text-sm`;
}

function atualizarAlertasCriticos() {
    const alertas = [];
    
    // Verificar frentes sem colheita há mais de 3 dias
    const frentes = DB.frentes.getAtivas();
    const lancamentos = DB.lancamentos.getAll();
    const hoje = new Date();
    
    frentes.forEach(frente => {
        const lancamentosFrente = lancamentos.filter(l => l.frenteId === frente.id);
        const ultimoLancamento = lancamentosFrente
            .sort((a, b) => new Date(b.data) - new Date(a.data))[0];
        
        if (ultimoLancamento) {
            const diasSemColheita = Math.floor((hoje - new Date(ultimoLancamento.data)) / (1000 * 60 * 60 * 24));
            if (diasSemColheita > 3) {
                alertas.push(`Frente ${frente.nome}: ${diasSemColheita} dias sem colheita`);
            }
        } else {
            alertas.push(`Frente ${frente.nome}: Nunca teve lançamento de colheita`);
        }
    });
    
    // Verificar metas muito abaixo do esperado
    const metas = DB.metas.getAtivas();
    metas.forEach(meta => {
        const frente = DB.frentes.get(meta.frenteId);
        const lancamentosFrente = lancamentos.filter(l => 
            l.frenteId === meta.frenteId && 
            l.data >= meta.dataInicio && 
            l.data <= meta.dataFim
        );
        const totalColhido = lancamentosFrente.reduce((sum, l) => sum + Number(l.colhido), 0);
        const percentual = (totalColhido / Number(meta.valor)) * 100;
        
        if (percentual < 50 && frente) {
            alertas.push(`${frente.nome}: Apenas ${percentual.toFixed(1)}% da meta atingida`);
        }
    });
    
    // Mostrar/ocultar seção de alertas
    const alertasContainer = document.getElementById('dashboard-alertas');
    const listaAlertas = document.getElementById('lista-alertas-criticos');
    
    if (alertas.length > 0) {
        alertasContainer.classList.remove('hidden');
        listaAlertas.innerHTML = alertas.slice(0, 3).map(alerta => 
            `<div class="flex items-center text-sm text-red-700 dark:text-red-300">
                <i class="fas fa-exclamation-circle mr-2"></i>
                ${alerta}
            </div>`
        ).join('');
    } else {
        alertasContainer.classList.add('hidden');
    }
}

function atualizarTopPerformance() {
    const frentes = DB.frentes.getAll();
    const metas = DB.metas.getAll();
    const lancamentos = DB.lancamentos.getAll();
    
    const performance = frentes.map(frente => {
        const metasFrente = metas.filter(m => m.frenteId === frente.id);
        const lancamentosFrente = lancamentos.filter(l => l.frenteId === frente.id);
        
        const totalMeta = metasFrente.reduce((sum, m) => sum + Number(m.valor), 0);
        const totalColhido = lancamentosFrente.reduce((sum, l) => sum + Number(l.colhido), 0);
        
        const percentual = totalMeta > 0 ? (totalColhido / totalMeta) * 100 : 0;
        
        return {
            nome: frente.nome,
            tipo: frente.tipo,
            percentual: percentual,
            totalColhido: totalColhido
        };
    })
    .sort((a, b) => b.percentual - a.percentual)
    .slice(0, 5);
    
    const container = document.getElementById('dash-top-frentes');
    container.innerHTML = performance.map((frente, index) => {
        const tipoConfig = Utils.getTipoConfig(frente.tipo);
        const medalha = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : `${index + 1}º`;
        
        return `
            <div class="flex items-center justify-between p-3 rounded-lg ${index < 3 ? 'bg-gradient-to-r from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20' : 'bg-gray-50 dark:bg-gray-700/50'}">
                <div class="flex items-center">
                    <span class="text-lg mr-3">${medalha}</span>
                    <div>
                        <div class="font-medium text-gray-900 dark:text-gray-100">${frente.nome}</div>
                        <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                            <span class="px-2 py-1 rounded ${tipoConfig.bg} ${tipoConfig.text} mr-2">
                                <i class="fas ${tipoConfig.icon} mr-1"></i>${tipoConfig.texto}
                            </span>
                            ${Utils.formatarToneladas(frente.totalColhido)}
                        </div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-lg font-bold ${frente.percentual >= 100 ? 'text-green-600' : frente.percentual >= 80 ? 'text-yellow-600' : 'text-red-600'}">${frente.percentual.toFixed(0)}%</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">da meta</div>
                </div>
            </div>
        `;
    }).join('');
}

function atualizarAtividadeRecente() {
    const lancamentos = DB.lancamentos.getAll()
        .sort((a, b) => new Date(b.dataRegistro) - new Date(a.dataRegistro))
        .slice(0, 8);
    
    const liberacoes = DB.liberacoes.getAll()
        .sort((a, b) => new Date(b.dataRegistro) - new Date(a.dataRegistro))
        .slice(0, 4);
    
    const atividades = [];
    
    // Adicionar lançamentos recentes
    lancamentos.forEach(lancamento => {
        const frente = DB.frentes.get(lancamento.frenteId);
        if (frente) {
            atividades.push({
                tipo: 'lancamento',
                titulo: `Colheita registrada`,
                detalhes: `${frente.nome}: ${Utils.formatarToneladas(lancamento.colhido)}`,
                data: new Date(lancamento.dataRegistro),
                icon: 'fa-seedling',
                cor: 'green'
            });
        }
    });
    
    // Adicionar liberações recentes
    liberacoes.forEach(liberacao => {
        const statusConfig = Utils.getStatusConfig(liberacao.status);
        atividades.push({
            tipo: 'liberacao',
            titulo: `Liberação ${statusConfig.texto.toLowerCase()}`,
            detalhes: `${liberacao.frente}: ${Utils.formatarToneladas(liberacao.realizado)}`,
            data: new Date(liberacao.dataRegistro),
            icon: 'fa-tasks',
            cor: statusConfig.cor
        });
    });
    
    // Ordenar por data e pegar os 6 mais recentes
    atividades.sort((a, b) => b.data - a.data);
    const atividadesRecentes = atividades.slice(0, 6);
    
    const container = document.getElementById('dash-atividade-recente');
    container.innerHTML = atividadesRecentes.map(atividade => {
        const tempoDecorrido = calcularTempoDecorrido(atividade.data);
        
        return `
            <div class="flex items-start space-x-3 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 rounded-full bg-${atividade.cor}-100 dark:bg-${atividade.cor}-900/30 flex items-center justify-center">
                        <i class="fas ${atividade.icon} text-${atividade.cor}-600 dark:text-${atividade.cor}-400 text-sm"></i>
                    </div>
                </div>
                <div class="flex-1 min-w-0">
                    <div class="text-sm font-medium text-gray-900 dark:text-gray-100">${atividade.titulo}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">${atividade.detalhes}</div>
                    <div class="text-xs text-gray-400 dark:text-gray-500 mt-1">${tempoDecorrido}</div>
                </div>
            </div>
        `;
    }).join('');
}

function calcularTempoDecorrido(data) {
    const agora = new Date();
    const diferenca = agora - data;
    const minutos = Math.floor(diferenca / (1000 * 60));
    const horas = Math.floor(diferenca / (1000 * 60 * 60));
    const dias = Math.floor(diferenca / (1000 * 60 * 60 * 24));
    
    if (minutos < 60) {
        return minutos <= 1 ? 'agora mesmo' : `${minutos} min atrás`;
    } else if (horas < 24) {
        return `${horas}h atrás`;
    } else {
        return `${dias}d atrás`;
    }
}

function atualizarResumoExecutivo() {
    const liberacoes = DB.liberacoes.getAll();
    const frentes = DB.frentes.getAll();
    const metas = DB.metas.getAll();
    const lancamentos = DB.lancamentos.getAll();
    
    // Calcular eficiência geral
    const totalColhido = lancamentos.reduce((sum, l) => sum + Number(l.colhido), 0);
    const totalMeta = metas.reduce((sum, m) => sum + Number(m.valor), 0);
    const eficiencia = totalMeta > 0 ? (totalColhido / totalMeta) * 100 : 0;
    
    // Performance
    let performanceTexto = '';
    if (eficiencia >= 95) {
        performanceTexto = 'Sistema operando com excelência, superando todas as expectativas estabelecidas.';
    } else if (eficiencia >= 85) {
        performanceTexto = `Sistema operando com eficiência de ${eficiencia.toFixed(0)}%, dentro dos parâmetros ideais.`;
    } else if (eficiencia >= 70) {
        performanceTexto = `Sistema operando com eficiência de ${eficiencia.toFixed(0)}%, necessário monitoramento contínuo.`;
    } else {
        performanceTexto = `Sistema com eficiência de ${eficiencia.toFixed(0)}%, requer atenção imediata para melhoria.`;
    }
    
    // Alertas
    const frentesInativas = frentes.filter(f => f.status !== 'ativa').length;
    const metasAtrasadas = metas.filter(m => {
        const hoje = new Date().toISOString().split('T')[0];
        if (m.dataFim < hoje) {
            const lancamentosFrente = lancamentos.filter(l => 
                l.frenteId === m.frenteId && 
                l.data >= m.dataInicio && 
                l.data <= m.dataFim
            );
            const totalColhido = lancamentosFrente.reduce((sum, l) => sum + Number(l.colhido), 0);
            return totalColhido < Number(m.valor);
        }
        return false;
    }).length;
    
    let alertasTexto = '';
    if (frentesInativas === 0 && metasAtrasadas === 0) {
        alertasTexto = 'Todas as frentes operando dentro dos parâmetros normais. Nenhum alerta crítico identificado.';
    } else {
        const alertas = [];
        if (frentesInativas > 0) alertas.push(`${frentesInativas} frente(s) inativa(s)`);
        if (metasAtrasadas > 0) alertas.push(`${metasAtrasadas} meta(s) não atingida(s)`);
        alertasTexto = `Identificados: ${alertas.join(', ')}. Recomenda-se análise detalhada.`;
    }
    
    // Próximas ações
    const hoje = new Date();
    const proximasMetas = metas.filter(m => {
        const dataFim = new Date(m.dataFim);
        const diasRestantes = Math.ceil((dataFim - hoje) / (1000 * 60 * 60 * 24));
        return diasRestantes > 0 && diasRestantes <= 7;
    }).length;
    
    let acoesTexto = '';
    if (proximasMetas > 0) {
        acoesTexto = `${proximasMetas} meta(s) com prazo nos próximos 7 dias. Intensificar monitoramento das frentes críticas.`;
    } else if (eficiencia >= 90) {
        acoesTexto = 'Manter ritmo atual para atingir metas mensais. Considerar otimização de processos.';
    } else {
        acoesTexto = 'Revisar estratégias de colheita e redistribuir recursos para frentes de maior potencial.';
    }
    
    // Atualizar interface
    document.getElementById('dash-resumo-performance').textContent = performanceTexto;
    document.getElementById('dash-resumo-alertas').textContent = alertasTexto;
    document.getElementById('dash-resumo-acoes').textContent = acoesTexto;
}

// ===== GESTÃO DE LIBERAÇÕES =====

function inicializarLiberacoes() {
    carregarLiberacoes();
    carregarFiltrosLiberacoes();
    configurarEventosLiberacoes();
    
    // Data padrão para hoje
    document.getElementById('liberacao-data').value = new Date().toISOString().split('T')[0];
}

function configurarEventosLiberacoes() {
    // Formulário de liberação
    document.getElementById('form-liberacao')?.addEventListener('submit', function(e) {
        e.preventDefault();
        salvarLiberacao();
    });
    
    // Limpar formulário
    document.getElementById('btn-clear-form-liberacao')?.addEventListener('click', limparFormularioLiberacao);
    
    // Cancelar edição
    document.getElementById('btn-cancel-liberacao')?.addEventListener('click', cancelarEdicaoLiberacao);
    
    // Busca e filtros
    const searchInput = document.getElementById('search-liberacoes');
    if (searchInput) {
        searchInput.addEventListener('input', Utils.debounce(function() {
            currentLiberacoesPage = 1;
            carregarLiberacoes();
        }, 300));
    }
    
    const filtros = ['filtro-liberacao-frente', 'filtro-liberacao-fazenda', 'filtro-liberacao-status'];
    filtros.forEach(filtroId => {
        const filtro = document.getElementById(filtroId);
        if (filtro) {
            filtro.addEventListener('change', function() {
                currentLiberacoesPage = 1;
                carregarLiberacoes();
            });
        }
    });
    
    // Limpar filtros
    document.getElementById('btn-clear-filters')?.addEventListener('click', function() {
        document.getElementById('search-liberacoes').value = '';
        document.getElementById('filtro-liberacao-frente').value = '';
        document.getElementById('filtro-liberacao-fazenda').value = '';
        document.getElementById('filtro-liberacao-status').value = '';
        currentLiberacoesPage = 1;
        carregarLiberacoes();
    });
    
    // Exportar
    document.getElementById('btn-export-liberacoes')?.addEventListener('click', exportarLiberacoes);
    
    // Refresh
    document.getElementById('btn-refresh-liberacoes')?.addEventListener('click', function() {
        carregarLiberacoes();
        Toast.show('Dados atualizados', 'success', 2000);
    });
    
    // Ordenação
    document.querySelectorAll('th[data-sort]').forEach(header => {
        header.addEventListener('click', function() {
            const field = this.getAttribute('data-sort');
            if (currentLiberacoesSort.field === field) {
                currentLiberacoesSort.direction = currentLiberacoesSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentLiberacoesSort.field = field;
                currentLiberacoesSort.direction = 'desc';
            }
            
            // Atualizar ícones
            document.querySelectorAll('th[data-sort] i').forEach(icon => {
                icon.className = 'fas fa-sort ml-1';
            });
            
            const currentIcon = this.querySelector('i');
            if (currentIcon) {
                currentIcon.className = `fas fa-sort-${currentLiberacoesSort.direction === 'asc' ? 'up' : 'down'} ml-1`;
            }
            
            carregarLiberacoes();
        });
    });
}

function carregarFiltrosLiberacoes() {
    const uniqueValues = DB.liberacoes.getUniqueValues();
    
    // Filtro de frentes
    const filtroFrente = document.getElementById('filtro-liberacao-frente');
    if (filtroFrente) {
        filtroFrente.innerHTML = '<option value="">Todas</option>';
        uniqueValues.frentes.forEach(frente => {
            const option = document.createElement('option');
            option.value = frente;
            option.textContent = frente;
            filtroFrente.appendChild(option);
        });
    }
    
    // Filtro de fazendas
    const filtroFazenda = document.getElementById('filtro-liberacao-fazenda');
    if (filtroFazenda) {
        filtroFazenda.innerHTML = '<option value="">Todas</option>';
        uniqueValues.fazendas.forEach(fazenda => {
            const option = document.createElement('option');
            option.value = fazenda;
            option.textContent = fazenda;
            filtroFazenda.appendChild(option);
        });
    }
}

function salvarLiberacao() {
    const form = document.getElementById('form-liberacao');
    if (!Utils.validateForm(form)) {
        Toast.show('Por favor, preencha todos os campos obrigatórios', 'error');
        return;
    }
    
    const btnSubmit = document.getElementById('btn-submit-liberacao');
    const btnText = document.getElementById('btn-submit-text');
    
    btnSubmit.classList.add('btn-loading');
    btnSubmit.disabled = true;
    
    try {
        const liberacao = {
            frente: document.getElementById('liberacao-frente').value.trim(),
            fazenda: document.getElementById('liberacao-fazenda').value.trim(),
            numero: document.getElementById('liberacao-numero').value.trim(),
            status: document.getElementById('liberacao-status').value,
            previsto: parseFloat(document.getElementById('liberacao-previsto').value) || 0,
            realizado: parseFloat(document.getElementById('liberacao-realizado').value) || 0,
            data: document.getElementById('liberacao-data').value,
            observacoes: document.getElementById('liberacao-observacoes').value.trim()
        };
        
        const isEditing = btnText.textContent.includes('Atualizar');
        
        if (isEditing) {
            const liberacaoId = form.getAttribute('data-editing-id');
            liberacao.id = liberacaoId;
            DB.liberacoes.update(liberacao);
            Toast.show('Liberação atualizada com sucesso', 'success');
            NotificationManager.add(`Liberação ${liberacao.frente} atualizada`, 'info');
        } else {
            DB.liberacoes.add(liberacao);
            Toast.show('Liberação salva com sucesso', 'success');
            NotificationManager.add(`Nova liberação cadastrada: ${liberacao.frente}`, 'success');
        }
        
        limparFormularioLiberacao();
        carregarLiberacoes();
        carregarFiltrosLiberacoes();
        
    } catch (error) {
        console.error('Erro ao salvar liberação:', error);
        Toast.show('Erro ao salvar liberação: ' + error.message, 'error');
    } finally {
        btnSubmit.classList.remove('btn-loading');
        btnSubmit.disabled = false;
    }
}

function carregarLiberacoes() {
    const searchTerm = document.getElementById('search-liberacoes')?.value || '';
    const filters = {
        frente: document.getElementById('filtro-liberacao-frente')?.value || '',
        fazenda: document.getElementById('filtro-liberacao-fazenda')?.value || '',
        status: document.getElementById('filtro-liberacao-status')?.value || ''
    };
    
    let liberacoes = DB.liberacoes.search(searchTerm, filters);
    
    // Ordenação
    liberacoes.sort((a, b) => {
        const field = currentLiberacoesSort.field;
        let aVal = a[field];
        let bVal = b[field];
        
        if (field === 'data') {
            aVal = new Date(aVal);
            bVal = new Date(bVal);
        } else if (typeof aVal === 'string') {
            aVal = aVal.toLowerCase();
            bVal = bVal.toLowerCase();
        }
        
        if (aVal < bVal) return currentLiberacoesSort.direction === 'asc' ? -1 : 1;
        if (aVal > bVal) return currentLiberacoesSort.direction === 'asc' ? 1 : -1;
        return 0;
    });
    
    // Paginação
    const paginatedResult = DB.liberacoes.paginate(liberacoes, currentLiberacoesPage, AppConfig.pagination.itemsPerPage);
    
    renderizarTabelaLiberacoes(paginatedResult.data);
    atualizarResumoLiberacoes(liberacoes);
    
    // Contador de resultados
    document.getElementById('results-count').textContent = `${paginatedResult.totalItems} resultado(s)`;
    
    // Paginação
    PaginationManager.create('pagination-liberacoes', paginatedResult.totalPages, paginatedResult.currentPage, (page) => {
        currentLiberacoesPage = page;
        carregarLiberacoes();
    });
}

function renderizarTabelaLiberacoes(liberacoes) {
    const tbody = document.getElementById('tabela-liberacoes');
    if (!tbody) return;
    
    tbody.innerHTML = '';
    
    if (liberacoes.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="9" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                    <i class="fas fa-search text-3xl mb-2"></i>
                    <p>Nenhuma liberação encontrada</p>
                    <p class="text-sm">Tente ajustar os filtros de busca</p>
                </td>
            </tr>
        `;
        return;
    }
    
    liberacoes.forEach(liberacao => {
        const statusConfig = Utils.getStatusConfig(liberacao.status);
        const progresso = liberacao.previsto > 0 ? (liberacao.realizado / liberacao.previsto) * 100 : 0;
        
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
        row.innerHTML = `
            <td class="px-4 py-3 text-sm font-medium text-gray-900 dark:text-gray-100">${liberacao.frente}</td>
            <td class="px-4 py-3 text-sm text-gray-700 dark:text-gray-300">${liberacao.fazenda}</td>
            <td class="px-4 py-3 text-sm text-gray-700 dark:text-gray-300">${liberacao.numero || '-'}</td>
            <td class="px-4 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusConfig.bg} ${statusConfig.text}">
                    <i class="fas ${statusConfig.icon} mr-1"></i>
                    ${statusConfig.texto}
                </span>
            </td>
            <td class="px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100">${Utils.formatarToneladas(liberacao.previsto)}</td>
            <td class="px-4 py-3 text-right text-sm font-medium text-green-600 dark:text-green-400">${Utils.formatarToneladas(liberacao.realizado)}</td>
            <td class="px-4 py-3 text-right text-sm font-medium text-red-600 dark:text-red-400">${Utils.formatarToneladas(liberacao.restante)}</td>
            <td class="px-4 py-3 text-center">
                <div class="flex items-center justify-center">
                    <div class="w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                        <div class="progress-bar bg-gradient-to-r ${progresso >= 100 ? 'from-green-500 to-green-600' : progresso >= 80 ? 'from-yellow-500 to-yellow-600' : 'from-red-500 to-red-600'} h-2 rounded-full transition-all-300" style="width: ${Math.min(progresso, 100)}%"></div>
                    </div>
                    <span class="ml-2 text-xs font-medium text-gray-700 dark:text-gray-300">${progresso.toFixed(0)}%</span>
                </div>
            </td>
            <td class="px-4 py-3 text-center">
                <div class="flex items-center justify-center space-x-1">
                    <button class="btn-editar-liberacao p-1 text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-all-300" data-id="${liberacao.id}" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-excluir-liberacao p-1 text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-all-300" data-id="${liberacao.id}" title="Excluir">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </td>
        `;
        
        tbody.appendChild(row);
    });
    
    // Configurar eventos dos botões
    document.querySelectorAll('.btn-editar-liberacao').forEach(btn => {
        btn.addEventListener('click', function() {
            editarLiberacao(this.getAttribute('data-id'));
        });
    });
    
    document.querySelectorAll('.btn-excluir-liberacao').forEach(btn => {
        btn.addEventListener('click', function() {
            excluirLiberacao(this.getAttribute('data-id'));
        });
    });
}

function atualizarResumoLiberacoes(liberacoes) {
    const totals = DB.liberacoes.getTotals(
        document.getElementById('filtro-liberacao-frente')?.value || '',
        document.getElementById('filtro-liberacao-fazenda')?.value || '',
        document.getElementById('filtro-liberacao-status')?.value || ''
    );
    
    document.getElementById('resumo-total-previsto').textContent = Utils.formatarToneladas(totals.previsto);
    document.getElementById('resumo-total-realizado').textContent = Utils.formatarToneladas(totals.realizado);
    document.getElementById('resumo-total-restante').textContent = Utils.formatarToneladas(totals.restante);
    document.getElementById('resumo-status-aberto').textContent = totals.statusAberto;
    document.getElementById('resumo-status-fechado').textContent = totals.statusFechado;
    document.getElementById('resumo-total-geral').textContent = totals.count;
}

function editarLiberacao(id) {
    const liberacao = DB.liberacoes.get(id);
    if (!liberacao) {
        Toast.show('Liberação não encontrada', 'error');
        return;
    }
    
    // Preencher formulário
    document.getElementById('liberacao-frente').value = liberacao.frente;
    document.getElementById('liberacao-fazenda').value = liberacao.fazenda;
    document.getElementById('liberacao-numero').value = liberacao.numero || '';
    document.getElementById('liberacao-status').value = liberacao.status;
    document.getElementById('liberacao-previsto').value = liberacao.previsto;
    document.getElementById('liberacao-realizado').value = liberacao.realizado;
    document.getElementById('liberacao-data').value = liberacao.data;
    document.getElementById('liberacao-observacoes').value = liberacao.observacoes || '';
    
    // Alterar interface para modo edição
    const form = document.getElementById('form-liberacao');
    const btnSubmit = document.getElementById('btn-submit-text');
    
    form.setAttribute('data-editing-id', id);
    btnSubmit.textContent = 'Atualizar Liberação';
    
    Toast.show('Modo de edição ativado', 'info');
}

function cancelarEdicaoLiberacao() {
    limparFormularioLiberacao();
    Toast.show('Edição cancelada', 'info');
}

function limparFormularioLiberacao() {
    const form = document.getElementById('form-liberacao');
    form.reset();
    form.removeAttribute('data-editing-id');
    
    Utils.clearFormValidation(form);
    
    document.getElementById('btn-submit-text').textContent = 'Salvar Liberação';
    document.getElementById('liberacao-data').value = new Date().toISOString().split('T')[0];
}

function excluirLiberacao(id) {
    const liberacao = DB.liberacoes.get(id);
    if (!liberacao) {
        Toast.show('Liberação não encontrada', 'error');
        return;
    }
    
    // Modal de confirmação customizado
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
    modal.innerHTML = `
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 animate-fade-in">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Confirmar Exclusão</h3>
            <p class="text-gray-700 dark:text-gray-300 mb-4">
                Tem certeza que deseja excluir a liberação da <strong>${liberacao.frente}</strong>?
            </p>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
                Esta ação não pode ser desfeita.
            </p>
            <div class="flex justify-end space-x-4">
                <button class="btn-cancelar px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                    Cancelar
                </button>
                <button class="btn-confirmar px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg text-sm transition-all-300">
                    Sim, Excluir
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Eventos do modal
    modal.querySelector('.btn-cancelar').addEventListener('click', () => {
        document.body.removeChild(modal);
    });
    
    modal.querySelector('.btn-confirmar').addEventListener('click', () => {
        try {
            DB.liberacoes.remove(id);
            Toast.show('Liberação excluída com sucesso', 'success');
            NotificationManager.add(`Liberação ${liberacao.frente} excluída`, 'warning');
            carregarLiberacoes();
            carregarFiltrosLiberacoes();
        } catch (error) {
            Toast.show('Erro ao excluir liberação: ' + error.message, 'error');
        }
        document.body.removeChild(modal);
    });
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            document.body.removeChild(modal);
        }
    });
}

function exportarLiberacoes() {
    const searchTerm = document.getElementById('search-liberacoes')?.value || '';
    const filters = {
        frente: document.getElementById('filtro-liberacao-frente')?.value || '',
        fazenda: document.getElementById('filtro-liberacao-fazenda')?.value || '',
        status: document.getElementById('filtro-liberacao-status')?.value || ''
    };
    
    const liberacoes = DB.liberacoes.search(searchTerm, filters);
    
    if (liberacoes.length === 0) {
        Toast.show('Não há dados para exportar', 'warning');
        return;
    }
    
    const colunas = [
        { header: 'Frente', dataKey: 'frente' },
        { header: 'Fazenda', dataKey: 'fazenda' },
        { header: 'Nº Liberação', dataKey: 'numero' },
        { header: 'Status', dataKey: item => Utils.getStatusConfig(item.status).texto },
        { header: 'Previsto (T)', dataKey: item => Utils.formatarToneladas(item.previsto) },
        { header: 'Realizado (T)', dataKey: item => Utils.formatarToneladas(item.realizado) },
        { header: 'Restante (T)', dataKey: item => Utils.formatarToneladas(item.restante) },
        { header: 'Data', dataKey: item => Utils.formatarData(item.data) },
        { header: 'Observações', dataKey: 'observacoes' }
    ];
    
    Utils.exportarPDF(
        'Relatório de Liberações',
        liberacoes,
        colunas,
        `liberacoes_${new Date().toISOString().split('T')[0]}.pdf`
    );
}

// ===== GESTÃO DE FRENTES =====

function inicializarFrente() {
    carregarFrente();
    configurarEventosFrente();
}

function configurarEventosFrente() {
    // Formulário de frente
    document.getElementById('form-frente')?.addEventListener('submit', function(e) {
        e.preventDefault();
        salvarFrente();
    });
    
    // Refresh
    document.getElementById('btn-refresh-frentes')?.addEventListener('click', function() {
        carregarFrente();
        Toast.show('Dados atualizados', 'success', 2000);
    });
}

function salvarFrente() {
    const form = document.getElementById('form-frente');
    if (!Utils.validateForm(form)) {
        Toast.show('Por favor, preencha todos os campos obrigatórios', 'error');
        return;
    }
    
    const btnSubmit = form.querySelector('button[type="submit"]');
    const btnText = document.getElementById('btn-submit-frente-text');
    
    btnSubmit.classList.add('btn-loading');
    btnSubmit.disabled = true;
    
    try {
        const frente = {
            nome: document.getElementById('frente-nome').value.trim(),
            fazenda: document.getElementById('frente-fazenda').value.trim(),
            tipo: document.getElementById('frente-tipo').value,
            responsavel: document.getElementById('frente-responsavel').value.trim(),
            status: document.getElementById('frente-status').value,
            observacoes: document.getElementById('frente-observacoes').value.trim()
        };
        
        const isEditing = btnText.textContent.includes('Atualizar');
        
        if (isEditing) {
            const frenteId = form.getAttribute('data-editing-id');
            frente.id = frenteId;
            DB.frentes.update(frente);
            Toast.show('Frente atualizada com sucesso', 'success');
            NotificationManager.add(`Frente ${frente.nome} atualizada`, 'info');
        } else {
            DB.frentes.add(frente);
            Toast.show('Frente cadastrada com sucesso', 'success');
            NotificationManager.add(`Nova frente cadastrada: ${frente.nome}`, 'success');
        }
        
        form.reset();
        form.removeAttribute('data-editing-id');
        btnText.textContent = 'Salvar Frente';
        Utils.clearFormValidation(form);
        
        carregarFrente();
        atualizarSelectsFrente();
        
    } catch (error) {
        console.error('Erro ao salvar frente:', error);
        Toast.show('Erro ao salvar frente: ' + error.message, 'error');
    } finally {
        btnSubmit.classList.remove('btn-loading');
        btnSubmit.disabled = false;
    }
}

function carregarFrente() {
    const frentes = DB.frentes.getAll();
    const tbody = document.getElementById('tabela-frentes');
    if (!tbody) return;
    
    tbody.innerHTML = '';
    
    if (frentes.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="5" class="px-3 py-8 text-center text-gray-500 dark:text-gray-400">
                    <i class="fas fa-map-marker-alt text-3xl mb-2"></i>
                    <p>Nenhuma frente cadastrada</p>
                    <p class="text-sm">Comece cadastrando uma nova frente</p>
                </td>
            </tr>
        `;
        return;
    }
    
    frentes.forEach(frente => {
        const tipoConfig = Utils.getTipoConfig(frente.tipo);
        const statusConfig = Utils.getStatusConfig(frente.status);
        
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
        row.innerHTML = `
            <td class="px-3 py-3 text-sm font-medium text-gray-900 dark:text-gray-100">${frente.nome}</td>
            <td class="px-3 py-3 text-sm text-gray-700 dark:text-gray-300">${frente.fazenda}</td>
            <td class="px-3 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${tipoConfig.bg} ${tipoConfig.text}">
                    <i class="fas ${tipoConfig.icon} mr-1"></i>
                    ${tipoConfig.texto}
                </span>
            </td>
            <td class="px-3 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusConfig.bg} ${statusConfig.text}">
                    <i class="fas ${statusConfig.icon} mr-1"></i>
                    ${statusConfig.texto}
                </span>
            </td>
            <td class="px-3 py-3 text-center">
                <div class="flex items-center justify-center space-x-1">
                    <button class="btn-editar-frente p-1 text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-all-300" data-id="${frente.id}" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-excluir-frente p-1 text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-all-300" data-id="${frente.id}" title="Excluir">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </td>
        `;
        
        tbody.appendChild(row);
    });
    
    // Configurar eventos dos botões
    document.querySelectorAll('.btn-editar-frente').forEach(btn => {
        btn.addEventListener('click', function() {
            editarFrente(this.getAttribute('data-id'));
        });
    });
    
    document.querySelectorAll('.btn-excluir-frente').forEach(btn => {
        btn.addEventListener('click', function() {
            excluirFrente(this.getAttribute('data-id'));
        });
    });
}

function editarFrente(id) {
    const frente = DB.frentes.get(id);
    if (!frente) {
        Toast.show('Frente não encontrada', 'error');
        return;
    }
    
    // Preencher formulário
    document.getElementById('frente-nome').value = frente.nome;
    document.getElementById('frente-fazenda').value = frente.fazenda;
    document.getElementById('frente-tipo').value = frente.tipo;
    document.getElementById('frente-responsavel').value = frente.responsavel || '';
    document.getElementById('frente-status').value = frente.status;
    document.getElementById('frente-observacoes').value = frente.observacoes || '';
    
    // Alterar interface para modo edição
    const form = document.getElementById('form-frente');
    const btnText = document.getElementById('btn-submit-frente-text');
    
    form.setAttribute('data-editing-id', id);
    btnText.textContent = 'Atualizar Frente';
    
    Toast.show('Modo de edição ativado', 'info');
}

function excluirFrente(id) {
    const frente = DB.frentes.get(id);
    if (!frente) {
        Toast.show('Frente não encontrada', 'error');
        return;
    }
    
    // Verificar dependências
    const metas = DB.metas.getAll().filter(m => m.frenteId === id);
    const lancamentos = DB.lancamentos.getAll().filter(l => l.frenteId === id);
    
    if (metas.length > 0 || lancamentos.length > 0) {
        Toast.show('Não é possível excluir a frente pois há metas ou lançamentos vinculados', 'error');
        return;
    }
    
    // Modal de confirmação customizado
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
    modal.innerHTML = `
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 animate-fade-in">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Confirmar Exclusão</h3>
            <p class="text-gray-700 dark:text-gray-300 mb-4">
                Tem certeza que deseja excluir a frente <strong>${frente.nome}</strong>?
            </p>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
                Esta ação não pode ser desfeita.
            </p>
            <div class="flex justify-end space-x-4">
                <button class="btn-cancelar px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                    Cancelar
                </button>
                <button class="btn-confirmar px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg text-sm transition-all-300">
                    Sim, Excluir
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Eventos do modal
    modal.querySelector('.btn-cancelar').addEventListener('click', () => {
        document.body.removeChild(modal);
    });
    
    modal.querySelector('.btn-confirmar').addEventListener('click', () => {
        try {
            DB.frentes.remove(id);
            Toast.show('Frente excluída com sucesso', 'success');
            NotificationManager.add(`Frente ${frente.nome} excluída`, 'warning');
            carregarFrente();
            atualizarSelectsFrente();
        } catch (error) {
            Toast.show('Erro ao excluir frente: ' + error.message, 'error');
        }
        document.body.removeChild(modal);
    });
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            document.body.removeChild(modal);
        }
    });
}

function atualizarSelectsFrente() {
    const frentes = DB.frentes.getAll();
    
    // Selects de metas
    const selectsMetaPropria = document.getElementById('meta-propria-frente');
    const selectsMetaTerceira = document.getElementById('meta-terceira-frente');
    const selectsLancamento = document.getElementById('lancamento-frente');
    const selectsAcompanhamento = document.getElementById('filtro-acompanhamento-frente');
    
    // Frentes próprias
    if (selectsMetaPropria) {
        selectsMetaPropria.innerHTML = '<option value="">Selecione uma frente própria</option>';
        frentes.filter(f => f.tipo === 'propria' && f.status === 'ativa').forEach(frente => {
            const option = document.createElement('option');
            option.value = frente.id;
            option.textContent = `${frente.nome} - ${frente.fazenda}`;
            selectsMetaPropria.appendChild(option);
        });
    }
    
    // Frentes terceiras
    if (selectsMetaTerceira) {
        selectsMetaTerceira.innerHTML = '<option value="">Selecione uma frente terceira</option>';
        frentes.filter(f => f.tipo === 'terceira' && f.status === 'ativa').forEach(frente => {
            const option = document.createElement('option');
            option.value = frente.id;
            option.textContent = `${frente.nome} - ${frente.fazenda}`;
            selectsMetaTerceira.appendChild(option);
        });
    }
    
    // Todas as frentes para lançamento
    if (selectsLancamento) {
        selectsLancamento.innerHTML = '<option value="">Selecione uma frente</option>';
        frentes.filter(f => f.status === 'ativa').forEach(frente => {
            const tipoConfig = Utils.getTipoConfig(frente.tipo);
            const option = document.createElement('option');
            option.value = frente.id;
            option.textContent = `${frente.nome} - ${frente.fazenda} (${tipoConfig.texto})`;
            selectsLancamento.appendChild(option);
        });
    }
    
    // Filtro de acompanhamento
    if (selectsAcompanhamento) {
        selectsAcompanhamento.innerHTML = '<option value="">Todas as frentes</option>';
        frentes.forEach(frente => {
            const tipoConfig = Utils.getTipoConfig(frente.tipo);
            const option = document.createElement('option');
            option.value = frente.id;
            option.textContent = `${frente.nome} - ${frente.fazenda} (${tipoConfig.texto})`;
            selectsAcompanhamento.appendChild(option);
        });
    }
}

// ===== GESTÃO DE METAS =====

function inicializarMetas() {
    carregarMetasProprias();
    carregarMetasTerceiras();
    carregarLancamentos();
    configurarEventosMetas();
    
    // Data padrão para hoje
    const hoje = new Date().toISOString().split('T')[0];
    document.getElementById('meta-propria-data-inicio').value = hoje;
    document.getElementById('meta-propria-data-fim').value = hoje;
    document.getElementById('meta-terceira-data-inicio').value = hoje;
    document.getElementById('meta-terceira-data-fim').value = hoje;
    document.getElementById('lancamento-data').value = hoje;
}

function configurarEventosMetas() {
    // Formulários
    document.getElementById('form-meta-propria')?.addEventListener('submit', function(e) {
        e.preventDefault();
        salvarMetaPropria();
    });
    
    document.getElementById('form-meta-terceira')?.addEventListener('submit', function(e) {
        e.preventDefault();
        salvarMetaTerceira();
    });
    
    document.getElementById('form-lancamento')?.addEventListener('submit', function(e) {
        e.preventDefault();
        salvarLancamento();
    });
    
    // Refresh buttons
    document.getElementById('btn-refresh-metas-proprias')?.addEventListener('click', function() {
        carregarMetasProprias();
        Toast.show('Dados atualizados', 'success', 2000);
    });
    
    document.getElementById('btn-refresh-metas-terceiras')?.addEventListener('click', function() {
        carregarMetasTerceiras();
        Toast.show('Dados atualizados', 'success', 2000);
    });
    
    document.getElementById('btn-refresh-lancamentos')?.addEventListener('click', function() {
        carregarLancamentos();
        Toast.show('Dados atualizados', 'success', 2000);
    });
}

function salvarMetaPropria() {
    const form = document.getElementById('form-meta-propria');
    if (!Utils.validateForm(form)) {
        Toast.show('Por favor, preencha todos os campos obrigatórios', 'error');
        return;
    }
    
    const btnSubmit = form.querySelector('button[type="submit"]');
    const btnText = document.getElementById('btn-submit-meta-propria-text');
    
    btnSubmit.classList.add('btn-loading');
    btnSubmit.disabled = true;
    
    try {
        const meta = {
            frenteId: document.getElementById('meta-propria-frente').value,
            tipo: 'propria',
            periodo: document.getElementById('meta-propria-periodo').value,
            valor: parseFloat(document.getElementById('meta-propria-valor').value) || 0,
            dataInicio: document.getElementById('meta-propria-data-inicio').value,
            dataFim: document.getElementById('meta-propria-data-fim').value,
            observacoes: document.getElementById('meta-propria-observacoes').value.trim()
        };
        
        const isEditing = btnText.textContent.includes('Atualizar');
        
        if (isEditing) {
            const metaId = form.getAttribute('data-editing-id');
            meta.id = metaId;
            DB.metas.update(meta);
            Toast.show('Meta própria atualizada com sucesso', 'success');
        } else {
            DB.metas.add(meta);
            Toast.show('Meta própria cadastrada com sucesso', 'success');
        }
        
        form.reset();
        form.removeAttribute('data-editing-id');
        btnText.textContent = 'Salvar Meta Própria';
        Utils.clearFormValidation(form);
        
        // Data padrão para hoje
        const hoje = new Date().toISOString().split('T')[0];
        document.getElementById('meta-propria-data-inicio').value = hoje;
        document.getElementById('meta-propria-data-fim').value = hoje;
        
        carregarMetasProprias();
        
    } catch (error) {
        console.error('Erro ao salvar meta própria:', error);
        Toast.show('Erro ao salvar meta própria: ' + error.message, 'error');
    } finally {
        btnSubmit.classList.remove('btn-loading');
        btnSubmit.disabled = false;
    }
}

function salvarMetaTerceira() {
    const form = document.getElementById('form-meta-terceira');
    if (!Utils.validateForm(form)) {
        Toast.show('Por favor, preencha todos os campos obrigatórios', 'error');
        return;
    }
    
    const btnSubmit = form.querySelector('button[type="submit"]');
    const btnText = document.getElementById('btn-submit-meta-terceira-text');
    
    btnSubmit.classList.add('btn-loading');
    btnSubmit.disabled = true;
    
    try {
        const meta = {
            frenteId: document.getElementById('meta-terceira-frente').value,
            tipo: 'terceira',
            periodo: document.getElementById('meta-terceira-periodo').value,
            valor: parseFloat(document.getElementById('meta-terceira-valor').value) || 0,
            dataInicio: document.getElementById('meta-terceira-data-inicio').value,
            dataFim: document.getElementById('meta-terceira-data-fim').value,
            observacoes: document.getElementById('meta-terceira-observacoes').value.trim()
        };
        
        const isEditing = btnText.textContent.includes('Atualizar');
        
        if (isEditing) {
            const metaId = form.getAttribute('data-editing-id');
            meta.id = metaId;
            DB.metas.update(meta);
            Toast.show('Meta terceira atualizada com sucesso', 'success');
        } else {
            DB.metas.add(meta);
            Toast.show('Meta terceira cadastrada com sucesso', 'success');
        }
        
        form.reset();
        form.removeAttribute('data-editing-id');
        btnText.textContent = 'Salvar Meta Terceira';
        Utils.clearFormValidation(form);
        
        // Data padrão para hoje
        const hoje = new Date().toISOString().split('T')[0];
        document.getElementById('meta-terceira-data-inicio').value = hoje;
        document.getElementById('meta-terceira-data-fim').value = hoje;
        
        carregarMetasTerceiras();
        
    } catch (error) {
        console.error('Erro ao salvar meta terceira:', error);
        Toast.show('Erro ao salvar meta terceira: ' + error.message, 'error');
    } finally {
        btnSubmit.classList.remove('btn-loading');
        btnSubmit.disabled = false;
    }
}

function salvarLancamento() {
    const form = document.getElementById('form-lancamento');
    if (!Utils.validateForm(form)) {
        Toast.show('Por favor, preencha todos os campos obrigatórios', 'error');
        return;
    }
    
    const btnSubmit = form.querySelector('button[type="submit"]');
    const btnText = document.getElementById('btn-submit-lancamento-text');
    
    btnSubmit.classList.add('btn-loading');
    btnSubmit.disabled = true;
    
    try {
        const lancamento = {
            frenteId: document.getElementById('lancamento-frente').value,
            data: document.getElementById('lancamento-data').value,
            colhido: parseFloat(document.getElementById('lancamento-colhido').value) || 0,
            turno: document.getElementById('lancamento-turno').value,
            operador: document.getElementById('lancamento-operador').value.trim(),
            observacoes: document.getElementById('lancamento-observacoes').value.trim()
        };
        
        const isEditing = btnText.textContent.includes('Atualizar');
        
        if (isEditing) {
            const lancamentoId = form.getAttribute('data-editing-id');
            lancamento.id = lancamentoId;
            DB.lancamentos.update(lancamento);
            Toast.show('Lançamento atualizado com sucesso', 'success');
        } else {
            DB.lancamentos.add(lancamento);
            Toast.show('Lançamento cadastrado com sucesso', 'success');
            
            const frente = DB.frentes.get(lancamento.frenteId);
            if (frente) {
                NotificationManager.add(`Novo lançamento: ${frente.nome} - ${Utils.formatarToneladas(lancamento.colhido)}`, 'success');
            }
        }
        
        form.reset();
        form.removeAttribute('data-editing-id');
        btnText.textContent = 'Salvar Lançamento';
        Utils.clearFormValidation(form);
        
        // Data padrão para hoje
        document.getElementById('lancamento-data').value = new Date().toISOString().split('T')[0];
        
        carregarLancamentos();
        
    } catch (error) {
        console.error('Erro ao salvar lançamento:', error);
        Toast.show('Erro ao salvar lançamento: ' + error.message, 'error');
    } finally {
        btnSubmit.classList.remove('btn-loading');
        btnSubmit.disabled = false;
    }
}

function carregarMetasProprias() {
    const metas = DB.metas.getByTipo('propria');
    const tbody = document.getElementById('tabela-metas-proprias');
    if (!tbody) return;
    
    tbody.innerHTML = '';
    
    if (metas.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="5" class="px-3 py-8 text-center text-gray-500 dark:text-gray-400">
                    <i class="fas fa-home text-3xl mb-2"></i>
                    <p>Nenhuma meta própria cadastrada</p>
                    <p class="text-sm">Comece definindo uma meta para frentes próprias</p>
                </td>
            </tr>
        `;
        return;
    }
    
    metas.forEach(meta => {
        const frente = DB.frentes.get(meta.frenteId);
        const frenteNome = frente ? frente.nome : 'Frente não encontrada';
        
        const hoje = new Date().toISOString().split('T')[0];
        let status = 'pendente';
        let statusTexto = 'Pendente';
        let statusCor = 'gray';
        
        if (meta.dataFim < hoje) {
            status = 'concluido';
            statusTexto = 'Concluído';
            statusCor = 'blue';
        } else if (meta.dataInicio <= hoje && meta.dataFim >= hoje) {
            status = 'ativo';
            statusTexto = 'Ativo';
            statusCor = 'green';
        }
        
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
        row.innerHTML = `
            <td class="px-3 py-3 text-sm font-medium text-gray-900 dark:text-gray-100">${frenteNome}</td>
            <td class="px-3 py-3 text-sm text-gray-700 dark:text-gray-300">${meta.periodo.charAt(0).toUpperCase() + meta.periodo.slice(1)}</td>
            <td class="px-3 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100">${Utils.formatarToneladas(meta.valor)}</td>
            <td class="px-3 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${statusCor}-100 dark:bg-${statusCor}-900 text-${statusCor}-700 dark:text-${statusCor}-300">
                    ${statusTexto}
                </span>
            </td>
            <td class="px-3 py-3 text-center">
                <div class="flex items-center justify-center space-x-1">
                    <button class="btn-editar-meta-propria p-1 text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-all-300" data-id="${meta.id}" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-excluir-meta-propria p-1 text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-all-300" data-id="${meta.id}" title="Excluir">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </td>
        `;
        
        tbody.appendChild(row);
    });
    
    // Configurar eventos dos botões
    document.querySelectorAll('.btn-editar-meta-propria').forEach(btn => {
        btn.addEventListener('click', function() {
            editarMetaPropria(this.getAttribute('data-id'));
        });
    });
    
    document.querySelectorAll('.btn-excluir-meta-propria').forEach(btn => {
        btn.addEventListener('click', function() {
            excluirMeta(this.getAttribute('data-id'), 'propria');
        });
    });
}

function carregarMetasTerceiras() {
    const metas = DB.metas.getByTipo('terceira');
    const tbody = document.getElementById('tabela-metas-terceiras');
    if (!tbody) return;
    
    tbody.innerHTML = '';
    
    if (metas.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="5" class="px-3 py-8 text-center text-gray-500 dark:text-gray-400">
                    <i class="fas fa-handshake text-3xl mb-2"></i>
                    <p>Nenhuma meta terceira cadastrada</p>
                    <p class="text-sm">Comece definindo uma meta para frentes terceiras</p>
                </td>
            </tr>
        `;
        return;
    }
    
    metas.forEach(meta => {
        const frente = DB.frentes.get(meta.frenteId);
        const frenteNome = frente ? frente.nome : 'Frente não encontrada';
        
        const hoje = new Date().toISOString().split('T')[0];
        let status = 'pendente';
        let statusTexto = 'Pendente';
        let statusCor = 'gray';
        
        if (meta.dataFim < hoje) {
            status = 'concluido';
            statusTexto = 'Concluído';
            statusCor = 'blue';
        } else if (meta.dataInicio <= hoje && meta.dataFim >= hoje) {
            status = 'ativo';
            statusTexto = 'Ativo';
            statusCor = 'green';
        }
        
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
        row.innerHTML = `
            <td class="px-3 py-3 text-sm font-medium text-gray-900 dark:text-gray-100">${frenteNome}</td>
            <td class="px-3 py-3 text-sm text-gray-700 dark:text-gray-300">${meta.periodo.charAt(0).toUpperCase() + meta.periodo.slice(1)}</td>
            <td class="px-3 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100">${Utils.formatarToneladas(meta.valor)}</td>
            <td class="px-3 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${statusCor}-100 dark:bg-${statusCor}-900 text-${statusCor}-700 dark:text-${statusCor}-300">
                    ${statusTexto}
                </span>
            </td>
            <td class="px-3 py-3 text-center">
                <div class="flex items-center justify-center space-x-1">
                    <button class="btn-editar-meta-terceira p-1 text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-all-300" data-id="${meta.id}" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-excluir-meta-terceira p-1 text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-all-300" data-id="${meta.id}" title="Excluir">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </td>
        `;
        
        tbody.appendChild(row);
    });
    
    // Configurar eventos dos botões
    document.querySelectorAll('.btn-editar-meta-terceira').forEach(btn => {
        btn.addEventListener('click', function() {
            editarMetaTerceira(this.getAttribute('data-id'));
        });
    });
    
    document.querySelectorAll('.btn-excluir-meta-terceira').forEach(btn => {
        btn.addEventListener('click', function() {
            excluirMeta(this.getAttribute('data-id'), 'terceira');
        });
    });
}

function carregarLancamentos() {
    const lancamentos = DB.lancamentos.getAll()
        .sort((a, b) => new Date(b.data) - new Date(a.data))
        .slice(0, 20); // Mostrar apenas os 20 mais recentes
    
    const tbody = document.getElementById('tabela-lancamentos');
    if (!tbody) return;
    
    tbody.innerHTML = '';
    
    if (lancamentos.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="6" class="px-3 py-8 text-center text-gray-500 dark:text-gray-400">
                    <i class="fas fa-calendar-day text-3xl mb-2"></i>
                    <p>Nenhum lançamento registrado</p>
                    <p class="text-sm">Comece registrando a colheita diária</p>
                </td>
            </tr>
        `;
        return;
    }
    
    lancamentos.forEach(lancamento => {
        const frente = DB.frentes.get(lancamento.frenteId);
        const frenteNome = frente ? frente.nome : 'Frente não encontrada';
        const tipoConfig = frente ? Utils.getTipoConfig(frente.tipo) : { texto: 'Desconhecido', cor: 'gray' };
        
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
        row.innerHTML = `
            <td class="px-3 py-3 text-sm text-gray-700 dark:text-gray-300">${Utils.formatarData(lancamento.data)}</td>
            <td class="px-3 py-3 text-sm font-medium text-gray-900 dark:text-gray-100">${frenteNome}</td>
            <td class="px-3 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${tipoConfig.cor}-100 dark:bg-${tipoConfig.cor}-900 text-${tipoConfig.cor}-700 dark:text-${tipoConfig.cor}-300">
                    ${tipoConfig.texto}
                </span>
            </td>
            <td class="px-3 py-3 text-right text-sm font-medium text-green-600 dark:text-green-400">${Utils.formatarToneladas(lancamento.colhido)}</td>
            <td class="px-3 py-3 text-center text-sm text-gray-700 dark:text-gray-300">${lancamento.turno.charAt(0).toUpperCase() + lancamento.turno.slice(1)}</td>
            <td class="px-3 py-3 text-center">
                <div class="flex items-center justify-center space-x-1">
                    <button class="btn-editar-lancamento p-1 text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-all-300" data-id="${lancamento.id}" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-excluir-lancamento p-1 text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-all-300" data-id="${lancamento.id}" title="Excluir">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </td>
        `;
        
        tbody.appendChild(row);
    });
    
    // Configurar eventos dos botões
    document.querySelectorAll('.btn-editar-lancamento').forEach(btn => {
        btn.addEventListener('click', function() {
            editarLancamento(this.getAttribute('data-id'));
        });
    });
    
    document.querySelectorAll('.btn-excluir-lancamento').forEach(btn => {
        btn.addEventListener('click', function() {
            excluirLancamento(this.getAttribute('data-id'));
        });
    });
}

function editarMetaPropria(id) {
    const meta = DB.metas.get(id);
    if (!meta) {
        Toast.show('Meta não encontrada', 'error');
        return;
    }
    
    // Preencher formulário
    document.getElementById('meta-propria-frente').value = meta.frenteId;
    document.getElementById('meta-propria-periodo').value = meta.periodo;
    document.getElementById('meta-propria-valor').value = meta.valor;
    document.getElementById('meta-propria-data-inicio').value = meta.dataInicio;
    document.getElementById('meta-propria-data-fim').value = meta.dataFim;
    document.getElementById('meta-propria-observacoes').value = meta.observacoes || '';
    
    // Alterar interface para modo edição
    const form = document.getElementById('form-meta-propria');
    const btnText = document.getElementById('btn-submit-meta-propria-text');
    
    form.setAttribute('data-editing-id', id);
    btnText.textContent = 'Atualizar Meta Própria';
    
    Toast.show('Modo de edição ativado', 'info');
}

function editarMetaTerceira(id) {
    const meta = DB.metas.get(id);
    if (!meta) {
        Toast.show('Meta não encontrada', 'error');
        return;
    }
    
    // Preencher formulário
    document.getElementById('meta-terceira-frente').value = meta.frenteId;
    document.getElementById('meta-terceira-periodo').value = meta.periodo;
    document.getElementById('meta-terceira-valor').value = meta.valor;
    document.getElementById('meta-terceira-data-inicio').value = meta.dataInicio;
    document.getElementById('meta-terceira-data-fim').value = meta.dataFim;
    document.getElementById('meta-terceira-observacoes').value = meta.observacoes || '';
    
    // Alterar interface para modo edição
    const form = document.getElementById('form-meta-terceira');
    const btnText = document.getElementById('btn-submit-meta-terceira-text');
    
    form.setAttribute('data-editing-id', id);
    btnText.textContent = 'Atualizar Meta Terceira';
    
    Toast.show('Modo de edição ativado', 'info');
}

function editarLancamento(id) {
    const lancamento = DB.lancamentos.get(id);
    if (!lancamento) {
        Toast.show('Lançamento não encontrado', 'error');
        return;
    }
    
    // Preencher formulário
    document.getElementById('lancamento-frente').value = lancamento.frenteId;
    document.getElementById('lancamento-data').value = lancamento.data;
    document.getElementById('lancamento-colhido').value = lancamento.colhido;
    document.getElementById('lancamento-turno').value = lancamento.turno;
    document.getElementById('lancamento-operador').value = lancamento.operador || '';
    document.getElementById('lancamento-observacoes').value = lancamento.observacoes || '';
    
    // Alterar interface para modo edição
    const form = document.getElementById('form-lancamento');
    const btnText = document.getElementById('btn-submit-lancamento-text');
    
    form.setAttribute('data-editing-id', id);
    btnText.textContent = 'Atualizar Lançamento';
    
    Toast.show('Modo de edição ativado', 'info');
}

function excluirMeta(id, tipo) {
    const meta = DB.metas.get(id);
    if (!meta) {
        Toast.show('Meta não encontrada', 'error');
        return;
    }
    
    const frente = DB.frentes.get(meta.frenteId);
    const frenteNome = frente ? frente.nome : 'Frente não encontrada';
    
    // Modal de confirmação customizado
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
    modal.innerHTML = `
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 animate-fade-in">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Confirmar Exclusão</h3>
            <p class="text-gray-700 dark:text-gray-300 mb-4">
                Tem certeza que deseja excluir a meta da <strong>${frenteNome}</strong>?
            </p>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
                Esta ação não pode ser desfeita.
            </p>
            <div class="flex justify-end space-x-4">
                <button class="btn-cancelar px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                    Cancelar
                </button>
                <button class="btn-confirmar px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg text-sm transition-all-300">
                    Sim, Excluir
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Eventos do modal
    modal.querySelector('.btn-cancelar').addEventListener('click', () => {
        document.body.removeChild(modal);
    });
    
    modal.querySelector('.btn-confirmar').addEventListener('click', () => {
        try {
            DB.metas.remove(id);
            Toast.show('Meta excluída com sucesso', 'success');
            NotificationManager.add(`Meta ${tipo} de ${frenteNome} excluída`, 'warning');
            
            if (tipo === 'propria') {
                carregarMetasProprias();
            } else {
                carregarMetasTerceiras();
            }
        } catch (error) {
            Toast.show('Erro ao excluir meta: ' + error.message, 'error');
        }
        document.body.removeChild(modal);
    });
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            document.body.removeChild(modal);
        }
    });
}

function excluirLancamento(id) {
    const lancamento = DB.lancamentos.get(id);
    if (!lancamento) {
        Toast.show('Lançamento não encontrado', 'error');
        return;
    }
    
    const frente = DB.frentes.get(lancamento.frenteId);
    const frenteNome = frente ? frente.nome : 'Frente não encontrada';
    
    // Modal de confirmação customizado
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
    modal.innerHTML = `
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 animate-fade-in">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Confirmar Exclusão</h3>
            <p class="text-gray-700 dark:text-gray-300 mb-4">
                Tem certeza que deseja excluir o lançamento da <strong>${frenteNome}</strong> do dia <strong>${Utils.formatarData(lancamento.data)}</strong>?
            </p>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
                Esta ação não pode ser desfeita.
            </p>
            <div class="flex justify-end space-x-4">
                <button class="btn-cancelar px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                    Cancelar
                </button>
                <button class="btn-confirmar px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg text-sm transition-all-300">
                    Sim, Excluir
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Eventos do modal
    modal.querySelector('.btn-cancelar').addEventListener('click', () => {
        document.body.removeChild(modal);
    });
    
    modal.querySelector('.btn-confirmar').addEventListener('click', () => {
        try {
            DB.lancamentos.remove(id);
            Toast.show('Lançamento excluído com sucesso', 'success');
            NotificationManager.add(`Lançamento de ${frenteNome} excluído`, 'warning');
            carregarLancamentos();
        } catch (error) {
            Toast.show('Erro ao excluir lançamento: ' + error.message, 'error');
        }
        document.body.removeChild(modal);
    });
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            document.body.removeChild(modal);
        }
    });
}

// ===== CONFIGURAÇÕES =====

function inicializarConfiguracoes() {
    configurarEventosConfiguracoes();
}

function configurarEventosConfiguracoes() {
    // Backup e restauração
    document.getElementById('btn-exportar-json')?.addEventListener('click', exportarDados);
    document.getElementById('btn-importar-json')?.addEventListener('click', () => {
        document.getElementById('import-json-file').click();
    });
    
    document.getElementById('import-json-file')?.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            importarDados(file);
        }
    });
    
    // Limpar dados
    document.getElementById('btn-limpar-dados')?.addEventListener('click', () => {
        document.getElementById('modal-limpar-dados').classList.remove('hidden');
    });
    
    document.getElementById('btn-cancelar-limpar')?.addEventListener('click', () => {
        document.getElementById('modal-limpar-dados').classList.add('hidden');
        document.getElementById('confirmacao-texto').value = '';
    });
    
    document.getElementById('confirmacao-texto')?.addEventListener('input', function() {
        const btnConfirmar = document.getElementById('btn-confirmar-limpar');
        if (this.value === 'CONFIRMAR') {
            btnConfirmar.disabled = false;
            btnConfirmar.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
            btnConfirmar.disabled = true;
            btnConfirmar.classList.add('opacity-50', 'cursor-not-allowed');
        }
    });
    
    document.getElementById('btn-confirmar-limpar')?.addEventListener('click', limparTodosDados);
    
    // Relatórios
    document.getElementById('btn-relatorio-liberacoes')?.addEventListener('click', gerarRelatorioLiberacoes);
    document.getElementById('btn-relatorio-metas')?.addEventListener('click', gerarRelatorioMetas);
    document.getElementById('btn-relatorio-colheita')?.addEventListener('click', gerarRelatorioColheita);
}

function exportarDados() {
    try {
        Utils.showLoading(true);
        
        setTimeout(() => {
            try {
                const jsonData = DB.exportData();
                const blob = new Blob([jsonData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `ggomes_backup_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                
                URL.revokeObjectURL(url);
                Toast.show('Backup exportado com sucesso', 'success');
                NotificationManager.add('Backup de dados exportado', 'info');
                
            } catch (error) {
                console.error('Erro ao exportar dados:', error);
                Toast.show('Erro ao exportar dados: ' + error.message, 'error');
            } finally {
                Utils.showLoading(false);
            }
        }, 500);
        
    } catch (error) {
        console.error('Erro ao iniciar exportação:', error);
        Toast.show('Erro ao iniciar exportação', 'error');
        Utils.showLoading(false);
    }
}

function importarDados(file) {
    if (!file.type.includes('json')) {
        Toast.show('Por favor, selecione um arquivo JSON válido', 'error');
        return;
    }
    
    Utils.showLoading(true);
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const success = DB.importData(e.target.result);
            if (success) {
                Toast.show('Dados importados com sucesso', 'success');
                NotificationManager.add('Backup importado e dados restaurados', 'success');
                
                // Recarregar dados na interface
                setTimeout(() => {
                    if (getCurrentPage() === 'liberacoes') {
                        carregarLiberacoes();
                        carregarFiltrosLiberacoes();
                    } else if (getCurrentPage() === 'metas') {
                        atualizarSelectsFrente();
                        carregarFrente();
                        carregarMetasProprias();
                        carregarMetasTerceiras();
                        carregarLancamentos();
                    } else if (getCurrentPage() === 'dashboard') {
                        atualizarDashboard();
                    }
                }, 1000);
            }
        } catch (error) {
            console.error('Erro ao importar dados:', error);
            Toast.show('Erro ao importar dados: ' + error.message, 'error');
        } finally {
            Utils.showLoading(false);
            document.getElementById('import-json-file').value = '';
        }
    };
    
    reader.onerror = function() {
        Toast.show('Erro ao ler arquivo', 'error');
        Utils.showLoading(false);
    };
    
    reader.readAsText(file);
}

function limparTodosDados() {
    Utils.showLoading(true);
    
    setTimeout(() => {
        try {
            const success = DB.clearAll();
            if (success) {
                Toast.show('Todos os dados foram limpos com sucesso', 'success');
                NotificationManager.add('Sistema resetado - todos os dados foram removidos', 'warning');
                
                // Fechar modal
                document.getElementById('modal-limpar-dados').classList.add('hidden');
                document.getElementById('confirmacao-texto').value = '';
                
                // Recarregar interface
                setTimeout(() => {
                    location.reload();
                }, 1500);
            }
        } catch (error) {
            console.error('Erro ao limpar dados:', error);
            Toast.show('Erro ao limpar dados: ' + error.message, 'error');
        } finally {
            Utils.showLoading(false);
        }
    }, 1000);
}

function gerarRelatorioLiberacoes() {
    const liberacoes = DB.liberacoes.getAll();
    
    if (liberacoes.length === 0) {
        Toast.show('Não há liberações para gerar relatório', 'warning');
        return;
    }
    
    const colunas = [
        { header: 'Frente', dataKey: 'frente' },
        { header: 'Fazenda', dataKey: 'fazenda' },
        { header: 'Nº Liberação', dataKey: 'numero' },
        { header: 'Status', dataKey: item => Utils.getStatusConfig(item.status).texto },
        { header: 'Previsto (T)', dataKey: item => Utils.formatarToneladas(item.previsto) },
        { header: 'Realizado (T)', dataKey: item => Utils.formatarToneladas(item.realizado) },
        { header: 'Restante (T)', dataKey: item => Utils.formatarToneladas(item.restante) },
        { header: '% Progresso', dataKey: item => ((item.realizado / item.previsto) * 100).toFixed(1) + '%' },
        { header: 'Data', dataKey: item => Utils.formatarData(item.data) },
        { header: 'Observações', dataKey: 'observacoes' }
    ];
    
    Utils.exportarPDF(
        'Relatório Completo de Liberações',
        liberacoes,
        colunas,
        `relatorio_liberacoes_${new Date().toISOString().split('T')[0]}.pdf`
    );
}

function gerarRelatorioMetas() {
    const metas = DB.metas.getAll();
    
    if (metas.length === 0) {
        Toast.show('Não há metas para gerar relatório', 'warning');
        return;
    }
    
    const dadosRelatorio = metas.map(meta => {
        const frente = DB.frentes.get(meta.frenteId);
        const frenteNome = frente ? frente.nome : 'Frente não encontrada';
        const fazenda = frente ? frente.fazenda : '-';
        
        return {
            frente: frenteNome,
            fazenda: fazenda,
            tipo: Utils.getTipoConfig(meta.tipo).texto,
            periodo: meta.periodo.charAt(0).toUpperCase() + meta.periodo.slice(1),
            valor: meta.valor,
            dataInicio: meta.dataInicio,
            dataFim: meta.dataFim,
            observacoes: meta.observacoes || '-'
        };
    });
    
    const colunas = [
        { header: 'Frente', dataKey: 'frente' },
        { header: 'Fazenda', dataKey: 'fazenda' },
        { header: 'Tipo', dataKey: 'tipo' },
        { header: 'Período', dataKey: 'periodo' },
        { header: 'Meta (T)', dataKey: item => Utils.formatarToneladas(item.valor) },
        { header: 'Data Início', dataKey: item => Utils.formatarData(item.dataInicio) },
        { header: 'Data Fim', dataKey: item => Utils.formatarData(item.dataFim) },
        { header: 'Observações', dataKey: 'observacoes' }
    ];
    
    Utils.exportarPDF(
        'Relatório Completo de Metas',
        dadosRelatorio,
        colunas,
        `relatorio_metas_${new Date().toISOString().split('T')[0]}.pdf`
    );
}

function gerarRelatorioColheita() {
    const lancamentos = DB.lancamentos.getAll();
    
    if (lancamentos.length === 0) {
        Toast.show('Não há lançamentos para gerar relatório', 'warning');
        return;
    }
    
    const dadosRelatorio = lancamentos.map(lancamento => {
        const frente = DB.frentes.get(lancamento.frenteId);
        const frenteNome = frente ? frente.nome : 'Frente não encontrada';
        const fazenda = frente ? frente.fazenda : '-';
        const tipoFrente = frente ? Utils.getTipoConfig(frente.tipo).texto : 'Desconhecido';
        
        return {
            data: lancamento.data,
            frente: frenteNome,
            fazenda: fazenda,
            tipo: tipoFrente,
            colhido: lancamento.colhido,
            turno: lancamento.turno,
            operador: lancamento.operador || '-',
            observacoes: lancamento.observacoes || '-'
        };
    }).sort((a, b) => new Date(b.data) - new Date(a.data));
    
    const colunas = [
        { header: 'Data', dataKey: item => Utils.formatarData(item.data) },
        { header: 'Frente', dataKey: 'frente' },
        { header: 'Fazenda', dataKey: 'fazenda' },
        { header: 'Tipo', dataKey: 'tipo' },
        { header: 'Colhido (T)', dataKey: item => Utils.formatarToneladas(item.colhido) },
        { header: 'Turno', dataKey: item => item.turno.charAt(0).toUpperCase() + item.turno.slice(1) },
        { header: 'Operador', dataKey: 'operador' },
        { header: 'Observações', dataKey: 'observacoes' }
    ];
    
    Utils.exportarPDF(
        'Relatório Completo de Colheita',
        dadosRelatorio,
        colunas,
        `relatorio_colheita_${new Date().toISOString().split('T')[0]}.pdf`
    );
}

// ===== SISTEMA DE NAVEGAÇÃO E ABAS =====

function initializeApp() {
    DB.init();
    NotificationManager.load();
    
    setupTheme();
    setupNavigation();
    setupMobileMenu();
    setupNotifications();
    setupCurrentDate();
    ChartManager.init();
    
    atualizarSelectsFrente();
    navigateToPage('dashboard');
    
    // Auto-refresh dos dados se habilitado
    const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
    if (config.preferences?.autoRefresh) {
        setInterval(() => {
            if (getCurrentPage() === 'dashboard') {
                atualizarDashboard();
            }
        }, 60000); // 1 minuto
    }
    
    Toast.show('Sistema GGOMES-LOG v2.1 Avançado carregado', 'success', 3000);
}

function setupTheme() {
    const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
    
    if (config.temaEscuro) {
        document.documentElement.classList.add('dark');
    }
    
    // Auto detecção do tema do sistema
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches && !config.hasOwnProperty('temaEscuro')) {
        document.documentElement.classList.add('dark');
        config.temaEscuro = true;
        localStorage.setItem('ggomes_config', JSON.stringify(config));
    }
    
    // Listener para mudanças no tema do sistema
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
        if (!config.hasOwnProperty('temaEscuro')) {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
    });
    
    // Toggle do tema
    document.getElementById('toggle-theme')?.addEventListener('click', function() {
        const isDark = document.documentElement.classList.toggle('dark');
        const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
        config.temaEscuro = isDark;
        localStorage.setItem('ggomes_config', JSON.stringify(config));
        
        // Recriar gráficos com o novo tema
        setTimeout(() => {
            ChartManager.updateCharts();
        }, 100);
        
        Toast.show(`Tema ${isDark ? 'escuro' : 'claro'} ativado`, 'info', 2000);
    });
}

function setupNavigation() {
    document.querySelectorAll('.sidebar-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const page = this.getAttribute('href').substring(1);
            navigateToPage(page);
        });
    });
    
    // Sistema de abas
    document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', function() {
            const tabName = this.getAttribute('data-tab');
            switchTab(tabName);
        });
    });
}

function setupMobileMenu() {
    const mobileToggle = document.getElementById('mobile-menu-toggle');
    const appContainer = document.getElementById('app-container');
    
    if (mobileToggle && appContainer) {
        mobileToggle.addEventListener('click', function() {
            appContainer.classList.toggle('sidebar-open');
        });
        
        // Fechar sidebar ao clicar fora
        appContainer.addEventListener('click', function(e) {
            if (appContainer.classList.contains('sidebar-open') && 
                !e.target.closest('aside') && 
                !e.target.closest('#mobile-menu-toggle')) {
                appContainer.classList.remove('sidebar-open');
            }
        });
    }
}

function setupNotifications() {
    document.getElementById('btn-notifications')?.addEventListener('click', function() {
        const modal = document.getElementById('modal-notifications');
        if (modal) {
            modal.classList.remove('hidden');
            renderNotifications();
        }
    });
    
    document.getElementById('btn-close-notifications')?.addEventListener('click', function() {
        document.getElementById('modal-notifications').classList.add('hidden');
    });
    
    document.getElementById('btn-clear-notifications')?.addEventListener('click', function() {
        NotificationManager.clear();
        renderNotifications();
        Toast.show('Notificações limpas', 'info', 2000);
    });
}

function setupCurrentDate() {
    const updateDate = () => {
        const now = new Date();
        document.getElementById('current-date').textContent = now.toLocaleDateString('pt-BR');
    };
    
    updateDate();
    setInterval(updateDate, 60000); // Atualizar a cada minuto
}

function navigateToPage(page) {
    // Ocultar todas as páginas
    document.querySelectorAll('.content').forEach(content => {
        content.classList.add('hidden');
    });
    
    // Remover classe active de todos os links
    document.querySelectorAll('.sidebar-link').forEach(link => {
        link.classList.remove('active', 'bg-primary-100', 'dark:bg-primary-900', 'text-primary-700', 'dark:text-primary-300');
        link.classList.add('text-gray-700', 'dark:text-gray-300');
    });
    
    // Mostrar página selecionada
    const targetContent = document.getElementById(`content-${page}`);
    if (targetContent) {
        targetContent.classList.remove('hidden');
    }
    
    // Marcar link como ativo
    const activeLink = document.querySelector(`.sidebar-link[href="#${page}"]`);
    if (activeLink) {
        activeLink.classList.add('active', 'bg-primary-100', 'dark:bg-primary-900', 'text-primary-700', 'dark:text-primary-300');
        activeLink.classList.remove('text-gray-700', 'dark:text-gray-300');
    }
    
    // Atualizar título da página
    const titles = {
        'dashboard': 'Dashboard',
        'liberacoes': 'Liberações',
        'metas': 'Metas de Colheita',
        'configuracoes': 'Configurações'
    };
    
    const subtitles = {
        'dashboard': 'Visão geral do sistema e indicadores principais',
        'liberacoes': 'Gerenciamento de liberações de produção',
        'metas': 'Gestão completa de frentes próprias/terceiras, metas e acompanhamento da colheita',
        'configuracoes': 'Configurações do sistema e gestão de dados'
    };
    
    document.getElementById('page-title').textContent = titles[page] || 'GGOMES-LOG';
    document.getElementById('page-subtitle').textContent = subtitles[page] || '';
    
    // Inicializar funcionalidades específicas da página
    switch(page) {
        case 'dashboard':
            inicializarDashboard();
            atualizarDashboard();
            break;
        case 'liberacoes':
            inicializarLiberacoes();
            break;
        case 'metas':
            inicializarFrente();
            inicializarMetas();
            // Inicializar acompanhamento avançado
            setTimeout(() => {
                configurarFiltrosAcompanhamento();
                atualizarAcompanhamento();
            }, 100);
            break;
        case 'configuracoes':
            inicializarConfiguracoes();
            break;
    }
    
    // Fechar menu mobile
    document.getElementById('app-container')?.classList.remove('sidebar-open');
}

function getCurrentPage() {
    const activeLink = document.querySelector('.sidebar-link.active');
    if (activeLink) {
        return activeLink.getAttribute('href').substring(1);
    }
    return 'dashboard';
}

function switchTab(tabName) {
    // Ocultar todas as abas
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
    });
    
    // Remover classe active de todos os botões
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active', 'border-primary-500', 'text-primary-600', 'dark:text-primary-400');
        button.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
    });
    
    // Mostrar aba selecionada
    const targetTab = document.getElementById(`tab-${tabName}`);
    if (targetTab) {
        targetTab.classList.remove('hidden');
    }
    
    // Marcar botão como ativo
    const activeButton = document.querySelector(`.tab-button[data-tab="${tabName}"]`);
    if (activeButton) {
        activeButton.classList.add('active', 'border-primary-500', 'text-primary-600', 'dark:text-primary-400');
        activeButton.classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-400');
    }
    
    // Inicializar funcionalidades específicas da aba
    if (tabName === 'acompanhamento') {
        configurarFiltrosAcompanhamento();
        atualizarAcompanhamento();
    }
}

function configurarFiltrosAcompanhamento() {
    // Eventos dos filtros
    document.getElementById('btn-aplicar-filtro-acompanhamento')?.addEventListener('click', function() {
        AcompanhamentoCache.clear();
        atualizarAcompanhamento();
        Toast.show('Filtros aplicados', 'info', 2000);
    });
    
    document.getElementById('btn-limpar-filtro-acompanhamento')?.addEventListener('click', function() {
        document.getElementById('filtro-acompanhamento-frente').value = '';
        document.getElementById('filtro-acompanhamento-tipo').value = '';
        document.getElementById('filtro-acompanhamento-data-inicio').value = '';
        document.getElementById('filtro-acompanhamento-data-fim').value = '';
        document.getElementById('filtro-incluir-inativos').checked = false;
        
        AcompanhamentoCache.clear();
        atualizarAcompanhamento();
        Toast.show('Filtros limpos', 'info', 2000);
    });
    
    document.getElementById('btn-auto-refresh-acompanhamento')?.addEventListener('click', function() {
        const isActive = this.classList.contains('bg-blue-600');
        
        if (isActive) {
            // Desativar auto-refresh
            this.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            this.classList.add('bg-gray-500', 'hover:bg-gray-600');
            this.innerHTML = '<i class="fas fa-sync-alt mr-2"></i> Auto-Refresh';
            
            if (AppConfig.refreshInterval) {
                clearInterval(AppConfig.refreshInterval);
                AppConfig.refreshInterval = null;
            }
            
            Toast.show('Auto-refresh desativado', 'info', 2000);
        } else {
            // Ativar auto-refresh
            this.classList.remove('bg-gray-500', 'hover:bg-gray-600');
            this.classList.add('bg-blue-600', 'hover:bg-blue-700');
            this.innerHTML = '<i class="fas fa-sync-alt mr-2 animate-spin"></i> Auto-Refresh (Ativo)';
            
            AppConfig.refreshInterval = setInterval(() => {
                if (getCurrentPage() === 'metas' && document.getElementById('tab-acompanhamento').classList.contains('hidden') === false) {
                    AcompanhamentoCache.clear();
                    atualizarAcompanhamento();
                }
            }, 30000); // 30 segundos
            
            Toast.show('Auto-refresh ativado (30s)', 'success', 2000);
        }
    });
    
    document.getElementById('btn-exportar-acompanhamento')?.addEventListener('click', function() {
        const filtros = obterFiltrosAcompanhamento();
        const resultado = calcularDadosAcompanhamento(filtros);
        
        if (resultado.dados.length === 0) {
            Toast.show('Não há dados para exportar', 'warning');
            return;
        }
        
        const dadosRelatorio = resultado.dados.map(item => ({
            frente: item.frente.nome,
            fazenda: item.frente.fazenda,
            tipo: Utils.getTipoConfig(item.frente.tipo).texto,
            metaTotal: item.metaTotal,
            colhidoTotal: item.colhidoTotal,
            restante: item.restante,
            percentualMeta: item.percentualMeta,
            status: item.statusAvancado.texto,
            tendencia: item.tendencia.texto,
            eficiencia: item.eficiencia,
            ultimoLancamento: item.ultimoLancamento ? Utils.formatarData(item.ultimoLancamento.data) : 'Nunca',
            diasSemColheita: item.diasSemColheita >= 0 ? item.diasSemColheita : '-'
        }));
        
        const colunas = [
            { header: 'Frente', dataKey: 'frente' },
            { header: 'Fazenda', dataKey: 'fazenda' },
            { header: 'Tipo', dataKey: 'tipo' },
            { header: 'Meta (T)', dataKey: item => Utils.formatarToneladas(item.metaTotal) },
            { header: 'Colhido (T)', dataKey: item => Utils.formatarToneladas(item.colhidoTotal) },
            { header: 'Restante (T)', dataKey: item => Utils.formatarToneladas(item.restante) },
            { header: '% Meta', dataKey: item => item.percentualMeta.toFixed(1) + '%' },
            { header: 'Status', dataKey: 'status' },
            { header: 'Tendência', dataKey: 'tendencia' },
            { header: 'Eficiência (%)', dataKey: item => item.eficiencia.toFixed(1) + '%' },
            { header: 'Último Lançamento', dataKey: 'ultimoLancamento' },
            { header: 'Dias sem Colheita', dataKey: 'diasSemColheita' }
        ];
        
        Utils.exportarPDF(
            'Relatório Avançado de Acompanhamento',
            dadosRelatorio,
            colunas,
            `acompanhamento_avancado_${new Date().toISOString().split('T')[0]}.pdf`
        );
    });
    
    document.getElementById('btn-refresh-acompanhamento')?.addEventListener('click', function() {
        AcompanhamentoCache.clear();
        atualizarAcompanhamento();
        Toast.show('Dados atualizados', 'success', 2000);
    });
}

function renderNotifications() {
    const container = document.getElementById('notifications-list');
    if (!container) return;
    
    container.innerHTML = '';
    
    if (AppConfig.notifications.length === 0) {
        container.innerHTML = `
            <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                <i class="fas fa-bell-slash text-3xl mb-2"></i>
                <p>Nenhuma notificação</p>
            </div>
        `;
        return;
    }
    
    AppConfig.notifications.slice(0, 20).forEach(notification => {
        const iconClass = {
            'success': 'fa-check-circle text-green-500',
            'error': 'fa-exclamation-circle text-red-500',
            'warning': 'fa-exclamation-triangle text-yellow-500',
            'info': 'fa-info-circle text-blue-500'
        }[notification.type] || 'fa-info-circle text-blue-500';
        
        const timeAgo = calcularTempoDecorrido(new Date(notification.timestamp));
        
        const notificationElement = document.createElement('div');
        notificationElement.className = `flex items-start space-x-3 p-3 rounded-lg ${notification.read ? 'bg-gray-50 dark:bg-gray-700/50' : 'bg-blue-50 dark:bg-blue-900/20'} hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors cursor-pointer`;
        notificationElement.innerHTML = `
            <div class="flex-shrink-0 pt-1">
                <i class="fas ${iconClass}"></i>
            </div>
            <div class="flex-1 min-w-0">
                <p class="text-sm ${notification.read ? 'text-gray-600 dark:text-gray-400' : 'text-gray-900 dark:text-gray-100 font-medium'}">${notification.message}</p>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">${timeAgo}</p>
            </div>
        `;
        
        notificationElement.addEventListener('click', () => {
            NotificationManager.markAsRead(notification.id);
            renderNotifications();
        });
        
        container.appendChild(notificationElement);
    });
}

// ===== INICIALIZAÇÃO DA APLICAÇÃO =====

document.addEventListener('DOMContentLoaded', function() {
    try {
        initializeApp();
    } catch (error) {
        console.error('Erro ao inicializar aplicação:', error);
        Toast.show('Erro ao carregar sistema. Tente recarregar a página.', 'error');
    }
});

// ===== TRATAMENTO DE ERROS GLOBAIS =====

window.addEventListener('error', function(e) {
    console.error('Erro JavaScript:', e.error);
    Toast.show('Ocorreu um erro inesperado. Verifique o console.', 'error');
});

window.addEventListener('unhandledrejection', function(e) {
    console.error('Promise rejeitada:', e.reason);
    Toast.show('Erro de operação assíncrona. Tente novamente.', 'error');
});

// ===== EXPORTAR FUNÇÕES GLOBAIS PARA DEBUG =====

window.GGOMES_DEBUG = {
    DB,
    Utils,
    Toast,
    NotificationManager,
    ChartManager,
    AppConfig,
    AcompanhamentoCache
};

</script>
</body>
</html>
