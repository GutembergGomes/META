<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GGOMES-LOG | Sistema de Gestão Agrícola</title>
    
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- jsPDF para relatórios -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@3.5.28/dist/jspdf.plugin.autotable.js"></script>
    
    <!-- Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                colors: {
                    primary: {
                        50: '#f4f3ff',
                        100: '#e9e8ff',
                        200: '#d7d5ff',
                        300: '#bab8ff',
                        400: '#9a97ff',
                        500: '#7c7aff',
                        600: '#5D5CDE',
                        700: '#5a55cc',
                        800: '#4a46a8',
                        900: '#383670',
                        950: '#201f45',
                    }
                },
                fontFamily: {
                    'sans': ['Inter', 'system-ui', 'sans-serif'],
                },
                spacing: {
                    '128': '32rem',
                },
                animation: {
                    'fade-in': 'fadeIn 0.3s ease-out forwards',
                    'fade-out': 'fadeOut 0.3s ease-in forwards',
                    'slide-in': 'slideIn 0.3s ease-out forwards',
                    'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                }
            }
        }
    }
    </script>
    
    <style>
        /* Animações customizadas */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-10px); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* Scrollbar personalizada */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .scrollbar-thin::-webkit-scrollbar { width: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: rgba(156, 163, 175, 0.5);
            border-radius: 3px;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background-color: rgba(156, 163, 175, 0.7);
        }
        
        /* Estados de carregamento */
        .loading { position: relative; }
        .loading::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: inherit;
            z-index: 10;
        }
        .dark .loading::after { background: rgba(0, 0, 0, 0.8); }
        
        /* Transições suaves */
        .transition-all-300 { transition: all 0.3s ease-in-out; }
        
        /* Efeitos hover personalizados */
        .hover-scale:hover { transform: scale(1.02); }
        
        /* Grid responsivo melhorado */
        .grid-responsive {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
        
        /* Cards com sombra suave */
        .card-shadow {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .dark .card-shadow {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px 0 rgba(0, 0, 0, 0.2);
        }
        
        /* Sidebar mobile melhorado */
        @media (max-width: 768px) {
            #app-container { position: relative; overflow-x: hidden; }
            #app-container aside {
                position: fixed;
                left: -100%;
                transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                height: 100vh;
                z-index: 50;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }
            #app-container.sidebar-open aside { left: 0; }
            #app-container.sidebar-open::before {
                content: '';
                position: fixed;
                top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 40;
            }
        }
        
        /* Estados de formulário */
        .form-error {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 1px #ef4444 !important;
        }
        .form-success {
            border-color: #10b981 !important;
            box-shadow: 0 0 0 1px #10b981 !important;
        }
        
        /* Indicadores de progresso */
        .progress-bar { transition: width 0.5s ease-in-out; }
        
        /* Botões com estado loading */
        .btn-loading { position: relative; pointer-events: none; }
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px; height: 16px;
            margin: auto;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <!-- Container principal da aplicação -->
    <div id="app-container" class="flex h-screen overflow-hidden">
        <!-- Menu lateral (Sidebar) -->
        <aside class="w-64 hidden md:block bg-white dark:bg-gray-800 card-shadow z-10 flex-shrink-0">
            <div class="h-full flex flex-col">
                <!-- Logo e título -->
                <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-center">
                    <div class="text-center">
                        <h1 class="text-xl font-bold text-primary-600 dark:text-primary-400">GGOMES-LOG</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Gestão Agrícola</p>
                    </div>
                </div>
                
                <!-- Informações do usuário -->
                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center">
                        <div class="h-10 w-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center">
                            <i class="fas fa-user text-primary-600 dark:text-primary-400"></i>
                        </div>
                        <div class="ml-3">
                            <p id="sidebar-user-name" class="font-medium text-gray-800 dark:text-white">Administrador</p>
                            <p id="sidebar-user-role" class="text-xs text-gray-500 dark:text-gray-400">Administrador</p>
                        </div>
                    </div>
                </div>
                
                <!-- Links de navegação -->
                <div class="py-4 flex-1 overflow-y-auto scrollbar-thin">
                    <nav class="px-2 space-y-1">
                        <div class="px-3 py-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Dashboard
                        </div>
                        
                        <a href="#dashboard" class="sidebar-link flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md font-medium mb-1 transition-all-300">
                            <i class="fas fa-chart-pie mr-3 text-lg"></i>
                            <span>Dashboard</span>
                        </a>
                        
                        <div class="px-3 py-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Produção
                        </div>
                        
                        <a href="#liberacoes" class="sidebar-link active bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300 flex items-center px-4 py-2 rounded-md font-medium mb-1 transition-all-300">
                            <i class="fas fa-tasks mr-3 text-lg"></i>
                            <span>Liberações</span>
                        </a>

                        <a href="#metas" class="sidebar-link flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md font-medium mb-1 transition-all-300">
                            <i class="fas fa-bullseye mr-3 text-lg"></i>
                            <span>Metas de Colheita</span>
                        </a>
                        
                        <div class="px-3 py-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            Sistema
                        </div>
                        
                        <a href="#configuracoes" class="sidebar-link flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md font-medium mb-1 transition-all-300">
                            <i class="fas fa-cog mr-3 text-lg"></i>
                            <span>Configurações</span>
                        </a>
                    </nav>
                </div>
                
                <!-- Rodapé do sidebar -->
                <div class="p-4 border-t border-gray-200 dark:border-gray-700 text-center">
                    <p class="text-xs text-gray-500 dark:text-gray-400">GGOMES-LOG &copy; 2025</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Versão 2.1</p>
                </div>
            </div>
        </aside>
        
        <!-- Conteúdo principal -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Barra superior (Header) -->
            <header class="bg-white dark:bg-gray-800 card-shadow z-10">
                <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                    <!-- Toggle do menu lateral (mobile) -->
                    <button id="mobile-menu-toggle" class="md:hidden p-2 rounded-md text-gray-500 hover:text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:bg-gray-700 transition-all-300">
                        <i class="fas fa-bars"></i>
                    </button>
                    
                    <!-- Título da página -->
                    <div class="flex-1 text-center md:text-left">
                        <h2 id="page-title" class="text-lg font-semibold text-gray-800 dark:text-white">Liberações</h2>
                        <p id="page-subtitle" class="text-sm text-gray-500 dark:text-gray-400 hidden md:block">Gerenciamento de liberações de produção</p>
                    </div>
                    
                    <!-- Ações e perfil do usuário -->
                    <div class="flex items-center space-x-3">
                        <!-- Busca rápida -->
                        <div class="hidden lg:block relative">
                            <input type="text" id="search-global" placeholder="Buscar..." class="pl-8 pr-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all-300">
                            <i class="fas fa-search absolute left-2.5 top-2 text-gray-400 text-xs"></i>
                        </div>
                        
                        <!-- Notificações -->
                        <button id="btn-notifications" class="relative p-2 rounded-md text-gray-500 hover:text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:bg-gray-700 transition-all-300">
                            <i class="fas fa-bell"></i>
                            <span id="notification-badge" class="absolute -top-1 -right-1 h-4 w-4 bg-red-500 text-white rounded-full text-xs flex items-center justify-center hidden">0</span>
                        </button>
                        
                        <!-- Data atual -->
                        <div class="hidden sm:block mr-2">
                            <span id="current-date" class="text-sm text-gray-600 dark:text-gray-400">--/--/----</span>
                        </div>
                        
                        <!-- Toggle de tema claro/escuro -->
                        <button id="toggle-theme" class="p-2 rounded-md text-gray-500 hover:text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:bg-gray-700 transition-all-300">
                            <i class="fas fa-moon dark:hidden"></i>
                            <i class="fas fa-sun hidden dark:inline-block"></i>
                        </button>
                        
                        <!-- Perfil do usuário -->
                        <div class="flex items-center">
                            <div class="mr-2 text-right hidden sm:block">
                                <div id="user-name" class="text-sm font-medium text-gray-800 dark:text-white">Administrador</div>
                                <div class="flex items-center">
                                    <span id="user-role-badge" class="px-2 py-1 rounded text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300">Admin</span>
                                </div>
                            </div>
                            <div class="h-8 w-8 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center">
                                <i class="fas fa-user text-primary-600 dark:text-primary-400"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Conteúdo principal -->
            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 dark:bg-gray-900 p-4">
                <!-- Toast container para mensagens -->
                <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-4"></div>
                
                <!-- Loading overlay global -->
                <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 flex items-center space-x-3">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"></div>
                        <span class="text-gray-700 dark:text-gray-300">Carregando...</span>
                    </div>
                </div>
                
                <!-- Conteúdo de Dashboard -->
                <div id="content-dashboard" class="content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">Dashboard</h2>
                        <p class="text-gray-600 dark:text-gray-400">Visão geral do sistema e indicadores principais</p>
                    </div>
                    
                    <!-- Cards de estatísticas -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 hover-scale transition-all-300">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-blue-100 dark:bg-blue-900">
                                    <i class="fas fa-tasks text-blue-600 dark:text-blue-400 text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Liberações</p>
                                    <p id="dash-total-liberacoes" class="text-2xl font-bold text-gray-900 dark:text-white">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 hover-scale transition-all-300">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-green-100 dark:bg-green-900">
                                    <i class="fas fa-chart-line text-green-600 dark:text-green-400 text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Colhido</p>
                                    <p id="dash-total-colhido" class="text-2xl font-bold text-gray-900 dark:text-white">0 T</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 hover-scale transition-all-300">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-yellow-100 dark:bg-yellow-900">
                                    <i class="fas fa-bullseye text-yellow-600 dark:text-yellow-400 text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Metas Próprias</p>
                                    <p id="dash-metas-proprias" class="text-2xl font-bold text-gray-900 dark:text-white">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 hover-scale transition-all-300">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-orange-100 dark:bg-orange-900">
                                    <i class="fas fa-handshake text-orange-600 dark:text-orange-400 text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Metas Terceiras</p>
                                    <p id="dash-metas-terceiras" class="text-2xl font-bold text-gray-900 dark:text-white">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 hover-scale transition-all-300">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-purple-100 dark:bg-purple-900">
                                    <i class="fas fa-map-marker-alt text-purple-600 dark:text-purple-400 text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Frentes Ativas</p>
                                    <p id="dash-frentes-ativas" class="text-2xl font-bold text-gray-900 dark:text-white">0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráficos -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Gráfico de liberações por status -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Liberações por Status</h3>
                            <div class="h-64">
                                <canvas id="chart-liberacoes-status"></canvas>
                            </div>
                        </div>
                        
                        <!-- Gráfico de metas por tipo -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Metas por Tipo</h3>
                            <div class="h-64">
                                <canvas id="chart-metas-tipo"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabelas resumidas -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Liberações recentes -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Liberações Recentes</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Frente</th>
                                            <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Status</th>
                                            <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Progresso</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dash-liberacoes-recentes" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Preenchido dinamicamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Desempenho das frentes por tipo -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Desempenho por Tipo</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Frente</th>
                                            <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Tipo</th>
                                            <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">% Atingido</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dash-desempenho-frentes" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Preenchido dinamicamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Conteúdo de Liberações -->
                <div id="content-liberacoes" class="content">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">Liberações</h2>
                        <p class="text-gray-600 dark:text-gray-400">Gerenciamento completo de liberações de produção</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Formulário de liberação -->
                        <div class="lg:col-span-1">
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Nova Liberação</h3>
                                    <button id="btn-clear-form-liberacao" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                
                                <form id="form-liberacao" class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-frente">
                                            Frente <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="liberacao-frente" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: Frente 01" required>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-fazenda">
                                            Fazenda <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="liberacao-fazenda" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: Fazenda São João" required>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-numero">
                                            Número da Liberação
                                        </label>
                                        <input type="text" id="liberacao-numero" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: LIB-2025-001">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-status">
                                            Status <span class="text-red-500">*</span>
                                        </label>
                                        <select id="liberacao-status" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="aberto">Aberto</option>
                                            <option value="fechado">Fechado</option>
                                            <option value="em-andamento">Em Andamento</option>
                                            <option value="cancelado">Cancelado</option>
                                        </select>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-previsto">
                                                Previsto (T) <span class="text-red-500">*</span>
                                            </label>
                                            <input type="number" step="0.01" id="liberacao-previsto" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="1000" required>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-realizado">
                                                Realizado (T) <span class="text-red-500">*</span>
                                            </label>
                                            <input type="number" step="0.01" id="liberacao-realizado" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="850" required>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-data">
                                            Data <span class="text-red-500">*</span>
                                        </label>
                                        <input type="date" id="liberacao-data" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="liberacao-observacoes">
                                            Observações
                                        </label>
                                        <textarea id="liberacao-observacoes" rows="3" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Observações adicionais"></textarea>
                                    </div>
                                    
                                    <div class="flex items-center space-x-3 pt-4">
                                        <button type="submit" id="btn-submit-liberacao" class="flex-1 inline-flex items-center justify-center px-4 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                            <i class="fas fa-save mr-2"></i> 
                                            <span id="btn-submit-text">Salvar Liberação</span>
                                        </button>
                                        <button type="button" id="btn-cancel-liberacao" class="px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Resumo e tabela -->
                        <div class="lg:col-span-2">
                            <!-- Filtros e busca -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 mb-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Filtros e Busca</h3>
                                    <div class="flex space-x-2">
                                        <button id="btn-clear-filters" class="px-3 py-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 transition-colors">
                                            <i class="fas fa-times mr-1"></i> Limpar
                                        </button>
                                        <button id="btn-export-liberacoes" class="inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-all-300 hover-scale">
                                            <i class="fas fa-file-export mr-2"></i> Exportar
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Busca -->
                                <div class="mb-4">
                                    <div class="relative">
                                        <input type="text" id="search-liberacoes" placeholder="Buscar por frente, fazenda, número..." class="pl-10 pr-4 py-2 w-full border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all-300">
                                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                    </div>
                                </div>
                                
                                <!-- Filtros -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="filtro-liberacao-frente">
                                            Frente
                                        </label>
                                        <select id="filtro-liberacao-frente" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300">
                                            <option value="">Todas</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="filtro-liberacao-fazenda">
                                            Fazenda
                                        </label>
                                        <select id="filtro-liberacao-fazenda" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300">
                                            <option value="">Todas</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="filtro-liberacao-status">
                                            Status
                                        </label>
                                        <select id="filtro-liberacao-status" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300">
                                            <option value="">Todos</option>
                                            <option value="aberto">Aberto</option>
                                            <option value="fechado">Fechado</option>
                                            <option value="em-andamento">Em Andamento</option>
                                            <option value="cancelado">Cancelado</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Resumo expandido -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 mb-6">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Resumo</h3>
                                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 p-4 rounded-lg text-center">
                                        <div class="text-xs text-blue-600 dark:text-blue-400 font-medium mb-1">Total Previsto</div>
                                        <div id="resumo-total-previsto" class="text-xl font-bold text-blue-800 dark:text-blue-300">0 T</div>
                                    </div>
                                    <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30 p-4 rounded-lg text-center">
                                        <div class="text-xs text-green-600 dark:text-green-400 font-medium mb-1">Total Realizado</div>
                                        <div id="resumo-total-realizado" class="text-xl font-bold text-green-800 dark:text-green-300">0 T</div>
                                    </div>
                                    <div class="bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/30 dark:to-red-800/30 p-4 rounded-lg text-center">
                                        <div class="text-xs text-red-600 dark:text-red-400 font-medium mb-1">Total Restante</div>
                                        <div id="resumo-total-restante" class="text-xl font-bold text-red-800 dark:text-red-300">0 T</div>
                                    </div>
                                    <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30 p-4 rounded-lg text-center">
                                        <div class="text-xs text-green-600 dark:text-green-400 font-medium mb-1">Aberto</div>
                                        <div id="resumo-status-aberto" class="text-xl font-bold text-green-800 dark:text-green-300">0</div>
                                    </div>
                                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 p-4 rounded-lg text-center">
                                        <div class="text-xs text-blue-600 dark:text-blue-400 font-medium mb-1">Fechado</div>
                                        <div id="resumo-status-fechado" class="text-xl font-bold text-blue-800 dark:text-blue-300">0</div>
                                    </div>
                                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/30 dark:to-purple-800/30 p-4 rounded-lg text-center">
                                        <div class="text-xs text-purple-600 dark:text-purple-400 font-medium mb-1">Total Geral</div>
                                        <div id="resumo-total-geral" class="text-xl font-bold text-purple-800 dark:text-purple-300">0</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tabela de liberações -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Liberações</h3>
                                    <div class="flex items-center space-x-2">
                                        <span id="results-count" class="text-sm text-gray-500 dark:text-gray-400">0 resultados</span>
                                        <button id="btn-refresh-liberacoes" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort="frente">
                                                    Frente <i class="fas fa-sort ml-1"></i>
                                                </th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort="fazenda">
                                                    Fazenda <i class="fas fa-sort ml-1"></i>
                                                </th>
                                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Nº Liberação</th>
                                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort="status">
                                                    Status <i class="fas fa-sort ml-1"></i>
                                                </th>
                                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort="previsto">
                                                    Previsto <i class="fas fa-sort ml-1"></i>
                                                </th>
                                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors" data-sort="realizado">
                                                    Realizado <i class="fas fa-sort ml-1"></i>
                                                </th>
                                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Restante</th>
                                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Progresso</th>
                                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabela-liberacoes" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Preenchido dinamicamente -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Paginação -->
                                <div id="pagination-liberacoes" class="flex items-center justify-between mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <!-- Preenchido dinamicamente -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Conteúdo de Metas de Colheita -->
                <div id="content-metas" class="content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">Metas de Colheita</h2>
                        <p class="text-gray-600 dark:text-gray-400">Gestão completa de frentes próprias/terceiras, metas e acompanhamento da colheita</p>
                    </div>
                    
                    <!-- Abas de Metas -->
                    <div class="mb-6">
                        <div class="border-b border-gray-200 dark:border-gray-700">
                            <nav class="-mb-px flex space-x-8">
                                <button class="tab-button active py-2 px-1 border-b-2 border-primary-500 font-medium text-sm text-primary-600 dark:text-primary-400 transition-all-300" data-tab="frentes">
                                    <i class="fas fa-map-marker-alt mr-2"></i>Frentes
                                </button>
                                <button class="tab-button py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 transition-all-300" data-tab="metas-proprias">
                                    <i class="fas fa-home mr-2"></i>Metas Próprias
                                </button>
                                <button class="tab-button py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 transition-all-300" data-tab="metas-terceiras">
                                    <i class="fas fa-handshake mr-2"></i>Metas Terceiras
                                </button>
                                <button class="tab-button py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 transition-all-300" data-tab="diario">
                                    <i class="fas fa-calendar-day mr-2"></i>Lançamento Diário
                                </button>
                                <button class="tab-button py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 transition-all-300" data-tab="acompanhamento">
                                    <i class="fas fa-chart-line mr-2"></i>Acompanhamento
                                </button>
                            </nav>
                        </div>
                    </div>

                    <!-- Aba Frentes -->
                    <div id="tab-frentes" class="tab-content">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Formulário de Frentes -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Cadastrar Frente</h3>
                                
                                <form id="form-frente" class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="frente-nome">
                                            Nome da Frente <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="frente-nome" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: Frente 01" required>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="frente-fazenda">
                                            Fazenda <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="frente-fazenda" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: Fazenda São João" required>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="frente-tipo">
                                            Tipo da Frente <span class="text-red-500">*</span>
                                        </label>
                                        <select id="frente-tipo" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="propria">Própria</option>
                                            <option value="terceira">Terceira</option>
                                            <option value="desconhecido">Desconhecido</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="frente-responsavel">
                                            Responsável
                                        </label>
                                        <input type="text" id="frente-responsavel" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: João Silva">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="frente-status">
                                            Status <span class="text-red-500">*</span>
                                        </label>
                                        <select id="frente-status" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="ativa">Ativa</option>
                                            <option value="inativa">Inativa</option>
                                            <option value="manutencao">Manutenção</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="frente-observacoes">
                                            Observações
                                        </label>
                                        <textarea id="frente-observacoes" rows="3" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Observações sobre a frente"></textarea>
                                    </div>
                                    
                                    <div class="flex items-center space-x-3 pt-4">
                                        <button type="submit" class="flex-1 inline-flex items-center justify-center px-4 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                            <i class="fas fa-save mr-2"></i> <span id="btn-submit-frente-text">Salvar Frente</span>
                                        </button>
                                        <button type="reset" class="px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Lista de Frentes -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Frentes Cadastradas</h3>
                                    <button id="btn-refresh-frentes" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Nome</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Fazenda</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Tipo</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Status</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabela-frentes" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Preenchido dinamicamente -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba Metas Próprias -->
                    <div id="tab-metas-proprias" class="tab-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Formulário de Metas Próprias -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                                    <i class="fas fa-home text-blue-600 dark:text-blue-400 mr-2"></i>
                                    Definir Meta Própria
                                </h3>
                                
                                <form id="form-meta-propria" class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-propria-frente">
                                            Frente Própria <span class="text-red-500">*</span>
                                        </label>
                                        <select id="meta-propria-frente" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="">Selecione uma frente própria</option>
                                        </select>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-propria-periodo">
                                            Período <span class="text-red-500">*</span>
                                        </label>
                                        <select id="meta-propria-periodo" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="diario">Diário</option>
                                            <option value="semanal">Semanal</option>
                                            <option value="mensal">Mensal</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-propria-valor">
                                            Meta (Toneladas) <span class="text-red-500">*</span>
                                        </label>
                                        <input type="number" step="0.01" id="meta-propria-valor" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: 150.00" required>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-propria-data-inicio">
                                                Data de Início <span class="text-red-500">*</span>
                                            </label>
                                            <input type="date" id="meta-propria-data-inicio" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-propria-data-fim">
                                                Data de Fim <span class="text-red-500">*</span>
                                            </label>
                                            <input type="date" id="meta-propria-data-fim" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-propria-observacoes">
                                            Observações
                                        </label>
                                        <textarea id="meta-propria-observacoes" rows="3" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Observações sobre a meta própria"></textarea>
                                    </div>
                                    
                                    <div class="flex items-center space-x-3 pt-4">
                                        <button type="submit" class="flex-1 inline-flex items-center justify-center px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                            <i class="fas fa-save mr-2"></i> <span id="btn-submit-meta-propria-text">Salvar Meta Própria</span>
                                        </button>
                                        <button type="reset" class="px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Lista de Metas Próprias -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                                        <i class="fas fa-home text-blue-600 dark:text-blue-400 mr-2"></i>
                                        Metas Próprias
                                    </h3>
                                    <button id="btn-refresh-metas-proprias" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Frente</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Período</th>
                                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Meta (T)</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Status</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabela-metas-proprias" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Preenchido dinamicamente -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba Metas Terceiras -->
                    <div id="tab-metas-terceiras" class="tab-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Formulário de Metas Terceiras -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                                    <i class="fas fa-handshake text-orange-600 dark:text-orange-400 mr-2"></i>
                                    Definir Meta Terceira
                                </h3>
                                
                                <form id="form-meta-terceira" class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-terceira-frente">
                                            Frente Terceira <span class="text-red-500">*</span>
                                        </label>
                                        <select id="meta-terceira-frente" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="">Selecione uma frente terceira</option>
                                        </select>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-terceira-periodo">
                                            Período <span class="text-red-500">*</span>
                                        </label>
                                        <select id="meta-terceira-periodo" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="diario">Diário</option>
                                            <option value="semanal">Semanal</option>
                                            <option value="mensal">Mensal</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-terceira-valor">
                                            Meta (Toneladas) <span class="text-red-500">*</span>
                                        </label>
                                        <input type="number" step="0.01" id="meta-terceira-valor" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: 120.00" required>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-terceira-data-inicio">
                                                Data de Início <span class="text-red-500">*</span>
                                            </label>
                                            <input type="date" id="meta-terceira-data-inicio" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-terceira-data-fim">
                                                Data de Fim <span class="text-red-500">*</span>
                                            </label>
                                            <input type="date" id="meta-terceira-data-fim" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="meta-terceira-observacoes">
                                            Observações
                                        </label>
                                        <textarea id="meta-terceira-observacoes" rows="3" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Observações sobre a meta terceira"></textarea>
                                    </div>
                                    
                                    <div class="flex items-center space-x-3 pt-4">
                                        <button type="submit" class="flex-1 inline-flex items-center justify-center px-4 py-3 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                            <i class="fas fa-save mr-2"></i> <span id="btn-submit-meta-terceira-text">Salvar Meta Terceira</span>
                                        </button>
                                        <button type="reset" class="px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Lista de Metas Terceiras -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                                        <i class="fas fa-handshake text-orange-600 dark:text-orange-400 mr-2"></i>
                                        Metas Terceiras
                                    </h3>
                                    <button id="btn-refresh-metas-terceiras" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Frente</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Período</th>
                                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Meta (T)</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Status</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabela-metas-terceiras" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Preenchido dinamicamente -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba Lançamento Diário -->
                    <div id="tab-diario" class="tab-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Formulário de Lançamento Diário -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Lançamento Diário</h3>
                                
                                <form id="form-lancamento" class="space-y-4">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="lancamento-frente">
                                            Frente <span class="text-red-500">*</span>
                                        </label>
                                        <select id="lancamento-frente" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="">Selecione uma frente</option>
                                        </select>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="lancamento-data">
                                            Data <span class="text-red-500">*</span>
                                        </label>
                                        <input type="date" id="lancamento-data" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="lancamento-colhido">
                                            Quantidade Colhida (T) <span class="text-red-500">*</span>
                                        </label>
                                        <input type="number" step="0.01" id="lancamento-colhido" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: 120.50" required>
                                        <div class="invalid-feedback text-red-500 text-sm mt-1 hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="lancamento-turno">
                                            Turno <span class="text-red-500">*</span>
                                        </label>
                                        <select id="lancamento-turno" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300" required>
                                            <option value="manha">Manhã</option>
                                            <option value="tarde">Tarde</option>
                                            <option value="noite">Noite</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="lancamento-operador">
                                            Operador
                                        </label>
                                        <input type="text" id="lancamento-operador" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Ex: José Santos">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="lancamento-observacoes">
                                            Observações
                                        </label>
                                        <textarea id="lancamento-observacoes" rows="3" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Observações do dia"></textarea>
                                    </div>
                                    
                                    <div class="flex items-center space-x-3 pt-4">
                                        <button type="submit" class="flex-1 inline-flex items-center justify-center px-4 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                            <i class="fas fa-save mr-2"></i> <span id="btn-submit-lancamento-text">Salvar Lançamento</span>
                                        </button>
                                        <button type="reset" class="px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Lançamentos Recentes -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Lançamentos Recentes</h3>
                                    <button id="btn-refresh-lancamentos" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Data</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Frente</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Tipo</th>
                                                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Colhido (T)</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Turno</th>
                                                <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabela-lancamentos" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Preenchido dinamicamente -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba Acompanhamento -->
                    <div id="tab-acompanhamento" class="tab-content hidden">
                        <!-- Filtros de Acompanhamento -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 mb-6">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Filtros de Acompanhamento</h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="filtro-acompanhamento-frente">
                                        Frente
                                    </label>
                                    <select id="filtro-acompanhamento-frente" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300">
                                        <option value="">Todas as frentes</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="filtro-acompanhamento-tipo">
                                        Tipo
                                    </label>
                                    <select id="filtro-acompanhamento-tipo" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300">
                                        <option value="">Todos os tipos</option>
                                        <option value="propria">Próprias</option>
                                        <option value="terceira">Terceiras</option>
                                        <option value="desconhecido">Desconhecidas</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="filtro-acompanhamento-data-inicio">
                                        Data Início
                                    </label>
                                    <input type="date" id="filtro-acompanhamento-data-inicio" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300">
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium" for="filtro-acompanhamento-data-fim">
                                        Data Fim
                                    </label>
                                    <input type="date" id="filtro-acompanhamento-data-fim" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all-300">
                                </div>
                            </div>
                            
                            <div class="flex space-x-3">
                                <button id="btn-aplicar-filtro-acompanhamento" class="inline-flex items-center px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                    <i class="fas fa-filter mr-2"></i> Aplicar Filtros
                                </button>
                                <button id="btn-exportar-acompanhamento" class="inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                    <i class="fas fa-file-export mr-2"></i> Exportar Relatório
                                </button>
                            </div>
                        </div>

                        <!-- Resumo do Acompanhamento -->
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-6">
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 text-center hover-scale transition-all-300">
                                <div class="text-3xl font-bold text-blue-600 dark:text-blue-400 mb-2" id="resumo-metas-proprias-ativas">0</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">Metas Próprias</div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 text-center hover-scale transition-all-300">
                                <div class="text-3xl font-bold text-orange-600 dark:text-orange-400 mb-2" id="resumo-metas-terceiras-ativas">0</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">Metas Terceiras</div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 text-center hover-scale transition-all-300">
                                <div class="text-3xl font-bold text-green-600 dark:text-green-400 mb-2" id="resumo-total-colhido">0 T</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">Total Colhido</div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 text-center hover-scale transition-all-300">
                                <div class="text-3xl font-bold text-purple-600 dark:text-purple-400 mb-2" id="resumo-total-meta">0 T</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">Meta Total</div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 text-center hover-scale transition-all-300">
                                <div class="text-3xl font-bold text-indigo-600 dark:text-indigo-400 mb-2" id="resumo-percentual-meta">0%</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">% da Meta</div>
                            </div>
                        </div>

                        <!-- Tabela de Acompanhamento -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Acompanhamento por Frente</h3>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Frente</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Tipo</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Meta (T)</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Colhido (T)</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Restante (T)</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">% Meta</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Status</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Progresso</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabela-acompanhamento" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Preenchido dinamicamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Conteúdo de Configurações -->
                <div id="content-configuracoes" class="content hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">Configurações</h2>
                        <p class="text-gray-600 dark:text-gray-400">Configurações do sistema e gestão de dados</p>
                    </div>
                    
                    <!-- Backup e Restauração -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Backup e Restauração</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                                <h4 class="text-md font-medium text-blue-800 dark:text-blue-300 mb-2">Exportar Dados</h4>
                                <p class="text-sm text-blue-600 dark:text-blue-400 mb-4">Exporte todos os dados para um arquivo JSON de backup</p>
                                <button id="btn-exportar-json" class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                    <i class="fas fa-download mr-2"></i> Exportar Backup
                                </button>
                            </div>
                            
                            <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                                <h4 class="text-md font-medium text-green-800 dark:text-green-300 mb-2">Importar Dados</h4>
                                <p class="text-sm text-green-600 dark:text-green-400 mb-4">Importe dados de um arquivo JSON previamente exportado</p>
                                
                                <button id="btn-importar-json" class="inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                    <i class="fas fa-upload mr-2"></i> Importar Backup
                                </button>
                                <input type="file" id="import-json-file" accept=".json" class="hidden">
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                            <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg">
                                <h4 class="text-md font-medium text-red-800 dark:text-red-300 mb-2">Limpar Todos os Dados</h4>
                                <p class="text-sm text-red-600 dark:text-red-400 mb-4">
                                    <span class="font-semibold">Atenção:</span> Esta ação irá remover permanentemente todos os dados do sistema.
                                </p>
                                <button id="btn-limpar-dados" class="inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                    <i class="fas fa-trash-alt mr-2"></i> Limpar Todos os Dados
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Relatórios -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Relatórios do Sistema</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button id="btn-relatorio-liberacoes" class="inline-flex items-center justify-center px-6 py-4 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                <i class="fas fa-chart-line mr-2"></i> Relatório de Liberações
                            </button>
                            <button id="btn-relatorio-metas" class="inline-flex items-center justify-center px-6 py-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                <i class="fas fa-bullseye mr-2"></i> Relatório de Metas
                            </button>
                            <button id="btn-relatorio-colheita" class="inline-flex items-center justify-center px-6 py-4 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg text-sm transition-all-300 hover-scale">
                                <i class="fas fa-seedling mr-2"></i> Relatório de Colheita
                            </button>
                        </div>
                    </div>
                    
                    <!-- Sobre o Sistema -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg card-shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Sobre o Sistema</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <div class="text-sm text-gray-600 dark:text-gray-400 space-y-2">
                                    <p><strong class="text-gray-800 dark:text-white">Nome:</strong> GGOMES-LOG</p>
                                    <p><strong class="text-gray-800 dark:text-white">Versão:</strong> 2.1.0</p>
                                    <p><strong class="text-gray-800 dark:text-white">Descrição:</strong> Sistema avançado de gestão agrícola para acompanhamento de colheita, metas próprias/terceiras e logística.</p>
                                    <p><strong class="text-gray-800 dark:text-white">Desenvolvido por:</strong> GGOMES Technologies</p>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="text-md font-medium text-gray-800 dark:text-white mb-3">Novidades da Versão 2.1</h4>
                                <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                    <li>• Separação de metas próprias e terceiras</li>
                                    <li>• Classificação de frentes por tipo</li>
                                    <li>• Adição do tipo "Desconhecido" para frentes</li>
                                    <li>• Dashboard com indicadores separados</li>
                                    <li>• Relatórios específicos por tipo de frente</li>
                                    <li>• Compatibilidade com backups v2.0</li>
                                    <li>• Interface otimizada para novos tipos</li>
                                    <li>• Filtros avançados por tipo de meta</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                            <p class="text-xs text-gray-500 dark:text-gray-400 text-center">
                                © 2025 GGOMES Technologies. Todos os direitos reservados.
                            </p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modal de confirmação para limpar dados -->
    <div id="modal-limpar-dados" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 animate-fade-in">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Confirmação de Limpeza</h3>
            
            <p class="text-gray-700 dark:text-gray-300 mb-4">
                <span class="text-red-500 font-semibold">Atenção:</span> Esta ação irá remover <span class="font-semibold">PERMANENTEMENTE</span> todos os dados do sistema.
            </p>
            
            <p class="text-gray-700 dark:text-gray-300 mb-6">
                Para confirmar, digite "CONFIRMAR" no campo abaixo:
            </p>
            
            <div class="mb-6">
                <input type="text" id="confirmacao-texto" class="bg-gray-50 border border-gray-300 text-gray-900 text-base rounded-lg focus:ring-red-500 focus:border-red-500 block w-full p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all-300" placeholder="Digite CONFIRMAR">
            </div>
            
            <div class="flex justify-end space-x-4">
                <button id="btn-cancelar-limpar" class="inline-flex items-center px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white font-medium rounded-lg text-sm transition-all-300">
                    <i class="fas fa-times mr-2"></i> Cancelar
                </button>
                <button id="btn-confirmar-limpar" class="inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg text-sm opacity-50 cursor-not-allowed transition-all-300" disabled>
                    <i class="fas fa-trash-alt mr-2"></i> Sim, Limpar Tudo
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal de notificações -->
    <div id="modal-notifications" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 animate-fade-in">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">Notificações</h3>
                <button id="btn-close-notifications" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="notifications-list" class="space-y-3 max-h-64 overflow-y-auto scrollbar-thin">
                <!-- Preenchido dinamicamente -->
            </div>
            
            <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                <button id="btn-clear-notifications" class="w-full text-center text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 transition-colors">
                    Limpar todas as notificações
                </button>
            </div>
        </div>
    </div>

<script>
// ===== SISTEMA DE GESTÃO AGRÍCOLA GGOMES-LOG v2.1 =====

// Configuração global da aplicação
const AppConfig = {
    version: '2.1.0',
    name: 'GGOMES-LOG',
    pagination: { itemsPerPage: 10 },
    charts: {},
    notifications: []
};

// Sistema básico de toasts melhorado
const Toast = {
    show: function(message, type = 'success', duration = 4000) {
        const toastContainer = document.getElementById('toast-container');
        if (!toastContainer) return;
        
        const toast = document.createElement('div');
        const colorClasses = {
            'success': 'bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-300 border-green-200 dark:border-green-700',
            'error': 'bg-red-100 dark:bg-red-800 text-red-700 dark:text-red-300 border-red-200 dark:border-red-700',
            'warning': 'bg-yellow-100 dark:bg-yellow-800 text-yellow-700 dark:text-yellow-300 border-yellow-200 dark:border-yellow-700',
            'info': 'bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300 border-blue-200 dark:border-blue-700'
        };
        
        const iconClasses = {
            'success': 'fa-check-circle',
            'error': 'fa-exclamation-circle',
            'warning': 'fa-exclamation-triangle',
            'info': 'fa-info-circle'
        };
        
        toast.className = `animate-fade-in p-4 mb-3 rounded-lg border card-shadow flex items-center justify-between max-w-sm ${colorClasses[type] || colorClasses.info}`;
        
        toast.innerHTML = `
            <div class="flex items-center">
                <i class="fas ${iconClasses[type] || iconClasses.info} mr-3 text-lg"></i>
                <span class="text-sm font-medium">${message}</span>
            </div>
            <button class="ml-4 text-current hover:opacity-70 focus:outline-none transition-opacity">
                <i class="fas fa-times"></i>
            </button>
        `;
        
        const closeBtn = toast.querySelector('button');
        closeBtn.addEventListener('click', () => this.remove(toast));
        
        toastContainer.appendChild(toast);
        
        if (duration > 0) {
            setTimeout(() => this.remove(toast), duration);
        }
    },
    
    remove: function(toast) {
        if (toast && toast.parentNode) {
            toast.classList.remove('animate-fade-in');
            toast.classList.add('animate-fade-out');
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }
    }
};

// Sistema de Banco de Dados Local melhorado
const DB = {
    // Inicialização do banco de dados
    init: function() {
        this.initializeDefaultData();
        this.updateLastAccess();
    },
    
    // Inicializar dados padrão se não existirem
    initializeDefaultData: function() {
        if (!localStorage.getItem('ggomes_liberacoes')) {
            const hoje = new Date().toISOString().split('T')[0];
            const ontem = new Date();
            ontem.setDate(ontem.getDate() - 1);
            const dataOntem = ontem.toISOString().split('T')[0];
            
            const liberacoesIniciais = [
                {
                    id: 'LIB-001',
                    frente: 'Frente 01',
                    fazenda: 'Fazenda São João',
                    numero: 'LIB-2025-001',
                    status: 'fechado',
                    previsto: 1000,
                    realizado: 950,
                    restante: 50,
                    data: dataOntem,
                    observacoes: 'Liberação concluída com sucesso',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 'LIB-002',
                    frente: 'Frente 02',
                    fazenda: 'Fazenda Boa Vista',
                    numero: 'LIB-2025-002',
                    status: 'em-andamento',
                    previsto: 1500,
                    realizado: 1200,
                    restante: 300,
                    data: hoje,
                    observacoes: 'Em progresso, boa produtividade',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 'LIB-003',
                    frente: 'Frente 01',
                    fazenda: 'Fazenda São João',
                    numero: 'LIB-2025-003',
                    status: 'aberto',
                    previsto: 800,
                    realizado: 200,
                    restante: 600,
                    data: hoje,
                    observacoes: 'Iniciada hoje pela manhã',
                    dataRegistro: new Date().toISOString()
                }
            ];
            localStorage.setItem('ggomes_liberacoes', JSON.stringify(liberacoesIniciais));
            
            const frentesIniciais = [
                {
                    id: 'FRENTE-001',
                    nome: 'Frente 01',
                    fazenda: 'Fazenda São João',
                    tipo: 'propria',
                    responsavel: 'João Silva',
                    status: 'ativa',
                    observacoes: 'Frente principal com alta produtividade',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 'FRENTE-002',
                    nome: 'Frente 02',
                    fazenda: 'Fazenda Boa Vista',
                    tipo: 'propria',
                    responsavel: 'Maria Santos',
                    status: 'ativa',
                    observacoes: 'Frente secundária em expansão',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 'FRENTE-003',
                    nome: 'Frente Terceira A',
                    fazenda: 'Fazenda Esperança',
                    tipo: 'terceira',
                    responsavel: 'Pedro Lima',
                    status: 'ativa',
                    observacoes: 'Nova frente terceirizada',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 'FRENTE-004',
                    nome: 'Frente Desconhecida X',
                    fazenda: 'Fazenda Nova',
                    tipo: 'desconhecido',
                    responsavel: 'A definir',
                    status: 'inativa',
                    observacoes: 'Frente em análise para classificação',
                    dataRegistro: new Date().toISOString()
                }
            ];
            localStorage.setItem('ggomes_frentes', JSON.stringify(frentesIniciais));
            
            const metasIniciais = [
                {
                    id: 'META-001',
                    frenteId: 'FRENTE-001',
                    tipo: 'propria',
                    periodo: 'diario',
                    valor: 180,
                    dataInicio: hoje,
                    dataFim: hoje,
                    observacoes: 'Meta diária padrão própria',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 'META-002',
                    frenteId: 'FRENTE-003',
                    tipo: 'terceira',
                    periodo: 'diario',
                    valor: 150,
                    dataInicio: hoje,
                    dataFim: hoje,
                    observacoes: 'Meta inicial terceirizada',
                    dataRegistro: new Date().toISOString()
                }
            ];
            localStorage.setItem('ggomes_metas', JSON.stringify(metasIniciais));
            
            const lancamentosIniciais = [
                {
                    id: 'LANC-001',
                    frenteId: 'FRENTE-001',
                    data: dataOntem,
                    colhido: 175.5,
                    turno: 'manha',
                    operador: 'José Santos',
                    observacoes: 'Excelente rendimento matinal',
                    dataRegistro: new Date().toISOString()
                },
                {
                    id: 'LANC-002',
                    frenteId: 'FRENTE-003',
                    data: dataOntem,
                    colhido: 140.2,
                    turno: 'tarde',
                    operador: 'Pedro Lima',
                    observacoes: 'Boa produtividade terceirizada',
                    dataRegistro: new Date().toISOString()
                }
            ];
            localStorage.setItem('ggomes_lancamentos', JSON.stringify(lancamentosIniciais));
        }
        
        if (!localStorage.getItem('ggomes_config')) {
            localStorage.setItem('ggomes_config', JSON.stringify({
                version: '2.1.0',
                temaEscuro: true,
                ultimoAcesso: new Date().toISOString(),
                notifications: [],
                preferences: { itemsPerPage: 10, autoRefresh: true }
            }));
        }
        
        const tabelas = ['liberacoes', 'frentes', 'metas', 'lancamentos'];
        tabelas.forEach(tabela => {
            if (!localStorage.getItem(`ggomes_${tabela}`)) {
                localStorage.setItem(`ggomes_${tabela}`, JSON.stringify([]));
            }
        });
    },
    
    updateLastAccess: function() {
        const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
        config.ultimoAcesso = new Date().toISOString();
        localStorage.setItem('ggomes_config', JSON.stringify(config));
    },
    
    clearAll: function() {
        try {
            const tabelas = ['liberacoes', 'frentes', 'metas', 'lancamentos'];
            tabelas.forEach(tabela => {
                localStorage.removeItem(`ggomes_${tabela}`);
                localStorage.setItem(`ggomes_${tabela}`, JSON.stringify([]));
            });
            
            const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
            localStorage.setItem('ggomes_config', JSON.stringify({
                version: '2.1.0',
                temaEscuro: config.temaEscuro || true,
                ultimoAcesso: new Date().toISOString(),
                notifications: [],
                preferences: config.preferences || { itemsPerPage: 10, autoRefresh: true }
            }));
            
            return true;
        } catch (error) {
            console.error('Erro ao limpar dados:', error);
            return false;
        }
    },
    
    exportData: function() {
        try {
            const data = {
                liberacoes: JSON.parse(localStorage.getItem('ggomes_liberacoes') || '[]'),
                frentes: JSON.parse(localStorage.getItem('ggomes_frentes') || '[]'),
                metas: JSON.parse(localStorage.getItem('ggomes_metas') || '[]'),
                lancamentos: JSON.parse(localStorage.getItem('ggomes_lancamentos') || '[]'),
                config: JSON.parse(localStorage.getItem('ggomes_config') || '{}'),
                metaData: {
                    exportDate: new Date().toISOString(),
                    version: '2.1.0',
                    description: 'Backup completo do sistema GGOMES-LOG v2.1'
                }
            };
            
            return JSON.stringify(data, null, 2);
        } catch (error) {
            console.error('Erro ao exportar dados:', error);
            throw new Error('Não foi possível exportar os dados.');
        }
    },
    
    importData: function(jsonData) {
        try {
            const data = JSON.parse(jsonData);
            
            if (!data.metaData || !data.metaData.version) {
                throw new Error('Arquivo de backup inválido: metadados ausentes.');
            }
            
            if (!data.liberacoes && !data.frentes && !data.metas && !data.lancamentos) {
                throw new Error('Arquivo de backup vazio ou corrompido.');
            }
            
            const tabelas = ['liberacoes', 'frentes', 'metas', 'lancamentos'];
            tabelas.forEach(tabela => {
                if (data[tabela] && Array.isArray(data[tabela])) {
                    localStorage.setItem(`ggomes_${tabela}`, JSON.stringify(data[tabela]));
                }
            });
            
            if (data.config) {
                const currentConfig = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
                const newConfig = {
                    ...data.config,
                    version: '2.1.0',
                    temaEscuro: currentConfig.temaEscuro,
                    ultimoAcesso: new Date().toISOString(),
                    preferences: currentConfig.preferences || data.config.preferences || { itemsPerPage: 10, autoRefresh: true }
                };
                localStorage.setItem('ggomes_config', JSON.stringify(newConfig));
            }
            
            return true;
        } catch (error) {
            console.error('Erro ao importar dados:', error);
            throw error;
        }
    },
    
    // Módulo Liberações
    liberacoes: {
        getAll: function() {
            try {
                const liberacoes = localStorage.getItem('ggomes_liberacoes');
                return liberacoes ? JSON.parse(liberacoes) : [];
            } catch (error) {
                console.error("Erro ao obter liberações:", error);
                return [];
            }
        },
        
        get: function(id) {
            return this.getAll().find(l => l.id === id);
        },
        
        add: function(liberacao) {
            const requiredFields = ['frente', 'fazenda', 'status', 'previsto', 'realizado', 'data'];
            const missingFields = requiredFields.filter(field => !liberacao[field] && liberacao[field] !== 0);
            
            if (missingFields.length > 0) {
                throw new Error(`Campos obrigatórios ausentes: ${missingFields.join(', ')}`);
            }
            
            const liberacoes = this.getAll();
            
            if (!liberacao.id) {
                liberacao.id = Utils.gerarId('LIB');
            }
            
            if (liberacoes.some(l => l.id === liberacao.id)) {
                throw new Error(`Liberação com ID "${liberacao.id}" já existe.`);
            }
            
            liberacao.restante = Number(liberacao.previsto) - Number(liberacao.realizado);
            liberacao.dataRegistro = liberacao.dataRegistro || new Date().toISOString();
            
            if (Number(liberacao.previsto) < 0 || Number(liberacao.realizado) < 0) {
                throw new Error('Valores previstos e realizados devem ser positivos.');
            }
            
            liberacoes.push(liberacao);
            localStorage.setItem('ggomes_liberacoes', JSON.stringify(liberacoes));
            
            return liberacao;
        },
        
        update: function(liberacao) {
            if (!liberacao.id) {
                throw new Error('ID da liberação é obrigatório.');
            }
            
            const liberacoes = this.getAll();
            const index = liberacoes.findIndex(l => l.id === liberacao.id);
            
            if (index === -1) {
                throw new Error(`Liberação com ID "${liberacao.id}" não encontrada.`);
            }
            
            if (liberacao.previsto !== undefined || liberacao.realizado !== undefined) {
                const previsto = liberacao.previsto !== undefined ? Number(liberacao.previsto) : Number(liberacoes[index].previsto);
                const realizado = liberacao.realizado !== undefined ? Number(liberacao.realizado) : Number(liberacoes[index].realizado);
                liberacao.restante = previsto - realizado;
            }
            
            liberacoes[index] = { ...liberacoes[index], ...liberacao };
            localStorage.setItem('ggomes_liberacoes', JSON.stringify(liberacoes));
            
            return liberacoes[index];
        },
        
        remove: function(id) {
            const liberacoes = this.getAll();
            const index = liberacoes.findIndex(l => l.id === id);
            
            if (index === -1) {
                throw new Error(`Liberação com ID "${id}" não encontrada.`);
            }
            
            liberacoes.splice(index, 1);
            localStorage.setItem('ggomes_liberacoes', JSON.stringify(liberacoes));
            
            return true;
        },
        
        getTotals: function(filtroFrente = '', filtroFazenda = '', filtroStatus = '') {
            let liberacoes = this.getAll();
            
            if (filtroFrente) liberacoes = liberacoes.filter(l => l.frente === filtroFrente);
            if (filtroFazenda) liberacoes = liberacoes.filter(l => l.fazenda === filtroFazenda);
            if (filtroStatus) liberacoes = liberacoes.filter(l => l.status === filtroStatus);
            
            const totals = {
                previsto: 0, realizado: 0, restante: 0,
                statusAberto: 0, statusFechado: 0, statusEmAndamento: 0, statusCancelado: 0,
                totalGeral: 0, count: liberacoes.length
            };
            
            liberacoes.forEach(l => {
                const previsto = Number(l.previsto) || 0;
                const realizado = Number(l.realizado) || 0;
                const restante = Number(l.restante) || 0;
                
                totals.previsto += previsto;
                totals.realizado += realizado;
                totals.restante += restante;
                totals.totalGeral += previsto;
                
                switch(l.status) {
                    case 'aberto': totals.statusAberto++; break;
                    case 'fechado': totals.statusFechado++; break;
                    case 'em-andamento': totals.statusEmAndamento++; break;
                    case 'cancelado': totals.statusCancelado++; break;
                }
            });
            
            return totals;
        },
        
        getUniqueValues: function() {
            const liberacoes = this.getAll();
            const frentes = new Set();
            const fazendas = new Set();
            const status = new Set();
            
            liberacoes.forEach(l => {
                frentes.add(l.frente);
                fazendas.add(l.fazenda);
                if (l.status) status.add(l.status);
            });
            
            return {
                frentes: Array.from(frentes).sort(),
                fazendas: Array.from(fazendas).sort(),
                status: Array.from(status).sort()
            };
        },
        
        search: function(term, filters = {}) {
            let liberacoes = this.getAll();
            
            Object.keys(filters).forEach(key => {
                if (filters[key]) {
                    liberacoes = liberacoes.filter(l => l[key] === filters[key]);
                }
            });
            
            if (term) {
                const lowerTerm = term.toLowerCase();
                liberacoes = liberacoes.filter(l => 
                    (l.frente && l.frente.toLowerCase().includes(lowerTerm)) ||
                    (l.fazenda && l.fazenda.toLowerCase().includes(lowerTerm)) ||
                    (l.numero && l.numero.toLowerCase().includes(lowerTerm)) ||
                    (l.observacoes && l.observacoes.toLowerCase().includes(lowerTerm))
                );
            }
            
            return liberacoes;
        },
        
        paginate: function(liberacoes, page = 1, itemsPerPage = 10) {
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            
            return {
                data: liberacoes.slice(startIndex, endIndex),
                totalPages: Math.ceil(liberacoes.length / itemsPerPage),
                currentPage: page,
                totalItems: liberacoes.length,
                itemsPerPage: itemsPerPage
            };
        }
    },

    // Módulo Frentes
    frentes: {
        getAll: function() {
            try {
                const frentes = localStorage.getItem('ggomes_frentes');
                return frentes ? JSON.parse(frentes) : [];
            } catch (error) {
                console.error("Erro ao obter frentes:", error);
                return [];
            }
        },
        
        get: function(id) {
            return this.getAll().find(f => f.id === id);
        },
        
        add: function(frente) {
            const requiredFields = ['nome', 'fazenda', 'tipo', 'status'];
            const missingFields = requiredFields.filter(field => !frente[field]);
            
            if (missingFields.length > 0) {
                throw new Error(`Campos obrigatórios ausentes: ${missingFields.join(', ')}`);
            }
            
            const frentes = this.getAll();
            
            if (!frente.id) {
                frente.id = Utils.gerarId('FRENTE');
            }
            
            if (frentes.some(f => f.nome === frente.nome && f.fazenda === frente.fazenda)) {
                throw new Error(`Já existe uma frente com o nome "${frente.nome}" na fazenda "${frente.fazenda}".`);
            }
            
            frente.dataRegistro = frente.dataRegistro || new Date().toISOString();
            frentes.push(frente);
            localStorage.setItem('ggomes_frentes', JSON.stringify(frentes));
            
            return frente;
        },
        
        update: function(frente) {
            if (!frente.id) {
                throw new Error('ID da frente é obrigatório.');
            }
            
            const frentes = this.getAll();
            const index = frentes.findIndex(f => f.id === frente.id);
            
            if (index === -1) {
                throw new Error(`Frente com ID "${frente.id}" não encontrada.`);
            }
            
            frentes[index] = { ...frentes[index], ...frente };
            localStorage.setItem('ggomes_frentes', JSON.stringify(frentes));
            
            return frentes[index];
        },
        
        remove: function(id) {
            const frentes = this.getAll();
            const index = frentes.findIndex(f => f.id === id);
            
            if (index === -1) {
                throw new Error(`Frente com ID "${id}" não encontrada.`);
            }
            
            const metas = DB.metas.getAll().filter(m => m.frenteId === id);
            const lancamentos = DB.lancamentos.getAll().filter(l => l.frenteId === id);
            
            if (metas.length > 0 || lancamentos.length > 0) {
                throw new Error('Não é possível excluir a frente pois há metas ou lançamentos vinculados a ela.');
            }
            
            frentes.splice(index, 1);
            localStorage.setItem('ggomes_frentes', JSON.stringify(frentes));
            
            return true;
        },
        
        getAtivas: function() {
            return this.getAll().filter(f => f.status === 'ativa');
        },
        
        getByTipo: function(tipo) {
            return this.getAll().filter(f => f.tipo === tipo);
        },
        
        getAtivasByTipo: function(tipo) {
            return this.getAll().filter(f => f.status === 'ativa' && f.tipo === tipo);
        }
    },

    // Módulo Metas
    metas: {
        getAll: function() {
            try {
                const metas = localStorage.getItem('ggomes_metas');
                return metas ? JSON.parse(metas) : [];
            } catch (error) {
                console.error("Erro ao obter metas:", error);
                return [];
            }
        },
        
        get: function(id) {
            return this.getAll().find(m => m.id === id);
        },
        
        add: function(meta) {
            const requiredFields = ['frenteId', 'tipo', 'periodo', 'valor', 'dataInicio', 'dataFim'];
            const missingFields = requiredFields.filter(field => !meta[field] && meta[field] !== 0);
            
            if (missingFields.length > 0) {
                throw new Error(`Campos obrigatórios ausentes: ${missingFields.join(', ')}`);
            }
            
            if (!meta.id) {
                meta.id = Utils.gerarId('META');
            }
            
            const metas = this.getAll();
            meta.dataRegistro = meta.dataRegistro || new Date().toISOString();
            metas.push(meta);
            localStorage.setItem('ggomes_metas', JSON.stringify(metas));
            
            return meta;
        },
        
        update: function(meta) {
            if (!meta.id) {
                throw new Error('ID da meta é obrigatório.');
            }
            
            const metas = this.getAll();
            const index = metas.findIndex(m => m.id === meta.id);
            
            if (index === -1) {
                throw new Error(`Meta com ID "${meta.id}" não encontrada.`);
            }
            
            metas[index] = { ...metas[index], ...meta };
            localStorage.setItem('ggomes_metas', JSON.stringify(metas));
            
            return metas[index];
        },
        
        remove: function(id) {
            const metas = this.getAll();
            const index = metas.findIndex(m => m.id === id);
            
            if (index === -1) {
                throw new Error(`Meta com ID "${id}" não encontrada.`);
            }
            
            metas.splice(index, 1);
            localStorage.setItem('ggomes_metas', JSON.stringify(metas));
            
            return true;
        },
        
        getAtivas: function(dataRef = null) {
            const data = dataRef || new Date().toISOString().split('T')[0];
            return this.getAll().filter(m => m.dataInicio <= data && m.dataFim >= data);
        },
        
        getByTipo: function(tipo) {
            return this.getAll().filter(m => m.tipo === tipo);
        },
        
        getAtivasByTipo: function(tipo, dataRef = null) {
            const data = dataRef || new Date().toISOString().split('T')[0];
            return this.getAll().filter(m => m.tipo === tipo && m.dataInicio <= data && m.dataFim >= data);
        }
    },

    // Módulo Lançamentos
    lancamentos: {
        getAll: function() {
            try {
                const lancamentos = localStorage.getItem('ggomes_lancamentos');
                return lancamentos ? JSON.parse(lancamentos) : [];
            } catch (error) {
                console.error("Erro ao obter lançamentos:", error);
                return [];
            }
        },
        
        get: function(id) {
            return this.getAll().find(l => l.id === id);
        },
        
        add: function(lancamento) {
            const requiredFields = ['frenteId', 'data', 'colhido', 'turno'];
            const missingFields = requiredFields.filter(field => !lancamento[field] && lancamento[field] !== 0);
            
            if (missingFields.length > 0) {
                throw new Error(`Campos obrigatórios ausentes: ${missingFields.join(', ')}`);
            }
            
            if (!lancamento.id) {
                lancamento.id = Utils.gerarId('LANC');
            }
            
            const lancamentos = this.getAll();
            lancamento.dataRegistro = lancamento.dataRegistro || new Date().toISOString();
            lancamentos.push(lancamento);
            localStorage.setItem('ggomes_lancamentos', JSON.stringify(lancamentos));
            
            return lancamento;
        },
        
        update: function(lancamento) {
            if (!lancamento.id) {
                throw new Error('ID do lançamento é obrigatório.');
            }
            
            const lancamentos = this.getAll();
            const index = lancamentos.findIndex(l => l.id === lancamento.id);
            
            if (index === -1) {
                throw new Error(`Lançamento com ID "${lancamento.id}" não encontrado.`);
            }
            
            lancamentos[index] = { ...lancamentos[index], ...lancamento };
            localStorage.setItem('ggomes_lancamentos', JSON.stringify(lancamentos));
            
            return lancamentos[index];
        },
        
        remove: function(id) {
            const lancamentos = this.getAll();
            const index = lancamentos.findIndex(l => l.id === id);
            
            if (index === -1) {
                throw new Error(`Lançamento com ID "${id}" não encontrado.`);
            }
            
            lancamentos.splice(index, 1);
            localStorage.setItem('ggomes_lancamentos', JSON.stringify(lancamentos));
            
            return true;
        },
        
        getByFrente: function(frenteId) {
            return this.getAll().filter(l => l.frenteId === frenteId);
        },
        
        getByPeriodo: function(dataInicio, dataFim) {
            return this.getAll().filter(l => l.data >= dataInicio && l.data <= dataFim);
        },
        
        getTotalColhidoPorFrente: function(frenteId, dataInicio, dataFim) {
            const lancamentos = this.getAll().filter(l => 
                l.frenteId === frenteId && 
                l.data >= dataInicio && 
                l.data <= dataFim
            );
            
            return lancamentos.reduce((total, l) => total + Number(l.colhido), 0);
        }
    }
};

// Sistema de notificações
const NotificationManager = {
    add: function(message, type = 'info', duration = 5000) {
        const notification = {
            id: Utils.gerarId('NOT'),
            message,
            type,
            timestamp: new Date().toISOString(),
            read: false
        };
        
        AppConfig.notifications.unshift(notification);
        
        if (AppConfig.notifications.length > 50) {
            AppConfig.notifications = AppConfig.notifications.slice(0, 50);
        }
        
        this.updateBadge();
        Toast.show(message, type, duration);
        
        const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
        config.notifications = AppConfig.notifications;
        localStorage.setItem('ggomes_config', JSON.stringify(config));
    },
    
    markAsRead: function(id) {
        const notification = AppConfig.notifications.find(n => n.id === id);
        if (notification) {
            notification.read = true;
            this.updateBadge();
        }
    },
    
    markAllAsRead: function() {
        AppConfig.notifications.forEach(n => n.read = true);
        this.updateBadge();
    },
    
    clear: function() {
        AppConfig.notifications = [];
        this.updateBadge();
        
        const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
        config.notifications = [];
        localStorage.setItem('ggomes_config', JSON.stringify(config));
    },
    
    updateBadge: function() {
        const unreadCount = AppConfig.notifications.filter(n => !n.read).length;
        const badge = document.getElementById('notification-badge');
        
        if (badge) {
            if (unreadCount > 0) {
                badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }
    },
    
    load: function() {
        const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
        AppConfig.notifications = config.notifications || [];
        this.updateBadge();
    }
};

// Utilidades
const Utils = {
    formatarToneladas: function(valor) {
        const numero = Number(valor) || 0;
        return numero.toLocaleString('pt-BR', { 
            minimumFractionDigits: 1, 
            maximumFractionDigits: 1 
        }) + ' T';
    },
    
    formatarData: function(dataStr) {
        if (!dataStr) return '--/--/----';
        
        try {
            const data = new Date(dataStr);
            return data.toLocaleDateString('pt-BR');
        } catch (error) {
            return '--/--/----';
        }
    },
    
    formatarDataHora: function(dataStr) {
        if (!dataStr) return '--/--/---- --:--';
        
        try {
            const data = new Date(dataStr);
            return data.toLocaleString('pt-BR');
        } catch (error) {
            return '--/--/---- --:--';
        }
    },
    
    gerarId: function(prefixo = 'ID') {
        return `${prefixo}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
    },
    
    getStatusConfig: function(status) {
        const configs = {
            'aberto': { 
                texto: 'Aberto', 
                cor: 'green', 
                bg: 'bg-green-100 dark:bg-green-900', 
                text: 'text-green-700 dark:text-green-300',
                icon: 'fa-play-circle'
            },
            'fechado': { 
                texto: 'Fechado', 
                cor: 'blue', 
                bg: 'bg-blue-100 dark:bg-blue-900', 
                text: 'text-blue-700 dark:text-blue-300',
                icon: 'fa-check-circle'
            },
            'em-andamento': { 
                texto: 'Em Andamento', 
                cor: 'yellow', 
                bg: 'bg-yellow-100 dark:bg-yellow-900', 
                text: 'text-yellow-700 dark:text-yellow-300',
                icon: 'fa-clock'
            },
            'cancelado': { 
                texto: 'Cancelado', 
                cor: 'red', 
                bg: 'bg-red-100 dark:bg-red-900', 
                text: 'text-red-700 dark:text-red-300',
                icon: 'fa-times-circle'
            },
            'ativa': { 
                texto: 'Ativa', 
                cor: 'green', 
                bg: 'bg-green-100 dark:bg-green-900', 
                text: 'text-green-700 dark:text-green-300',
                icon: 'fa-check-circle'
            },
            'inativa': { 
                texto: 'Inativa', 
                cor: 'red', 
                bg: 'bg-red-100 dark:bg-red-900', 
                text: 'text-red-700 dark:text-red-300',
                icon: 'fa-times-circle'
            },
            'manutencao': { 
                texto: 'Manutenção', 
                cor: 'yellow', 
                bg: 'bg-yellow-100 dark:bg-yellow-900', 
                text: 'text-yellow-700 dark:text-yellow-300',
                icon: 'fa-tools'
            }
        };
        
        return configs[status] || { 
            texto: status || 'Desconhecido', 
            cor: 'gray', 
            bg: 'bg-gray-100 dark:bg-gray-900', 
            text: 'text-gray-700 dark:text-gray-300',
            icon: 'fa-question-circle'
        };
    },
    
    getTipoConfig: function(tipo) {
        const configs = {
            'propria': {
                texto: 'Própria',
                cor: 'blue',
                bg: 'bg-blue-100 dark:bg-blue-900',
                text: 'text-blue-700 dark:text-blue-300',
                icon: 'fa-home'
            },
            'terceira': {
                texto: 'Terceira',
                cor: 'orange',
                bg: 'bg-orange-100 dark:bg-orange-900',
                text: 'text-orange-700 dark:text-orange-300',
                icon: 'fa-handshake'
            },
            'desconhecido': {
                texto: 'Desconhecido',
                cor: 'gray',
                bg: 'bg-gray-100 dark:bg-gray-900',
                text: 'text-gray-700 dark:text-gray-300',
                icon: 'fa-question-circle'
            }
        };
        
        return configs[tipo] || {
            texto: tipo || 'Desconhecido',
            cor: 'gray',
            bg: 'bg-gray-100 dark:bg-gray-900',
            text: 'text-gray-700 dark:text-gray-300',
            icon: 'fa-question-circle'
        };
    },
    
    showLoading: function(show = true) {
        const overlay = document.getElementById('loading-overlay');
        if (overlay) {
            if (show) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }
    },
    
    exportarPDF: function(titulo, dados, colunas, nomeArquivo) {
        if (!window.jspdf || !window.jspdf.jsPDF) {
            Toast.show('Biblioteca PDF não carregada', 'error');
            return;
        }
        
        if (!dados || !dados.length) {
            Toast.show('Não há dados para exportar', 'error');
            return;
        }
        
        try {
            this.showLoading(true);
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text(titulo, 14, 22);
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 14, 30);
            doc.text(`Sistema: GGOMES-LOG v${AppConfig.version}`, 14, 35);
            
            doc.autoTable({
                head: [colunas.map(col => col.header)],
                body: dados.map(item => colunas.map(col => {
                    if (typeof col.dataKey === 'function') {
                        return col.dataKey(item);
                    }
                    return item[col.dataKey] || '';
                })),
                startY: 42,
                theme: 'grid',
                styles: {
                    fontSize: 8,
                    cellPadding: 3,
                    lineColor: [200, 200, 200],
                    lineWidth: 0.1
                },
                headStyles: {
                    fillColor: [93, 92, 222],
                    textColor: [255, 255, 255],
                    fontStyle: 'bold',
                    fontSize: 9
                },
                alternateRowStyles: {
                    fillColor: [248, 249, 250]
                }
            });
            
            const pageCount = doc.internal.getNumberOfPages();
            for(let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.text(
                    `Página ${i} de ${pageCount} - GGOMES-LOG Sistema de Gestão Agrícola`, 
                    doc.internal.pageSize.width / 2, 
                    doc.internal.pageSize.height - 10, 
                    { align: 'center' }
                );
            }
            
            doc.save(nomeArquivo || 'relatorio.pdf');
            
            Toast.show('Relatório PDF gerado com sucesso', 'success');
        } catch (error) {
            console.error('Erro ao gerar PDF:', error);
            Toast.show('Erro ao gerar PDF: ' + error.message, 'error');
        } finally {
            this.showLoading(false);
        }
    },

    getNomeFrente: function(frenteId) {
        const frente = DB.frentes.get(frenteId);
        return frente ? frente.nome : 'Frente não encontrada';
    },

    getStatusMeta: function(progresso) {
        if (progresso >= 100) return { texto: 'Atingida', cor: 'green' };
        if (progresso >= 80) return { texto: 'Próximo', cor: 'yellow' };
        if (progresso >= 50) return { texto: 'Progresso', cor: 'blue' };
        return { texto: 'Abaixo', cor: 'red' };
    },
    
    debounce: function(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    },
    
    validateForm: function(formElement) {
        const inputs = formElement.querySelectorAll('input[required], select[required], textarea[required]');
        let isValid = true;
        
        inputs.forEach(input => {
            const feedback = input.parentNode.querySelector('.invalid-feedback');
            
            if (!input.value.trim()) {
                input.classList.add('form-error');
                if (feedback) {
                    feedback.textContent = 'Este campo é obrigatório';
                    feedback.classList.remove('hidden');
                }
                isValid = false;
            } else {
                input.classList.remove('form-error');
                input.classList.add('form-success');
                if (feedback) {
                    feedback.classList.add('hidden');
                }
            }
        });
        
        return isValid;
    },
    
    clearFormValidation: function(formElement) {
        const inputs = formElement.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.classList.remove('form-error', 'form-success');
            const feedback = input.parentNode.querySelector('.invalid-feedback');
            if (feedback) {
                feedback.classList.add('hidden');
            }
        });
    }
};

// Sistema de gráficos
const ChartManager = {
    init: function() {
        if (window.Chart) {
            Chart.defaults.color = document.documentElement.classList.contains('dark') ? '#e5e7eb' : '#374151';
            Chart.defaults.borderColor = document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb';
        }
    },
    
    createStatusChart: function() {
        const ctx = document.getElementById('chart-liberacoes-status');
        if (!ctx || !window.Chart) return;
        
        const liberacoes = DB.liberacoes.getAll();
        const statusCounts = {};
        
        liberacoes.forEach(lib => {
            statusCounts[lib.status] = (statusCounts[lib.status] || 0) + 1;
        });
        
        if (Object.keys(statusCounts).length === 0) {
            ctx.parentNode.innerHTML = '<div class="flex items-center justify-center h-64 text-gray-500">Sem dados para exibir</div>';
            return;
        }
        
        const data = {
            labels: Object.keys(statusCounts).map(status => Utils.getStatusConfig(status).texto),
            datasets: [{
                data: Object.values(statusCounts),
                backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        };
        
        AppConfig.charts.statusChart = new Chart(ctx, {
            type: 'doughnut',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { padding: 20, usePointStyle: true }
                    }
                }
            }
        });
    },
    
    createMetasTipoChart: function() {
        const ctx = document.getElementById('chart-metas-tipo');
        if (!ctx || !window.Chart) return;
        
        const metas = DB.metas.getAll();
        const metasProprias = metas.filter(m => m.tipo === 'propria').length;
        const metasTerceiras = metas.filter(m => m.tipo === 'terceira').length;
        
        if (metasProprias === 0 && metasTerceiras === 0) {
            ctx.parentNode.innerHTML = '<div class="flex items-center justify-center h-64 text-gray-500">Sem dados para exibir</div>';
            return;
        }
        
        const data = {
            labels: ['Metas Próprias', 'Metas Terceiras'],
            datasets: [{
                data: [metasProprias, metasTerceiras],
                backgroundColor: ['#3b82f6', '#f97316'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        };
        
        AppConfig.charts.metasTipoChart = new Chart(ctx, {
            type: 'pie',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { padding: 20, usePointStyle: true }
                    }
                }
            }
        });
    },
    
    updateCharts: function() {
        if (AppConfig.charts.statusChart) {
            AppConfig.charts.statusChart.destroy();
        }
        if (AppConfig.charts.metasTipoChart) {
            AppConfig.charts.metasTipoChart.destroy();
        }
        
        this.createStatusChart();
        this.createMetasTipoChart();
    }
};

// Sistema de paginação
const PaginationManager = {
    create: function(containerId, totalPages, currentPage, onPageChange) {
        const container = document.getElementById(containerId);
        if (!container || totalPages <= 1) {
            if (container) container.innerHTML = '';
            return;
        }
        
        let paginationHTML = `
            <div class="flex items-center justify-between">
                <div class="text-sm text-gray-700 dark:text-gray-300">
                    Página ${currentPage} de ${totalPages}
                </div>
                <div class="flex items-center space-x-1">
        `;
        
        paginationHTML += `
            <button class="pagination-btn px-3 py-1 text-sm rounded-md ${currentPage === 1 ? 'opacity-50 cursor-not-allowed' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}" 
                    data-page="${currentPage - 1}" ${currentPage === 1 ? 'disabled' : ''}>
                <i class="fas fa-chevron-left"></i>
            </button>
        `;
        
        const showPages = Math.min(5, totalPages);
        const startPage = Math.max(1, currentPage - Math.floor(showPages / 2));
        const endPage = Math.min(totalPages, startPage + showPages - 1);
        
        for (let i = startPage; i <= endPage; i++) {
            paginationHTML += `
                <button class="pagination-btn px-3 py-1 text-sm rounded-md ${i === currentPage ? 'bg-primary-600 text-white' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}" 
                        data-page="${i}">
                    ${i}
                </button>
            `;
        }
        
        paginationHTML += `
            <button class="pagination-btn px-3 py-1 text-sm rounded-md ${currentPage === totalPages ? 'opacity-50 cursor-not-allowed' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}" 
                    data-page="${currentPage + 1}" ${currentPage === totalPages ? 'disabled' : ''}>
                <i class="fas fa-chevron-right"></i>
            </button>
        `;
        
        paginationHTML += `
                </div>
            </div>
        `;
        
        container.innerHTML = paginationHTML;
        
        container.querySelectorAll('.pagination-btn:not([disabled])').forEach(btn => {
            btn.addEventListener('click', () => {
                const page = parseInt(btn.getAttribute('data-page'));
                if (page >= 1 && page <= totalPages) {
                    onPageChange(page);
                }
            });
        });
    }
};

// VARIÁVEIS GLOBAIS DE CONTROLE
let currentLiberacoesPage = 1;
let currentLiberacoesSort = { field: 'data', direction: 'desc' };

// ===== INICIALIZAÇÃO DA APLICAÇÃO =====
document.addEventListener('DOMContentLoaded', function() {
    // Aplicar tema padrão (dark)
    if (!localStorage.getItem('ggomes_config')) {
        document.documentElement.classList.add('dark');
    }
    
    DB.init();
    NotificationManager.load();
    ChartManager.init();
    
    configurarTema();
    configurarNavegacao();
    configurarMenuLateral();
    atualizarDataAtual();
    configurarBuscaGlobal();
    configurarNotifications();
    
    inicializarDashboard();
    inicializarLiberacoes();
    inicializarMetas();
    inicializarConfiguracoes();
    
    // Mostrar liberações por padrão
    document.getElementById('content-liberacoes').classList.remove('hidden');
    document.querySelector('a[href="#liberacoes"]').classList.add('active');
    
    setTimeout(() => {
        NotificationManager.add('Sistema GGOMES-LOG v2.1 iniciado com sucesso!', 'success');
    }, 1000);
});

// ===== FUNÇÕES DE CONFIGURAÇÃO =====

function configurarTema() {
    const toggleButton = document.getElementById('toggle-theme');
    
    function applyTheme() {
        const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
        if (config.temaEscuro) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
        
        if (window.Chart) {
            Chart.defaults.color = config.temaEscuro ? '#e5e7eb' : '#374151';
            Chart.defaults.borderColor = config.temaEscuro ? '#374151' : '#e5e7eb';
            
            Object.values(AppConfig.charts).forEach(chart => {
                if (chart && chart.update) {
                    chart.update();
                }
            });
        }
    }
    
    applyTheme();
    
    if (toggleButton) {
        toggleButton.addEventListener('click', function() {
            const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
            config.temaEscuro = !config.temaEscuro;
            localStorage.setItem('ggomes_config', JSON.stringify(config));
            
            applyTheme();
            
            Toast.show(
                `Tema ${config.temaEscuro ? 'escuro' : 'claro'} ativado`, 
                'info', 
                2000
            );
        });
    }
    
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
    }
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
        if (event.matches) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    });
}

function configurarNavegacao() {
    const links = document.querySelectorAll('.sidebar-link');
    const contents = document.querySelectorAll('.content');
    
    links.forEach(function(link) {
        link.addEventListener('click', function(event) {
            event.preventDefault();
            
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById('content-' + targetId);
            
            if (targetElement) {
                contents.forEach(content => content.classList.add('hidden'));
                
                links.forEach(lnk => {
                    lnk.classList.remove('active', 'bg-primary-100', 'dark:bg-primary-900', 'text-primary-700', 'dark:text-primary-300');
                });
                
                targetElement.classList.remove('hidden');
                
                this.classList.add('active', 'bg-primary-100', 'dark:bg-primary-900', 'text-primary-700', 'dark:text-primary-300');
                
                const pageTitle = document.getElementById('page-title');
                const pageSubtitle = document.getElementById('page-subtitle');
                
                const titles = {
                    'dashboard': {
                        title: 'Dashboard',
                        subtitle: 'Visão geral do sistema e indicadores principais'
                    },
                    'liberacoes': {
                        title: 'Liberações',
                        subtitle: 'Gerenciamento completo de liberações de produção'
                    },
                    'metas': {
                        title: 'Metas de Colheita',
                        subtitle: 'Gestão completa de frentes próprias/terceiras, metas e acompanhamento da colheita'
                    },
                    'configuracoes': {
                        title: 'Configurações',
                        subtitle: 'Configurações do sistema e gestão de dados'
                    }
                };
                
                if (titles[targetId]) {
                    pageTitle.textContent = titles[targetId].title;
                    if (pageSubtitle) {
                        pageSubtitle.textContent = titles[targetId].subtitle;
                    }
                }
                
                if (targetId === 'dashboard') {
                    atualizarDashboard();
                } else if (targetId === 'liberacoes') {
                    atualizarTabelaLiberacoes();
                } else if (targetId === 'metas') {
                    document.querySelector('.tab-button[data-tab="frentes"]')?.click();
                }
                
                document.getElementById('app-container').classList.remove('sidebar-open');
            }
        });
    });
    
    function handleHashChange() {
        const hash = window.location.hash.substring(1);
        if (hash) {
            const link = document.querySelector(`.sidebar-link[href="#${hash}"]`);
            if (link) {
                link.click();
            }
        }
    }
    
    handleHashChange();
    window.addEventListener('hashchange', handleHashChange);
}

function configurarMenuLateral() {
    const menuToggle = document.getElementById('mobile-menu-toggle');
    const appContainer = document.getElementById('app-container');
    
    if (menuToggle) {
        menuToggle.addEventListener('click', function() {
            appContainer.classList.toggle('sidebar-open');
        });
    }
    
    document.addEventListener('click', function(event) {
        if (window.innerWidth <= 768 && 
            appContainer.classList.contains('sidebar-open') && 
            !event.target.closest('aside') && 
            !event.target.closest('#mobile-menu-toggle')) {
            appContainer.classList.remove('sidebar-open');
        }
    });
    
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && appContainer.classList.contains('sidebar-open')) {
            appContainer.classList.remove('sidebar-open');
        }
    });
}

function atualizarDataAtual() {
    const currentDateElement = document.getElementById('current-date');
    if (currentDateElement) {
        const now = new Date();
        currentDateElement.textContent = now.toLocaleDateString('pt-BR', {
            weekday: 'short',
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
        
        setInterval(() => {
            const now = new Date();
            currentDateElement.textContent = now.toLocaleDateString('pt-BR', {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }, 60000);
    }
}

function configurarBuscaGlobal() {
    const searchGlobal = document.getElementById('search-global');
    if (!searchGlobal) return;
    
    const debouncedSearch = Utils.debounce((term) => {
        if (term.length < 2) return;
        
        const liberacoes = DB.liberacoes.search(term);
        const frentes = DB.frentes.getAll().filter(f => 
            f.nome.toLowerCase().includes(term.toLowerCase()) ||
            f.fazenda.toLowerCase().includes(term.toLowerCase())
        );
        
        console.log('Resultados da busca:', { liberacoes, frentes });
    }, 300);
    
    searchGlobal.addEventListener('input', (e) => {
        debouncedSearch(e.target.value);
    });
}

function configurarNotifications() {
    const btnNotifications = document.getElementById('btn-notifications');
    const modalNotifications = document.getElementById('modal-notifications');
    const btnCloseNotifications = document.getElementById('btn-close-notifications');
    const btnClearNotifications = document.getElementById('btn-clear-notifications');
    
    if (btnNotifications) {
        btnNotifications.addEventListener('click', () => {
            modalNotifications.classList.remove('hidden');
            renderNotifications();
            NotificationManager.markAllAsRead();
        });
    }
    
    if (btnCloseNotifications) {
        btnCloseNotifications.addEventListener('click', () => {
            modalNotifications.classList.add('hidden');
        });
    }
    
    if (btnClearNotifications) {
        btnClearNotifications.addEventListener('click', () => {
            NotificationManager.clear();
            renderNotifications();
        });
    }
    
    modalNotifications?.addEventListener('click', (e) => {
        if (e.target === modalNotifications) {
            modalNotifications.classList.add('hidden');
        }
    });
}

function renderNotifications() {
    const container = document.getElementById('notifications-list');
    if (!container) return;
    
    if (AppConfig.notifications.length === 0) {
        container.innerHTML = `
            <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                <i class="fas fa-bell-slash text-3xl mb-2"></i>
                <p>Nenhuma notificação</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = AppConfig.notifications.map(notification => {
        const typeIcon = {
            'success': 'fa-check-circle text-green-500',
            'error': 'fa-exclamation-circle text-red-500',
            'warning': 'fa-exclamation-triangle text-yellow-500',
            'info': 'fa-info-circle text-blue-500'
        };
        
        return `
            <div class="flex items-start space-x-3 p-3 ${!notification.read ? 'bg-blue-50 dark:bg-blue-900/20' : ''} rounded-lg">
                <i class="fas ${typeIcon[notification.type] || typeIcon.info} mt-1"></i>
                <div class="flex-1 min-w-0">
                    <p class="text-sm text-gray-800 dark:text-gray-200">${notification.message}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                        ${Utils.formatarDataHora(notification.timestamp)}
                    </p>
                </div>
            </div>
        `;
    }).join('');
}

// ===== DASHBOARD =====

function inicializarDashboard() {
    // Dashboard será atualizado quando a aba for ativada
}

function atualizarDashboard() {
    atualizarEstatisticasDashboard();
    ChartManager.updateCharts();
    atualizarTabelasDashboard();
}

function atualizarEstatisticasDashboard() {
    const liberacoes = DB.liberacoes.getAll();
    const frentes = DB.frentes.getAll();
    const metas = DB.metas.getAll();
    const lancamentos = DB.lancamentos.getAll();
    
    document.getElementById('dash-total-liberacoes').textContent = liberacoes.length;
    
    const totalColhido = lancamentos.reduce((sum, l) => sum + Number(l.colhido), 0);
    document.getElementById('dash-total-colhido').textContent = Utils.formatarToneladas(totalColhido);
    
    const metasProprias = metas.filter(m => m.tipo === 'propria').length;
    const metasTerceiras = metas.filter(m => m.tipo === 'terceira').length;
    
    document.getElementById('dash-metas-proprias').textContent = metasProprias;
    document.getElementById('dash-metas-terceiras').textContent = metasTerceiras;
    
    const frentesAtivas = frentes.filter(f => f.status === 'ativa');
    document.getElementById('dash-frentes-ativas').textContent = frentesAtivas.length;
}

function atualizarTabelasDashboard() {
    const liberacoesRecentes = DB.liberacoes.getAll()
        .sort((a, b) => new Date(b.dataRegistro) - new Date(a.dataRegistro))
        .slice(0, 5);
    
    const tabelaLiberacoes = document.getElementById('dash-liberacoes-recentes');
    if (tabelaLiberacoes) {
        tabelaLiberacoes.innerHTML = liberacoesRecentes.map(lib => {
            const progresso = Number(lib.previsto) > 0 ? 
                (Number(lib.realizado) / Number(lib.previsto)) * 100 : 0;
            const statusConfig = Utils.getStatusConfig(lib.status);
            
            return `
                <tr>
                    <td class="px-3 py-2 text-sm text-gray-900 dark:text-gray-100">${lib.frente}</td>
                    <td class="px-3 py-2 text-center">
                        <span class="px-2 py-1 rounded text-xs font-medium ${statusConfig.bg} ${statusConfig.text}">
                            ${statusConfig.texto}
                        </span>
                    </td>
                    <td class="px-3 py-2 text-right text-sm text-gray-900 dark:text-gray-100">${progresso.toFixed(1)}%</td>
                </tr>
            `;
        }).join('');
    }
    
    const frentesDesempenho = DB.frentes.getAll().map(frente => {
        const metas = DB.metas.getAll().filter(m => m.frenteId === frente.id);
        const totalMeta = metas.reduce((sum, m) => sum + Number(m.valor), 0);
        
        const lancamentos = DB.lancamentos.getAll().filter(l => l.frenteId === frente.id);
        const totalColhido = lancamentos.reduce((sum, l) => sum + Number(l.colhido), 0);
        
        const percentual = totalMeta > 0 ? (totalColhido / totalMeta) * 100 : 0;
        
        return {
            frente: frente.nome,
            tipo: frente.tipo,
            percentual: percentual
        };
    }).slice(0, 5);
    
    const tabelaDesempenho = document.getElementById('dash-desempenho-frentes');
    if (tabelaDesempenho) {
        tabelaDesempenho.innerHTML = frentesDesempenho.map(item => {
            const tipoConfig = Utils.getTipoConfig(item.tipo);
            
            return `
                <tr>
                    <td class="px-3 py-2 text-sm text-gray-900 dark:text-gray-100">${item.frente}</td>
                    <td class="px-3 py-2 text-center">
                        <span class="px-2 py-1 rounded text-xs font-medium ${tipoConfig.bg} ${tipoConfig.text}">
                            <i class="fas ${tipoConfig.icon} mr-1"></i>${tipoConfig.texto}
                        </span>
                    </td>
                    <td class="px-3 py-2 text-right text-sm text-gray-900 dark:text-gray-100">${item.percentual.toFixed(1)}%</td>
                </tr>
            `;
        }).join('');
    }
}

// ===== LIBERAÇÕES =====

function inicializarLiberacoes() {
    const formLiberacao = document.getElementById('form-liberacao');
    const searchLiberacoes = document.getElementById('search-liberacoes');
    const filtros = ['filtro-liberacao-frente', 'filtro-liberacao-fazenda', 'filtro-liberacao-status'];
    
    if (formLiberacao) {
        formLiberacao.addEventListener('submit', handleFormLiberacaoSubmit);
        
        document.getElementById('btn-cancel-liberacao')?.addEventListener('click', () => {
            limparFormularioLiberacao();
        });
        
        document.getElementById('btn-clear-form-liberacao')?.addEventListener('click', () => {
            limparFormularioLiberacao();
        });
        
        document.getElementById('liberacao-data').value = new Date().toISOString().split('T')[0];
    }
    
    if (searchLiberacoes) {
        const debouncedSearch = Utils.debounce(() => {
            currentLiberacoesPage = 1;
            atualizarTabelaLiberacoes();
        }, 300);
        
        searchLiberacoes.addEventListener('input', debouncedSearch);
    }
    
    filtros.forEach(filtroId => {
        const filtro = document.getElementById(filtroId);
        if (filtro) {
            filtro.addEventListener('change', () => {
                currentLiberacoesPage = 1;
                atualizarTabelaLiberacoes();
                atualizarResumoLiberacoes();
            });
        }
    });
    
    document.getElementById('btn-clear-filters')?.addEventListener('click', limparFiltrosLiberacoes);
    document.getElementById('btn-export-liberacoes')?.addEventListener('click', exportarLiberacoes);
    document.getElementById('btn-refresh-liberacoes')?.addEventListener('click', () => {
        atualizarTabelaLiberacoes();
        atualizarResumoLiberacoes();
        Toast.show('Dados atualizados', 'success', 2000);
    });
    
    document.querySelectorAll('[data-sort]').forEach(header => {
        header.addEventListener('click', () => {
            const field = header.getAttribute('data-sort');
            if (currentLiberacoesSort.field === field) {
                currentLiberacoesSort.direction = currentLiberacoesSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentLiberacoesSort.field = field;
                currentLiberacoesSort.direction = 'asc';
            }
            
            document.querySelectorAll('[data-sort] i').forEach(icon => {
                icon.className = 'fas fa-sort ml-1';
            });
            
            const icon = header.querySelector('i');
            if (icon) {
                icon.className = `fas fa-sort-${currentLiberacoesSort.direction === 'asc' ? 'up' : 'down'} ml-1`;
            }
            
            atualizarTabelaLiberacoes();
        });
    });
    
    atualizarFiltrosLiberacoes();
    atualizarTabelaLiberacoes();
    atualizarResumoLiberacoes();
}

function handleFormLiberacaoSubmit(event) {
    event.preventDefault();
    
    if (!Utils.validateForm(event.target)) {
        Toast.show('Por favor, corrija os erros no formulário', 'error');
        return;
    }
    
    const liberacao = {
        frente: document.getElementById('liberacao-frente').value,
        fazenda: document.getElementById('liberacao-fazenda').value,
        numero: document.getElementById('liberacao-numero').value,
        status: document.getElementById('liberacao-status').value,
        previsto: document.getElementById('liberacao-previsto').value,
        realizado: document.getElementById('liberacao-realizado').value,
        data: document.getElementById('liberacao-data').value,
        observacoes: document.getElementById('liberacao-observacoes').value
    };
    
    try {
        const isEditing = event.target.hasAttribute('data-editing');
        const submitButton = document.getElementById('btn-submit-liberacao');
        const submitText = document.getElementById('btn-submit-text');
        
        submitButton.classList.add('btn-loading');
        submitButton.disabled = true;
        submitText.textContent = isEditing ? 'Atualizando...' : 'Salvando...';
        
        setTimeout(() => {
            try {
                if (isEditing) {
                    const liberacaoId = event.target.getAttribute('data-editing');
                    liberacao.id = liberacaoId;
                    DB.liberacoes.update(liberacao);
                    Toast.show('Liberação atualizada com sucesso!', 'success');
                } else {
                    DB.liberacoes.add(liberacao);
                    Toast.show('Liberação cadastrada com sucesso!', 'success');
                }
                
                limparFormularioLiberacao();
                atualizarFiltrosLiberacoes();
                atualizarTabelaLiberacoes();
                atualizarResumoLiberacoes();
            } catch (error) {
                Toast.show(error.message, 'error');
            } finally {
                submitButton.classList.remove('btn-loading');
                submitButton.disabled = false;
                submitText.textContent = 'Salvar Liberação';
            }
        }, 500);
        
    } catch (error) {
        Toast.show(error.message, 'error');
    }
}

function limparFormularioLiberacao() {
    const form = document.getElementById('form-liberacao');
    if (form) {
        form.reset();
        form.removeAttribute('data-editing');
        Utils.clearFormValidation(form);
        
        document.getElementById('liberacao-data').value = new Date().toISOString().split('T')[0];
        document.getElementById('liberacao-status').value = 'aberto';
        document.getElementById('btn-submit-text').textContent = 'Salvar Liberação';
    }
}

function limparFiltrosLiberacoes() {
    document.getElementById('search-liberacoes').value = '';
    document.getElementById('filtro-liberacao-frente').value = '';
    document.getElementById('filtro-liberacao-fazenda').value = '';
    document.getElementById('filtro-liberacao-status').value = '';
    
    currentLiberacoesPage = 1;
    atualizarTabelaLiberacoes();
    atualizarResumoLiberacoes();
}

function atualizarFiltrosLiberacoes() {
    const valores = DB.liberacoes.getUniqueValues();
    
    const filtroFrente = document.getElementById('filtro-liberacao-frente');
    if (filtroFrente) {
        const valorAtual = filtroFrente.value;
        filtroFrente.innerHTML = '<option value="">Todas</option>';
        valores.frentes.forEach(frente => {
            const option = document.createElement('option');
            option.value = frente;
            option.textContent = frente;
            filtroFrente.appendChild(option);
        });
        if (valorAtual && valores.frentes.includes(valorAtual)) {
            filtroFrente.value = valorAtual;
        }
    }
    
    const filtroFazenda = document.getElementById('filtro-liberacao-fazenda');
    if (filtroFazenda) {
        const valorAtual = filtroFazenda.value;
        filtroFazenda.innerHTML = '<option value="">Todas</option>';
        valores.fazendas.forEach(fazenda => {
            const option = document.createElement('option');
            option.value = fazenda;
            option.textContent = fazenda;
            filtroFazenda.appendChild(option);
        });
        if (valorAtual && valores.fazendas.includes(valorAtual)) {
            filtroFazenda.value = valorAtual;
        }
    }
}

function atualizarResumoLiberacoes() {
    const searchTerm = document.getElementById('search-liberacoes')?.value || '';
    const filters = {
        frente: document.getElementById('filtro-liberacao-frente')?.value || '',
        fazenda: document.getElementById('filtro-liberacao-fazenda')?.value || '',
        status: document.getElementById('filtro-liberacao-status')?.value || ''
    };
    
    Object.keys(filters).forEach(key => {
        if (!filters[key]) delete filters[key];
    });
    
    const totals = DB.liberacoes.getTotals(filters.frente, filters.fazenda, filters.status);
    
    document.getElementById('resumo-total-previsto').textContent = Utils.formatarToneladas(totals.previsto);
    document.getElementById('resumo-total-realizado').textContent = Utils.formatarToneladas(totals.realizado);
    document.getElementById('resumo-total-restante').textContent = Utils.formatarToneladas(totals.restante);
    document.getElementById('resumo-status-aberto').textContent = totals.statusAberto;
    document.getElementById('resumo-status-fechado').textContent = totals.statusFechado;
    document.getElementById('resumo-total-geral').textContent = totals.count;
}

function atualizarTabelaLiberacoes() {
    const tabelaElement = document.getElementById('tabela-liberacoes');
    const resultsCount = document.getElementById('results-count');
    
    if (!tabelaElement) return;
    
    const searchTerm = document.getElementById('search-liberacoes')?.value || '';
    const filters = {
        frente: document.getElementById('filtro-liberacao-frente')?.value || '',
        fazenda: document.getElementById('filtro-liberacao-fazenda')?.value || '',
        status: document.getElementById('filtro-liberacao-status')?.value || ''
    };
    
    Object.keys(filters).forEach(key => {
        if (!filters[key]) delete filters[key];
    });
    
    let liberacoes = DB.liberacoes.search(searchTerm, filters);
    
    liberacoes.sort((a, b) => {
        let aVal = a[currentLiberacoesSort.field];
        let bVal = b[currentLiberacoesSort.field];
        
        if (['previsto', 'realizado', 'restante'].includes(currentLiberacoesSort.field)) {
            aVal = Number(aVal) || 0;
            bVal = Number(bVal) || 0;
        }
        
        if (currentLiberacoesSort.field === 'data') {
            aVal = new Date(aVal);
            bVal = new Date(bVal);
        }
        
        if (aVal < bVal) return currentLiberacoesSort.direction === 'asc' ? -1 : 1;
        if (aVal > bVal) return currentLiberacoesSort.direction === 'asc' ? 1 : -1;
        return 0;
    });
    
    const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
    const itemsPerPage = config.preferences?.itemsPerPage || AppConfig.pagination.itemsPerPage;
    const paginationResult = DB.liberacoes.paginate(liberacoes, currentLiberacoesPage, itemsPerPage);
    
    if (resultsCount) {
        resultsCount.textContent = `${paginationResult.totalItems} resultado${paginationResult.totalItems !== 1 ? 's' : ''}`;
    }
    
    tabelaElement.innerHTML = '';
    
    if (paginationResult.data.length === 0) {
        tabelaElement.innerHTML = `
            <tr>
                <td colspan="9" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                    <i class="fas fa-search text-3xl mb-2"></i>
                    <p>Nenhuma liberação encontrada</p>
                    <p class="text-sm">Tente ajustar os filtros ou termos de busca</p>
                </td>
            </tr>
        `;
    } else {
        paginationResult.data.forEach((liberacao) => {
            const progresso = Number(liberacao.previsto) > 0 ? 
                (Number(liberacao.realizado) / Number(liberacao.previsto)) * 100 : 0;
            
            const statusConfig = Utils.getStatusConfig(liberacao.status || 'aberto');
            
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
            row.innerHTML = `
                <td class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100 font-medium">${liberacao.frente}</td>
                <td class="px-4 py-3 text-sm text-gray-700 dark:text-gray-300">${liberacao.fazenda}</td>
                <td class="px-4 py-3 text-sm text-gray-700 dark:text-gray-300">${liberacao.numero || '-'}</td>
                <td class="px-4 py-3 text-center">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusConfig.bg} ${statusConfig.text}">
                        <i class="fas ${statusConfig.icon} mr-1"></i>
                        ${statusConfig.texto}
                    </span>
                </td>
                <td class="px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100">${Utils.formatarToneladas(liberacao.previsto)}</td>
                <td class="px-4 py-3 text-right text-sm font-medium text-green-600 dark:text-green-400">${Utils.formatarToneladas(liberacao.realizado)}</td>
                <td class="px-4 py-3 text-right text-sm font-medium text-red-600 dark:text-red-400">${Utils.formatarToneladas(liberacao.restante)}</td>
                <td class="px-4 py-3 text-center">
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mb-1">
                        <div class="progress-bar bg-gradient-to-r from-primary-500 to-primary-600 h-2.5 rounded-full" style="width: ${Math.min(progresso, 100)}%"></div>
                    </div>
                    <span class="text-xs font-medium text-gray-700 dark:text-gray-300">${progresso.toFixed(1)}%</span>
                </td>
                <td class="px-4 py-3 text-center">
                    <div class="flex items-center justify-center space-x-1">
                        <button class="btn-edit-liberacao p-2 text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition-all-300" data-id="${liberacao.id}" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-delete-liberacao p-2 text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-all-300" data-id="${liberacao.id}" title="Excluir">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </td>
            `;
            
            tabelaElement.appendChild(row);
        });
        
        tabelaElement.querySelectorAll('.btn-edit-liberacao').forEach(button => {
            button.addEventListener('click', function() {
                const id = this.getAttribute('data-id');
                editarLiberacao(id);
            });
        });
        
        tabelaElement.querySelectorAll('.btn-delete-liberacao').forEach(button => {
            button.addEventListener('click', function() {
                const id = this.getAttribute('data-id');
                excluirLiberacao(id);
            });
        });
    }
    
    PaginationManager.create('pagination-liberacoes', paginationResult.totalPages, currentLiberacoesPage, (page) => {
        currentLiberacoesPage = page;
        atualizarTabelaLiberacoes();
    });
}

function editarLiberacao(id) {
    try {
        const liberacao = DB.liberacoes.get(id);
        if (!liberacao) {
            Toast.show('Liberação não encontrada', 'error');
            return;
        }
        
        document.getElementById('liberacao-frente').value = liberacao.frente || '';
        document.getElementById('liberacao-fazenda').value = liberacao.fazenda || '';
        document.getElementById('liberacao-numero').value = liberacao.numero || '';
        document.getElementById('liberacao-status').value = liberacao.status || 'aberto';
        document.getElementById('liberacao-previsto').value = liberacao.previsto || '';
        document.getElementById('liberacao-realizado').value = liberacao.realizado || '';
        document.getElementById('liberacao-data').value = liberacao.data || '';
        document.getElementById('liberacao-observacoes').value = liberacao.observacoes || '';
        
        const form = document.getElementById('form-liberacao');
        form.setAttribute('data-editing', id);
        document.getElementById('btn-submit-text').textContent = 'Atualizar Liberação';
        
        Utils.clearFormValidation(form);
        
        document.getElementById('liberacao-frente').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
        });
        document.getElementById('liberacao-frente').focus();
        
        Toast.show('Liberação carregada para edição', 'info', 2000);
    } catch (error) {
        Toast.show(error.message, 'error');
    }
}

function excluirLiberacao(id) {
    try {
        const liberacao = DB.liberacoes.get(id);
        if (!liberacao) {
            Toast.show('Liberação não encontrada', 'error');
            return;
        }
        
        if (!confirm(`Tem certeza que deseja excluir a liberação "${liberacao.numero || liberacao.id}"?\n\nEsta ação não pode ser desfeita.`)) {
            return;
        }
        
        DB.liberacoes.remove(id);
        
        atualizarFiltrosLiberacoes();
        atualizarTabelaLiberacoes();
        atualizarResumoLiberacoes();
        
        Toast.show('Liberação excluída com sucesso!', 'success');
    } catch (error) {
        Toast.show(error.message, 'error');
    }
}

function exportarLiberacoes() {
    try {
        Utils.showLoading(true);
        
        const searchTerm = document.getElementById('search-liberacoes')?.value || '';
        const filters = {
            frente: document.getElementById('filtro-liberacao-frente')?.value || '',
            fazenda: document.getElementById('filtro-liberacao-fazenda')?.value || '',
            status: document.getElementById('filtro-liberacao-status')?.value || ''
        };
        
        Object.keys(filters).forEach(key => {
            if (!filters[key]) delete filters[key];
        });
        
        let liberacoes = DB.liberacoes.search(searchTerm, filters);
        
        if (liberacoes.length === 0) {
            Toast.show('Nenhuma liberação encontrada para exportar', 'warning');
            return;
        }
        
        liberacoes.sort((a, b) => new Date(b.data) - new Date(a.data));
        
        const dadosFormatados = liberacoes.map(liberacao => {
            const statusConfig = Utils.getStatusConfig(liberacao.status);
            const progresso = Number(liberacao.previsto) > 0 ? 
                (Number(liberacao.realizado) / Number(liberacao.previsto)) * 100 : 0;
            
            return {
                frente: liberacao.frente,
                fazenda: liberacao.fazenda,
                numero: liberacao.numero || '-',
                status: statusConfig.texto,
                data: Utils.formatarData(liberacao.data),
                previsto: Utils.formatarToneladas(liberacao.previsto),
                realizado: Utils.formatarToneladas(liberacao.realizado),
                restante: Utils.formatarToneladas(liberacao.restante),
                progresso: progresso.toFixed(1) + '%',
                observacoes: liberacao.observacoes || '-'
            };
        });
        
        const totals = DB.liberacoes.getTotals(filters.frente, filters.fazenda, filters.status);
        dadosFormatados.push({
            frente: '--- TOTAIS GERAIS ---',
            fazenda: '',
            numero: '',
            status: '',
            data: '',
            previsto: Utils.formatarToneladas(totals.previsto),
            realizado: Utils.formatarToneladas(totals.realizado),
            restante: Utils.formatarToneladas(totals.restante),
            progresso: totals.previsto > 0 ? ((totals.realizado / totals.previsto) * 100).toFixed(1) + '%' : '0%',
            observacoes: `${totals.count} liberação(ões)`
        });
        
        const colunas = [
            { header: 'Frente', dataKey: 'frente' },
            { header: 'Fazenda', dataKey: 'fazenda' },
            { header: 'Nº Liberação', dataKey: 'numero' },
            { header: 'Status', dataKey: 'status' },
            { header: 'Data', dataKey: 'data' },
            { header: 'Previsto', dataKey: 'previsto' },
            { header: 'Realizado', dataKey: 'realizado' },
            { header: 'Restante', dataKey: 'restante' },
            { header: 'Progresso', dataKey: 'progresso' },
            { header: 'Observações', dataKey: 'observacoes' }
        ];
        
        let titulo = 'Relatório de Liberações';
        if (Object.keys(filters).length > 0) {
            titulo += ' (Filtrado)';
        }
        
        setTimeout(() => {
            Utils.exportarPDF(titulo, dadosFormatados, colunas, `liberacoes_${new Date().toISOString().split('T')[0]}.pdf`);
            Utils.showLoading(false);
        }, 500);
        
    } catch (error) {
        Utils.showLoading(false);
        Toast.show('Erro ao exportar: ' + error.message, 'error');
    }
}

// ===== METAS DE COLHEITA =====

function inicializarMetas() {
    configurarAbasMetas();
    inicializarFrentes();
    inicializarMetasProprias();
    inicializarMetasTerceiras();
    inicializarLancamentoDiario();
    inicializarAcompanhamento();
}

function configurarAbasMetas() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const targetTab = this.getAttribute('data-tab');
            
            tabButtons.forEach(btn => {
                btn.classList.remove('active', 'border-primary-500', 'text-primary-600', 'dark:text-primary-400');
                btn.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
            });
            
            this.classList.add('active', 'border-primary-500', 'text-primary-600', 'dark:text-primary-400');
            this.classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-400');
            
            tabContents.forEach(content => content.classList.add('hidden'));
            
            const targetContent = document.getElementById(`tab-${targetTab}`);
            if (targetContent) {
                targetContent.classList.remove('hidden');
                
                switch(targetTab) {
                    case 'frentes':
                        atualizarTabelaFrente();
                        break;
                    case 'metas-proprias':
                        atualizarSelectFrentePropria();
                        atualizarTabelaMetaPropria();
                        break;
                    case 'metas-terceiras':
                        atualizarSelectFrenteTerceira();
                        atualizarTabelaMetaTerceira();
                        break;
                    case 'diario':
                        atualizarSelectFrenteLancamento();
                        atualizarTabelaLancamento();
                        document.getElementById('lancamento-data').value = new Date().toISOString().split('T')[0];
                        break;
                    case 'acompanhamento':
                        atualizarSelectFrenteAcompanhamento();
                        atualizarAcompanhamento();
                        break;
                }
            }
        });
    });
    
    document.querySelector('.tab-button[data-tab="frentes"]')?.click();
}

function inicializarFrentes() {
    const formFrente = document.getElementById('form-frente');
    
    if (formFrente) {
        formFrente.addEventListener('submit', function(event) {
            event.preventDefault();
            
            if (!Utils.validateForm(event.target)) {
                Toast.show('Por favor, corrija os erros no formulário', 'error');
                return;
            }
            
            const frente = {
                nome: document.getElementById('frente-nome').value,
                fazenda: document.getElementById('frente-fazenda').value,
                tipo: document.getElementById('frente-tipo').value,
                responsavel: document.getElementById('frente-responsavel').value,
                status: document.getElementById('frente-status').value,
                observacoes: document.getElementById('frente-observacoes').value
            };
            
            try {
                const isEditing = event.target.hasAttribute('data-editing');
                const submitText = document.getElementById('btn-submit-frente-text');
                
                submitText.textContent = isEditing ? 'Atualizando...' : 'Salvando...';
                
                setTimeout(() => {
                    try {
                        if (isEditing) {
                            const frenteId = event.target.getAttribute('data-editing');
                            frente.id = frenteId;
                            DB.frentes.update(frente);
                            Toast.show('Frente atualizada com sucesso!', 'success');
                        } else {
                            DB.frentes.add(frente);
                            Toast.show('Frente cadastrada com sucesso!', 'success');
                        }
                        
                        event.target.reset();
                        event.target.removeAttribute('data-editing');
                        Utils.clearFormValidation(event.target);
                        atualizarTabelaFrente();
                        
                        atualizarSelectFrentePropria();
                        atualizarSelectFrenteTerceira();
                        atualizarSelectFrenteLancamento();
                        atualizarSelectFrenteAcompanhamento();
                    } catch (error) {
                        Toast.show(error.message, 'error');
                    } finally {
                        submitText.textContent = 'Salvar Frente';
                    }
                }, 300);
            } catch (error) {
                Toast.show(error.message, 'error');
            }
        });
    }
    
    document.getElementById('btn-refresh-frentes')?.addEventListener('click', () => {
        atualizarTabelaFrente();
        Toast.show('Frentes atualizadas', 'success', 2000);
    });
}

function atualizarTabelaFrente() {
    const tabelaElement = document.getElementById('tabela-frentes');
    if (!tabelaElement) return;
    
    const frentes = DB.frentes.getAll();
    tabelaElement.innerHTML = '';
    
    if (frentes.length === 0) {
        tabelaElement.innerHTML = `
            <tr>
                <td colspan="5" class="px-3 py-8 text-center text-gray-500 dark:text-gray-400">
                    <i class="fas fa-map-marker-alt text-3xl mb-2"></i>
                    <p>Nenhuma frente cadastrada</p>
                    <p class="text-sm">Cadastre a primeira frente para começar</p>
                </td>
            </tr>
        `;
        return;
    }
    
    frentes.forEach(frente => {
        const statusConfig = Utils.getStatusConfig(frente.status);
        const tipoConfig = Utils.getTipoConfig(frente.tipo);
        
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
        row.innerHTML = `
            <td class="px-3 py-3 text-sm font-medium text-gray-900 dark:text-gray-100">${frente.nome}</td>
            <td class="px-3 py-3 text-sm text-gray-700 dark:text-gray-300">${frente.fazenda}</td>
            <td class="px-3 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${tipoConfig.bg} ${tipoConfig.text}">
                    <i class="fas ${tipoConfig.icon} mr-1"></i>
                    ${tipoConfig.texto}
                </span>
            </td>
            <td class="px-3 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusConfig.bg} ${statusConfig.text}">
                    <i class="fas ${statusConfig.icon} mr-1"></i>
                    ${statusConfig.texto}
                </span>
            </td>
            <td class="px-3 py-3 text-center">
                <div class="flex items-center justify-center space-x-1">
                    <button class="btn-edit-frente p-2 text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition-all-300" data-id="${frente.id}" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-delete-frente p-2 text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-all-300" data-id="${frente.id}" title="Excluir">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </td>
        `;
        
        tabelaElement.appendChild(row);
    });
    
    tabelaElement.querySelectorAll('.btn-edit-frente').forEach(button => {
        button.addEventListener('click', function() {
            editarFrente(this.getAttribute('data-id'));
        });
    });
    
    tabelaElement.querySelectorAll('.btn-delete-frente').forEach(button => {
        button.addEventListener('click', function() {
            excluirFrente(this.getAttribute('data-id'));
        });
    });
}

function editarFrente(id) {
    try {
        const frente = DB.frentes.get(id);
        if (!frente) {
            Toast.show('Frente não encontrada', 'error');
            return;
        }
        
        document.getElementById('frente-nome').value = frente.nome || '';
        document.getElementById('frente-fazenda').value = frente.fazenda || '';
        document.getElementById('frente-tipo').value = frente.tipo || 'propria';
        document.getElementById('frente-responsavel').value = frente.responsavel || '';
        document.getElementById('frente-status').value = frente.status || 'ativa';
        document.getElementById('frente-observacoes').value = frente.observacoes || '';
        
        const form = document.getElementById('form-frente');
        form.setAttribute('data-editing', id);
        document.getElementById('btn-submit-frente-text').textContent = 'Atualizar Frente';
        Utils.clearFormValidation(form);
        
        document.getElementById('frente-nome').focus();
        Toast.show('Frente carregada para edição', 'info', 2000);
    } catch (error) {
        Toast.show(error.message, 'error');
    }
}

function excluirFrente(id) {
    try {
        const frente = DB.frentes.get(id);
        if (!frente) {
            Toast.show('Frente não encontrada', 'error');
            return;
        }
        
        if (!confirm(`Tem certeza que deseja excluir a frente "${frente.nome}" (${Utils.getTipoConfig(frente.tipo).texto})?\n\nEsta ação não pode ser desfeita.`)) {
            return;
        }
        
        DB.frentes.remove(id);
        atualizarTabelaFrente();
        
        atualizarSelectFrentePropria();
        atualizarSelectFrenteTerceira();
        atualizarSelectFrenteLancamento();
        atualizarSelectFrenteAcompanhamento();
        
        Toast.show('Frente excluída com sucesso!', 'success');
    } catch (error) {
        Toast.show(error.message, 'error');
    }
}

function inicializarMetasProprias() {
    const formMetaPropria = document.getElementById('form-meta-propria');
    
    if (formMetaPropria) {
        formMetaPropria.addEventListener('submit', function(event) {
            event.preventDefault();
            
            if (!Utils.validateForm(event.target)) {
                Toast.show('Por favor, corrija os erros no formulário', 'error');
                return;
            }
            
            const meta = {
                frenteId: document.getElementById('meta-propria-frente').value,
                tipo: 'propria',
                periodo: document.getElementById('meta-propria-periodo').value,
                valor: document.getElementById('meta-propria-valor').value,
                dataInicio: document.getElementById('meta-propria-data-inicio').value,
                dataFim: document.getElementById('meta-propria-data-fim').value,
                observacoes: document.getElementById('meta-propria-observacoes').value
            };
            
            try {
                const isEditing = event.target.hasAttribute('data-editing');
                const submitText = document.getElementById('btn-submit-meta-propria-text');
                
                submitText.textContent = isEditing ? 'Atualizando...' : 'Salvando...';
                
                setTimeout(() => {
                    try {
                        if (isEditing) {
                            const metaId = event.target.getAttribute('data-editing');
                            meta.id = metaId;
                            DB.metas.update(meta);
                            Toast.show('Meta própria atualizada com sucesso!', 'success');
                        } else {
                            DB.metas.add(meta);
                            Toast.show('Meta própria cadastrada com sucesso!', 'success');
                        }
                        
                        event.target.reset();
                        event.target.removeAttribute('data-editing');
                        Utils.clearFormValidation(event.target);
                        atualizarTabelaMetaPropria();
                    } catch (error) {
                        Toast.show(error.message, 'error');
                    } finally {
                        submitText.textContent = 'Salvar Meta Própria';
                    }
                }, 300);
            } catch (error) {
                Toast.show(error.message, 'error');
            }
        });
    }
    
    document.getElementById('btn-refresh-metas-proprias')?.addEventListener('click', () => {
        atualizarTabelaMetaPropria();
        Toast.show('Metas próprias atualizadas', 'success', 2000);
    });
}

function atualizarSelectFrentePropria() {
    const select = document.getElementById('meta-propria-frente');
    if (!select) return;
    
    const frentesProprias = DB.frentes.getAtivasByTipo('propria');
    const valorAtual = select.value;
    
    select.innerHTML = '<option value="">Selecione uma frente própria</option>';
    
    frentesProprias.forEach(frente => {
        const option = document.createElement('option');
        option.value = frente.id;
        option.textContent = `${frente.nome} - ${frente.fazenda}`;
        select.appendChild(option);
    });
    
    if (valorAtual && frentesProprias.some(f => f.id === valorAtual)) {
        select.value = valorAtual;
    }
}

function atualizarTabelaMetaPropria() {
    const tabelaElement = document.getElementById('tabela-metas-proprias');
    if (!tabelaElement) return;
    
    const metasProprias = DB.metas.getByTipo('propria');
    tabelaElement.innerHTML = '';
    
    if (metasProprias.length === 0) {
        tabelaElement.innerHTML = `
            <tr>
                <td colspan="5" class="px-3 py-8 text-center text-gray-500 dark:text-gray-400">
                    <i class="fas fa-home text-3xl mb-2"></i>
                    <p>Nenhuma meta própria definida</p>
                    <p class="text-sm">Defina a primeira meta própria para começar</p>
                </td>
            </tr>
        `;
        return;
    }
    
    metasProprias.forEach(meta => {
        const frente = DB.frentes.get(meta.frenteId);
        const frenteNome = frente ? frente.nome : 'Frente não encontrada';
        
        const hoje = new Date().toISOString().split('T')[0];
        const isAtiva = meta.dataInicio <= hoje && meta.dataFim >= hoje;
        const statusMeta = isAtiva ? 'Ativa' : 'Inativa';
        const statusColor = isAtiva ? 'green' : 'gray';
        
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
        row.innerHTML = `
            <td class="px-3 py-3 text-sm font-medium text-gray-900 dark:text-gray-100">${frenteNome}</td>
            <td class="px-3 py-3 text-sm text-gray-700 dark:text-gray-300">${meta.periodo.charAt(0).toUpperCase() + meta.periodo.slice(1)}</td>
            <td class="px-3 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100">${Utils.formatarToneladas(meta.valor)}</td>
            <td class="px-3 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${statusColor}-100 dark:bg-${statusColor}-900 text-${statusColor}-700 dark:text-${statusColor}-300">
                    ${statusMeta}
                </span>
            </td>
            <td class="px-3 py-3 text-center">
                <div class="flex items-center justify-center space-x-1">
                    <button class="btn-edit-meta-propria p-2 text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition-all-300" data-id="${meta.id}" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-delete-meta-propria p-2 text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-all-300" data-id="${meta.id}" title="Excluir">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </td>
        `;
        
        tabelaElement.appendChild(row);
    });
    
    tabelaElement.querySelectorAll('.btn-edit-meta-propria').forEach(button => {
        button.addEventListener('click', function() {
            editarMetaPropria(this.getAttribute('data-id'));
        });
    });
    
    tabelaElement.querySelectorAll('.btn-delete-meta-propria').forEach(button => {
        button.addEventListener('click', function() {
            excluirMeta(this.getAttribute('data-id'));
        });
    });
}

function editarMetaPropria(id) {
    try {
        const meta = DB.metas.get(id);
        if (!meta) {
            Toast.show('Meta não encontrada', 'error');
            return;
        }
        
        document.getElementById('meta-propria-frente').value = meta.frenteId || '';
        document.getElementById('meta-propria-periodo').value = meta.periodo || 'diario';
        document.getElementById('meta-propria-valor').value = meta.valor || '';
        document.getElementById('meta-propria-data-inicio').value = meta.dataInicio || '';
        document.getElementById('meta-propria-data-fim').value = meta.dataFim || '';
        document.getElementById('meta-propria-observacoes').value = meta.observacoes || '';
        
        const form = document.getElementById('form-meta-propria');
        form.setAttribute('data-editing', id);
        document.getElementById('btn-submit-meta-propria-text').textContent = 'Atualizar Meta Própria';
        Utils.clearFormValidation(form);
        
        document.getElementById('meta-propria-frente').focus();
        Toast.show('Meta própria carregada para edição', 'info', 2000);
    } catch (error) {
        Toast.show(error.message, 'error');
    }
}

function inicializarMetasTerceiras() {
    const formMetaTerceira = document.getElementById('form-meta-terceira');
    
    if (formMetaTerceira) {
        formMetaTerceira.addEventListener('submit', function(event) {
            event.preventDefault();
            
            if (!Utils.validateForm(event.target)) {
                Toast.show('Por favor, corrija os erros no formulário', 'error');
                return;
            }
            
            const meta = {
                frenteId: document.getElementById('meta-terceira-frente').value,
                tipo: 'terceira',
                periodo: document.getElementById('meta-terceira-periodo').value,
                valor: document.getElementById('meta-terceira-valor').value,
                dataInicio: document.getElementById('meta-terceira-data-inicio').value,
                dataFim: document.getElementById('meta-terceira-data-fim').value,
                observacoes: document.getElementById('meta-terceira-observacoes').value
            };
            
            try {
                const isEditing = event.target.hasAttribute('data-editing');
                const submitText = document.getElementById('btn-submit-meta-terceira-text');
                
                submitText.textContent = isEditing ? 'Atualizando...' : 'Salvando...';
                
                setTimeout(() => {
                    try {
                        if (isEditing) {
                            const metaId = event.target.getAttribute('data-editing');
                            meta.id = metaId;
                            DB.metas.update(meta);
                            Toast.show('Meta terceira atualizada com sucesso!', 'success');
                        } else {
                            DB.metas.add(meta);
                            Toast.show('Meta terceira cadastrada com sucesso!', 'success');
                        }
                        
                        event.target.reset();
                        event.target.removeAttribute('data-editing');
                        Utils.clearFormValidation(event.target);
                        atualizarTabelaMetaTerceira();
                    } catch (error) {
                        Toast.show(error.message, 'error');
                    } finally {
                        submitText.textContent = 'Salvar Meta Terceira';
                    }
                }, 300);
            } catch (error) {
                Toast.show(error.message, 'error');
            }
        });
    }
    
    document.getElementById('btn-refresh-metas-terceiras')?.addEventListener('click', () => {
        atualizarTabelaMetaTerceira();
        Toast.show('Metas terceiras atualizadas', 'success', 2000);
    });
}

function atualizarSelectFrenteTerceira() {
    const select = document.getElementById('meta-terceira-frente');
    if (!select) return;
    
    const frentesTerceiras = DB.frentes.getAtivasByTipo('terceira');
    const valorAtual = select.value;
    
    select.innerHTML = '<option value="">Selecione uma frente terceira</option>';
    
    frentesTerceiras.forEach(frente => {
        const option = document.createElement('option');
        option.value = frente.id;
        option.textContent = `${frente.nome} - ${frente.fazenda}`;
        select.appendChild(option);
    });
    
    if (valorAtual && frentesTerceiras.some(f => f.id === valorAtual)) {
        select.value = valorAtual;
    }
}

function atualizarTabelaMetaTerceira() {
    const tabelaElement = document.getElementById('tabela-metas-terceiras');
    if (!tabelaElement) return;
    
    const metasTerceiras = DB.metas.getByTipo('terceira');
    tabelaElement.innerHTML = '';
    
    if (metasTerceiras.length === 0) {
        tabelaElement.innerHTML = `
            <tr>
                <td colspan="5" class="px-3 py-8 text-center text-gray-500 dark:text-gray-400">
                    <i class="fas fa-handshake text-3xl mb-2"></i>
                    <p>Nenhuma meta terceira definida</p>
                    <p class="text-sm">Defina a primeira meta terceira para começar</p>
                </td>
            </tr>
        `;
        return;
    }
    
    metasTerceiras.forEach(meta => {
        const frente = DB.frentes.get(meta.frenteId);
        const frenteNome = frente ? frente.nome : 'Frente não encontrada';
        
        const hoje = new Date().toISOString().split('T')[0];
        const isAtiva = meta.dataInicio <= hoje && meta.dataFim >= hoje;
        const statusMeta = isAtiva ? 'Ativa' : 'Inativa';
        const statusColor = isAtiva ? 'green' : 'gray';
        
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
        row.innerHTML = `
            <td class="px-3 py-3 text-sm font-medium text-gray-900 dark:text-gray-100">${frenteNome}</td>
            <td class="px-3 py-3 text-sm text-gray-700 dark:text-gray-300">${meta.periodo.charAt(0).toUpperCase() + meta.periodo.slice(1)}</td>
            <td class="px-3 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100">${Utils.formatarToneladas(meta.valor)}</td>
            <td class="px-3 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${statusColor}-100 dark:bg-${statusColor}-900 text-${statusColor}-700 dark:text-${statusColor}-300">
                    ${statusMeta}
                </span>
            </td>
            <td class="px-3 py-3 text-center">
                <div class="flex items-center justify-center space-x-1">
                    <button class="btn-edit-meta-terceira p-2 text-orange-600 hover:text-orange-900 dark:text-orange-400 dark:hover:text-orange-200 hover:bg-orange-50 dark:hover:bg-orange-900/20 rounded-md transition-all-300" data-id="${meta.id}" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-delete-meta-terceira p-2 text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-all-300" data-id="${meta.id}" title="Excluir">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </td>
        `;
        
        tabelaElement.appendChild(row);
    });
    
    tabelaElement.querySelectorAll('.btn-edit-meta-terceira').forEach(button => {
        button.addEventListener('click', function() {
            editarMetaTerceira(this.getAttribute('data-id'));
        });
    });
    
    tabelaElement.querySelectorAll('.btn-delete-meta-terceira').forEach(button => {
        button.addEventListener('click', function() {
            excluirMeta(this.getAttribute('data-id'));
        });
    });
}

function editarMetaTerceira(id) {
    try {
        const meta = DB.metas.get(id);
        if (!meta) {
            Toast.show('Meta não encontrada', 'error');
            return;
        }
        
        document.getElementById('meta-terceira-frente').value = meta.frenteId || '';
        document.getElementById('meta-terceira-periodo').value = meta.periodo || 'diario';
        document.getElementById('meta-terceira-valor').value = meta.valor || '';
        document.getElementById('meta-terceira-data-inicio').value = meta.dataInicio || '';
        document.getElementById('meta-terceira-data-fim').value = meta.dataFim || '';
        document.getElementById('meta-terceira-observacoes').value = meta.observacoes || '';
        
        const form = document.getElementById('form-meta-terceira');
        form.setAttribute('data-editing', id);
        document.getElementById('btn-submit-meta-terceira-text').textContent = 'Atualizar Meta Terceira';
        Utils.clearFormValidation(form);
        
        document.getElementById('meta-terceira-frente').focus();
        Toast.show('Meta terceira carregada para edição', 'info', 2000);
    } catch (error) {
        Toast.show(error.message, 'error');
    }
}

function excluirMeta(id) {
    try {
        const meta = DB.metas.get(id);
        if (!meta) {
            Toast.show('Meta não encontrada', 'error');
            return;
        }
        
        const frente = DB.frentes.get(meta.frenteId);
        const frenteNome = frente ? frente.nome : 'Frente desconhecida';
        const tipoConfig = Utils.getTipoConfig(meta.tipo);
        
        if (!confirm(`Tem certeza que deseja excluir a meta ${tipoConfig.texto.toLowerCase()} da frente "${frenteNome}"?\n\nEsta ação não pode ser desfeita.`)) {
            return;
        }
        
        DB.metas.remove(id);
        
        if (meta.tipo === 'propria') {
            atualizarTabelaMetaPropria();
        } else {
            atualizarTabelaMetaTerceira();
        }
        
        Toast.show(`Meta ${tipoConfig.texto.toLowerCase()} excluída com sucesso!`, 'success');
    } catch (error) {
        Toast.show(error.message, 'error');
    }
}

function inicializarLancamentoDiario() {
    const formLancamento = document.getElementById('form-lancamento');
    
    if (formLancamento) {
        formLancamento.addEventListener('submit', function(event) {
            event.preventDefault();
            
            if (!Utils.validateForm(event.target)) {
                Toast.show('Por favor, corrija os erros no formulário', 'error');
                return;
            }
            
            const lancamento = {
                frenteId: document.getElementById('lancamento-frente').value,
                data: document.getElementById('lancamento-data').value,
                colhido: document.getElementById('lancamento-colhido').value,
                turno: document.getElementById('lancamento-turno').value,
                operador: document.getElementById('lancamento-operador').value,
                observacoes: document.getElementById('lancamento-observacoes').value
            };
            
            try {
                const isEditing = event.target.hasAttribute('data-editing');
                const submitText = document.getElementById('btn-submit-lancamento-text');
                
                submitText.textContent = isEditing ? 'Atualizando...' : 'Salvando...';
                
                setTimeout(() => {
                    try {
                        if (isEditing) {
                            const lancamentoId = event.target.getAttribute('data-editing');
                            lancamento.id = lancamentoId;
                            DB.lancamentos.update(lancamento);
                            Toast.show('Lançamento atualizado com sucesso!', 'success');
                        } else {
                            DB.lancamentos.add(lancamento);
                            Toast.show('Lançamento registrado com sucesso!', 'success');
                        }
                        
                        event.target.reset();
                        event.target.removeAttribute('data-editing');
                        Utils.clearFormValidation(event.target);
                        document.getElementById('lancamento-data').value = new Date().toISOString().split('T')[0];
                        atualizarTabelaLancamento();
                    } catch (error) {
                        Toast.show(error.message, 'error');
                    } finally {
                        submitText.textContent = 'Salvar Lançamento';
                    }
                }, 300);
            } catch (error) {
                Toast.show(error.message, 'error');
            }
        });
    }
    
    document.getElementById('btn-refresh-lancamentos')?.addEventListener('click', () => {
        atualizarTabelaLancamento();
        Toast.show('Lançamentos atualizados', 'success', 2000);
    });
}

function atualizarSelectFrenteLancamento() {
    const select = document.getElementById('lancamento-frente');
    if (!select) return;
    
    const frentesAtivas = DB.frentes.getAtivas();
    const valorAtual = select.value;
    
    select.innerHTML = '<option value="">Selecione uma frente</option>';
    
    frentesAtivas.forEach(frente => {
        const tipoConfig = Utils.getTipoConfig(frente.tipo);
        const option = document.createElement('option');
        option.value = frente.id;
        option.textContent = `${frente.nome} - ${frente.fazenda} (${tipoConfig.texto})`;
        select.appendChild(option);
    });
    
    if (valorAtual && frentesAtivas.some(f => f.id === valorAtual)) {
        select.value = valorAtual;
    }
}

function atualizarTabelaLancamento() {
    const tabelaElement = document.getElementById('tabela-lancamentos');
    if (!tabelaElement) return;
    
    const lancamentos = DB.lancamentos.getAll()
        .sort((a, b) => new Date(b.data) - new Date(a.data))
        .slice(0, 10);
    
    tabelaElement.innerHTML = '';
    
    if (lancamentos.length === 0) {
        tabelaElement.innerHTML = `
            <tr>
                <td colspan="6" class="px-3 py-8 text-center text-gray-500 dark:text-gray-400">
                    <i class="fas fa-calendar-day text-3xl mb-2"></i>
                    <p>Nenhum lançamento registrado</p>
                    <p class="text-sm">Registre o primeiro lançamento diário</p>
                </td>
            </tr>
        `;
        return;
    }
    
    lancamentos.forEach(lancamento => {
        const frente = DB.frentes.get(lancamento.frenteId);
        const frenteNome = frente ? frente.nome : 'Frente não encontrada';
        const tipoConfig = frente ? Utils.getTipoConfig(frente.tipo) : Utils.getTipoConfig('desconhecido');
        
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
        row.innerHTML = `
            <td class="px-3 py-3 text-sm text-gray-900 dark:text-gray-100">${Utils.formatarData(lancamento.data)}</td>
            <td class="px-3 py-3 text-sm font-medium text-gray-900 dark:text-gray-100">${frenteNome}</td>
            <td class="px-3 py-3 text-center">
                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium ${tipoConfig.bg} ${tipoConfig.text}">
                    <i class="fas ${tipoConfig.icon} mr-1"></i>
                    ${tipoConfig.texto}
                </span>
            </td>
            <td class="px-3 py-3 text-right text-sm font-medium text-green-600 dark:text-green-400">${Utils.formatarToneladas(lancamento.colhido)}</td>
            <td class="px-3 py-3 text-center text-sm text-gray-700 dark:text-gray-300">${lancamento.turno.charAt(0).toUpperCase() + lancamento.turno.slice(1)}</td>
            <td class="px-3 py-3 text-center">
                <div class="flex items-center justify-center space-x-1">
                    <button class="btn-edit-lancamento p-2 text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition-all-300" data-id="${lancamento.id}" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-delete-lancamento p-2 text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-all-300" data-id="${lancamento.id}" title="Excluir">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </td>
        `;
        
        tabelaElement.appendChild(row);
    });
    
    tabelaElement.querySelectorAll('.btn-edit-lancamento').forEach(button => {
        button.addEventListener('click', function() {
            editarLancamento(this.getAttribute('data-id'));
        });
    });
    
    tabelaElement.querySelectorAll('.btn-delete-lancamento').forEach(button => {
        button.addEventListener('click', function() {
            excluirLancamento(this.getAttribute('data-id'));
        });
    });
}

function editarLancamento(id) {
    try {
        const lancamento = DB.lancamentos.get(id);
        if (!lancamento) {
            Toast.show('Lançamento não encontrado', 'error');
            return;
        }
        
        document.getElementById('lancamento-frente').value = lancamento.frenteId || '';
        document.getElementById('lancamento-data').value = lancamento.data || '';
        document.getElementById('lancamento-colhido').value = lancamento.colhido || '';
        document.getElementById('lancamento-turno').value = lancamento.turno || 'manha';
        document.getElementById('lancamento-operador').value = lancamento.operador || '';
        document.getElementById('lancamento-observacoes').value = lancamento.observacoes || '';
        
        const form = document.getElementById('form-lancamento');
        form.setAttribute('data-editing', id);
        document.getElementById('btn-submit-lancamento-text').textContent = 'Atualizar Lançamento';
        Utils.clearFormValidation(form);
        
        document.getElementById('lancamento-frente').focus();
        Toast.show('Lançamento carregado para edição', 'info', 2000);
    } catch (error) {
        Toast.show(error.message, 'error');
    }
}

function excluirLancamento(id) {
    try {
        const lancamento = DB.lancamentos.get(id);
        if (!lancamento) {
            Toast.show('Lançamento não encontrado', 'error');
            return;
        }
        
        const frente = DB.frentes.get(lancamento.frenteId);
        const frenteNome = frente ? frente.nome : 'Frente desconhecida';
        
        if (!confirm(`Tem certeza que deseja excluir o lançamento da frente "${frenteNome}" do dia ${Utils.formatarData(lancamento.data)}?\n\nEsta ação não pode ser desfeita.`)) {
            return;
        }
        
        DB.lancamentos.remove(id);
        atualizarTabelaLancamento();
        Toast.show('Lançamento excluído com sucesso!', 'success');
    } catch (error) {
        Toast.show(error.message, 'error');
    }
}

function inicializarAcompanhamento() {
    const hoje = new Date();
    const dataFim = hoje.toISOString().split('T')[0];
    
    const dataInicio = new Date();
    dataInicio.setDate(dataInicio.getDate() - 30);
    const dataInicioStr = dataInicio.toISOString().split('T')[0];
    
    document.getElementById('filtro-acompanhamento-data-inicio').value = dataInicioStr;
    document.getElementById('filtro-acompanhamento-data-fim').value = dataFim;
    
    document.getElementById('btn-aplicar-filtro-acompanhamento')?.addEventListener('click', atualizarAcompanhamento);
    document.getElementById('btn-exportar-acompanhamento')?.addEventListener('click', exportarAcompanhamento);
}

function atualizarSelectFrenteAcompanhamento() {
    const select = document.getElementById('filtro-acompanhamento-frente');
    if (!select) return;
    
    const frentes = DB.frentes.getAll();
    const valorAtual = select.value;
    
    select.innerHTML = '<option value="">Todas as frentes</option>';
    
    frentes.forEach(frente => {
        const tipoConfig = Utils.getTipoConfig(frente.tipo);
        const option = document.createElement('option');
        option.value = frente.id;
        option.textContent = `${frente.nome} - ${frente.fazenda} (${tipoConfig.texto})`;
        select.appendChild(option);
    });
    
    if (valorAtual && frentes.some(f => f.id === valorAtual)) {
        select.value = valorAtual;
    }
}

function atualizarAcompanhamento() {
    const filtros = {
        frenteId: document.getElementById('filtro-acompanhamento-frente')?.value || '',
        tipo: document.getElementById('filtro-acompanhamento-tipo')?.value || '',
        dataInicio: document.getElementById('filtro-acompanhamento-data-inicio')?.value || '',
        dataFim: document.getElementById('filtro-acompanhamento-data-fim')?.value || ''
    };
    
    let frentes = DB.frentes.getAll();
    
    if (filtros.frenteId) {
        frentes = frentes.filter(f => f.id === filtros.frenteId);
    }
    
    if (filtros.tipo) {
        frentes = frentes.filter(f => f.tipo === filtros.tipo);
    }
    
    const dataInicio = filtros.dataInicio || new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
    const dataFim = filtros.dataFim || new Date().toISOString().split('T')[0];
    
    const resumo = {
        metasProprias: 0,
        metasTerceiras: 0,
        totalColhido: 0,
        totalMeta: 0,
        percentualMeta: 0
    };
    
    const dadosAcompanhamento = frentes.map(frente => {
        const metas = DB.metas.getAll().filter(m => 
            m.frenteId === frente.id &&
            m.dataInicio <= dataFim &&
            m.dataFim >= dataInicio
        );
        
        const metaTotal = metas.reduce((sum, m) => sum + Number(m.valor), 0);
        
        const lancamentos = DB.lancamentos.getAll().filter(l => 
            l.frenteId === frente.id &&
            l.data >= dataInicio &&
            l.data <= dataFim
        );
        
        const colhidoTotal = lancamentos.reduce((sum, l) => sum + Number(l.colhido), 0);
        const restante = Math.max(0, metaTotal - colhidoTotal);
        const percentualMeta = metaTotal > 0 ? (colhidoTotal / metaTotal) * 100 : 0;
        
        if (frente.tipo === 'propria') resumo.metasProprias++;
        if (frente.tipo === 'terceira') resumo.metasTerceiras++;
        
        resumo.totalColhido += colhidoTotal;
        resumo.totalMeta += metaTotal;
        
        return {
            frente: frente,
            metaTotal: metaTotal,
            colhidoTotal: colhidoTotal,
            restante: restante,
            percentualMeta: percentualMeta
        };
    });
    
    resumo.percentualMeta = resumo.totalMeta > 0 ? (resumo.totalColhido / resumo.totalMeta) * 100 : 0;
    
    // Atualizar cards de resumo
    document.getElementById('resumo-metas-proprias-ativas').textContent = resumo.metasProprias;
    document.getElementById('resumo-metas-terceiras-ativas').textContent = resumo.metasTerceiras;
    document.getElementById('resumo-total-colhido').textContent = Utils.formatarToneladas(resumo.totalColhido);
    document.getElementById('resumo-total-meta').textContent = Utils.formatarToneladas(resumo.totalMeta);
    document.getElementById('resumo-percentual-meta').textContent = resumo.percentualMeta.toFixed(1) + '%';
    
    // Atualizar tabela
    const tabelaElement = document.getElementById('tabela-acompanhamento');
    if (!tabelaElement) return;
    
    tabelaElement.innerHTML = '';
    
    if (dadosAcompanhamento.length === 0) {
        tabelaElement.innerHTML = `
            <tr>
                <td colspan="8" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                    <i class="fas fa-chart-line text-3xl mb-2"></i>
                    <p>Nenhuma frente encontrada</p>
                    <p class="text-sm">Ajuste os filtros para visualizar dados</p>
                </td>
            </tr>
        `;
        return;
    }
    
    dadosAcompanhamento.forEach(item => {
        const tipoConfig = Utils.getTipoConfig(item.frente.tipo);
        const statusMeta = Utils.getStatusMeta(item.percentualMeta);
        
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
        row.innerHTML = `
            <td class="px-4 py-3 text-sm font-medium text-gray-900 dark:text-gray-100">${item.frente.nome}</td>
            <td class="px-4 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${tipoConfig.bg} ${tipoConfig.text}">
                    <i class="fas ${tipoConfig.icon} mr-1"></i>
                    ${tipoConfig.texto}
                </span>
            </td>
            <td class="px-4 py-3 text-center text-sm font-medium text-gray-900 dark:text-gray-100">${Utils.formatarToneladas(item.metaTotal)}</td>
            <td class="px-4 py-3 text-center text-sm font-medium text-green-600 dark:text-green-400">${Utils.formatarToneladas(item.colhidoTotal)}</td>
            <td class="px-4 py-3 text-center text-sm font-medium text-red-600 dark:text-red-400">${Utils.formatarToneladas(item.restante)}</td>
            <td class="px-4 py-3 text-center text-sm font-bold ${item.percentualMeta >= 100 ? 'text-green-600' : item.percentualMeta >= 80 ? 'text-yellow-600' : 'text-red-600'}">${item.percentualMeta.toFixed(1)}%</td>
            <td class="px-4 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${statusMeta.cor}-100 dark:bg-${statusMeta.cor}-900 text-${statusMeta.cor}-700 dark:text-${statusMeta.cor}-300">
                    ${statusMeta.texto}
                </span>
            </td>
            <td class="px-4 py-3 text-center">
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                    <div class="progress-bar bg-gradient-to-r ${item.percentualMeta >= 100 ? 'from-green-500 to-green-600' : item.percentualMeta >= 80 ? 'from-yellow-500 to-yellow-600' : 'from-red-500 to-red-600'} h-2.5 rounded-full" style="width: ${Math.min(item.percentualMeta, 100)}%"></div>
                </div>
            </td>
        `;
        
        tabelaElement.appendChild(row);
    });
}

function exportarAcompanhamento() {
    try {
        Utils.showLoading(true);
        
        const filtros = {
            frenteId: document.getElementById('filtro-acompanhamento-frente')?.value || '',
            tipo: document.getElementById('filtro-acompanhamento-tipo')?.value || '',
            dataInicio: document.getElementById('filtro-acompanhamento-data-inicio')?.value || '',
            dataFim: document.getElementById('filtro-acompanhamento-data-fim')?.value || ''
        };
        
        let frentes = DB.frentes.getAll();
        
        if (filtros.frenteId) {
            frentes = frentes.filter(f => f.id === filtros.frenteId);
        }
        
        if (filtros.tipo) {
            frentes = frentes.filter(f => f.tipo === filtros.tipo);
        }
        
        if (frentes.length === 0) {
            Toast.show('Nenhuma frente encontrada para exportar', 'warning');
            return;
        }
        
        const dataInicio = filtros.dataInicio || new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
        const dataFim = filtros.dataFim || new Date().toISOString().split('T')[0];
        
        const dadosFormatados = frentes.map(frente => {
            const metas = DB.metas.getAll().filter(m => 
                m.frenteId === frente.id &&
                m.dataInicio <= dataFim &&
                m.dataFim >= dataInicio
            );
            
            const metaTotal = metas.reduce((sum, m) => sum + Number(m.valor), 0);
            
            const lancamentos = DB.lancamentos.getAll().filter(l => 
                l.frenteId === frente.id &&
                l.data >= dataInicio &&
                l.data <= dataFim
            );
            
            const colhidoTotal = lancamentos.reduce((sum, l) => sum + Number(l.colhido), 0);
            const restante = Math.max(0, metaTotal - colhidoTotal);
            const percentualMeta = metaTotal > 0 ? (colhidoTotal / metaTotal) * 100 : 0;
            const statusMeta = Utils.getStatusMeta(percentualMeta);
            const tipoConfig = Utils.getTipoConfig(frente.tipo);
            
            return {
                frente: frente.nome,
                fazenda: frente.fazenda,
                tipo: tipoConfig.texto,
                metaTotal: Utils.formatarToneladas(metaTotal),
                colhidoTotal: Utils.formatarToneladas(colhidoTotal),
                restante: Utils.formatarToneladas(restante),
                percentualMeta: percentualMeta.toFixed(1) + '%',
                status: statusMeta.texto
            };
        });
        
        const colunas = [
            { header: 'Frente', dataKey: 'frente' },
            { header: 'Fazenda', dataKey: 'fazenda' },
            { header: 'Tipo', dataKey: 'tipo' },
            { header: 'Meta (T)', dataKey: 'metaTotal' },
            { header: 'Colhido (T)', dataKey: 'colhidoTotal' },
            { header: 'Restante (T)', dataKey: 'restante' },
            { header: '% Meta', dataKey: 'percentualMeta' },
            { header: 'Status', dataKey: 'status' }
        ];
        
        let titulo = 'Relatório de Acompanhamento de Metas';
        if (filtros.tipo) {
            titulo += ` - ${Utils.getTipoConfig(filtros.tipo).texto}s`;
        }
        if (filtros.dataInicio && filtros.dataFim) {
            titulo += ` (${Utils.formatarData(filtros.dataInicio)} a ${Utils.formatarData(filtros.dataFim)})`;
        }
        
        setTimeout(() => {
            Utils.exportarPDF(titulo, dadosFormatados, colunas, `acompanhamento_${new Date().toISOString().split('T')[0]}.pdf`);
            Utils.showLoading(false);
        }, 500);
        
    } catch (error) {
        Utils.showLoading(false);
        Toast.show('Erro ao exportar: ' + error.message, 'error');
    }
}

// ===== CONFIGURAÇÕES =====

function inicializarConfiguracoes() {
    document.getElementById('btn-exportar-json')?.addEventListener('click', exportarDados);
    document.getElementById('btn-importar-json')?.addEventListener('click', () => {
        document.getElementById('import-json-file').click();
    });
    
    document.getElementById('import-json-file')?.addEventListener('change', importarDados);
    document.getElementById('btn-limpar-dados')?.addEventListener('click', mostrarModalLimpeza);
    
    // Relatórios
    document.getElementById('btn-relatorio-liberacoes')?.addEventListener('click', () => gerarRelatorio('liberacoes'));
    document.getElementById('btn-relatorio-metas')?.addEventListener('click', () => gerarRelatorio('metas'));
    document.getElementById('btn-relatorio-colheita')?.addEventListener('click', () => gerarRelatorio('colheita'));
    
    // Modal de confirmação
    document.getElementById('btn-cancelar-limpar')?.addEventListener('click', fecharModalLimpeza);
    document.getElementById('btn-confirmar-limpar')?.addEventListener('click', confirmarLimpeza);
    
    const confirmacaoTexto = document.getElementById('confirmacao-texto');
    if (confirmacaoTexto) {
        confirmacaoTexto.addEventListener('input', function() {
            const btnConfirmar = document.getElementById('btn-confirmar-limpar');
            if (this.value === 'CONFIRMAR') {
                btnConfirmar.disabled = false;
                btnConfirmar.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                btnConfirmar.disabled = true;
                btnConfirmar.classList.add('opacity-50', 'cursor-not-allowed');
            }
        });
    }
}

function exportarDados() {
    try {
        Utils.showLoading(true);
        
        setTimeout(() => {
            try {
                const jsonData = DB.exportData();
                const blob = new Blob([jsonData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `ggomes-log-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                Toast.show('Backup exportado com sucesso!', 'success');
                NotificationManager.add('Backup de dados realizado com sucesso', 'success');
            } catch (error) {
                Toast.show('Erro ao exportar: ' + error.message, 'error');
            } finally {
                Utils.showLoading(false);
            }
        }, 500);
    } catch (error) {
        Utils.showLoading(false);
        Toast.show('Erro ao preparar exportação: ' + error.message, 'error');
    }
}

function importarDados(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (!file.name.endsWith('.json')) {
        Toast.show('Por favor, selecione um arquivo JSON válido', 'error');
        return;
    }
    
    const reader = new FileReader();
    
    reader.onload = function(e) {
        try {
            Utils.showLoading(true);
            
            setTimeout(() => {
                try {
                    const jsonData = e.target.result;
                    
                    if (!confirm('Tem certeza que deseja importar os dados?\n\nEsta ação irá sobrescrever todos os dados existentes.')) {
                        return;
                    }
                    
                    DB.importData(jsonData);
                    
                    // Atualizar todas as interfaces
                    atualizarFiltrosLiberacoes();
                    atualizarTabelaLiberacoes();
                    atualizarResumoLiberacoes();
                    
                    if (document.getElementById('tab-frentes').classList.contains('hidden') === false) {
                        atualizarTabelaFrente();
                    }
                    
                    Toast.show('Dados importados com sucesso!', 'success');
                    NotificationManager.add('Dados importados do backup com sucesso', 'success');
                } catch (error) {
                    Toast.show('Erro ao importar: ' + error.message, 'error');
                } finally {
                    Utils.showLoading(false);
                    event.target.value = '';
                }
            }, 500);
        } catch (error) {
            Utils.showLoading(false);
            Toast.show('Erro ao ler arquivo: ' + error.message, 'error');
            event.target.value = '';
        }
    };
    
    reader.onerror = function() {
        Toast.show('Erro ao ler o arquivo', 'error');
        event.target.value = '';
    };
    
    reader.readAsText(file);
}

function mostrarModalLimpeza() {
    const modal = document.getElementById('modal-limpar-dados');
    if (modal) {
        modal.classList.remove('hidden');
        document.getElementById('confirmacao-texto').value = '';
        document.getElementById('btn-confirmar-limpar').disabled = true;
        document.getElementById('btn-confirmar-limpar').classList.add('opacity-50', 'cursor-not-allowed');
    }
}

function fecharModalLimpeza() {
    const modal = document.getElementById('modal-limpar-dados');
    if (modal) {
        modal.classList.add('hidden');
    }
}

function confirmarLimpeza() {
    const confirmacao = document.getElementById('confirmacao-texto').value;
    
    if (confirmacao !== 'CONFIRMAR') {
        Toast.show('Digite "CONFIRMAR" para confirmar a ação', 'error');
        return;
    }
    
    try {
        Utils.showLoading(true);
        
        setTimeout(() => {
            try {
                const sucesso = DB.clearAll();
                
                if (sucesso) {
                    // Limpar formulários
                    document.querySelectorAll('form').forEach(form => {
                        form.reset();
                        Utils.clearFormValidation(form);
                    });
                    
                    // Resetar variáveis de controle
                    currentLiberacoesPage = 1;
                    currentLiberacoesSort = { field: 'data', direction: 'desc' };
                    
                    // Atualizar todas as interfaces
                    atualizarFiltrosLiberacoes();
                    atualizarTabelaLiberacoes();
                    atualizarResumoLiberacoes();
                    atualizarDashboard();
                    
                    if (!document.getElementById('tab-frentes').classList.contains('hidden')) {
                        atualizarTabelaFrente();
                    }
                    
                    // Limpar gráficos
                    ChartManager.updateCharts();
                    
                    // Limpar notificações
                    NotificationManager.clear();
                    
                    fecharModalLimpeza();
                    Toast.show('Todos os dados foram removidos com sucesso!', 'success');
                    NotificationManager.add('Sistema resetado - todos os dados foram removidos', 'warning');
                } else {
                    Toast.show('Erro ao limpar os dados', 'error');
                }
            } catch (error) {
                Toast.show('Erro ao limpar dados: ' + error.message, 'error');
            } finally {
                Utils.showLoading(false);
            }
        }, 500);
    } catch (error) {
        Utils.showLoading(false);
        Toast.show('Erro ao processar limpeza: ' + error.message, 'error');
    }
}

function gerarRelatorio(tipo) {
    try {
        Utils.showLoading(true);
        
        setTimeout(() => {
            try {
                let dados = [];
                let colunas = [];
                let titulo = '';
                let nomeArquivo = '';
                
                switch (tipo) {
                    case 'liberacoes':
                        dados = DB.liberacoes.getAll().map(lib => {
                            const statusConfig = Utils.getStatusConfig(lib.status);
                            const progresso = Number(lib.previsto) > 0 ? 
                                (Number(lib.realizado) / Number(lib.previsto)) * 100 : 0;
                            
                            return {
                                frente: lib.frente,
                                fazenda: lib.fazenda,
                                numero: lib.numero || '-',
                                status: statusConfig.texto,
                                data: Utils.formatarData(lib.data),
                                previsto: Utils.formatarToneladas(lib.previsto),
                                realizado: Utils.formatarToneladas(lib.realizado),
                                restante: Utils.formatarToneladas(lib.restante),
                                progresso: progresso.toFixed(1) + '%'
                            };
                        });
                        
                        colunas = [
                            { header: 'Frente', dataKey: 'frente' },
                            { header: 'Fazenda', dataKey: 'fazenda' },
                            { header: 'Número', dataKey: 'numero' },
                            { header: 'Status', dataKey: 'status' },
                            { header: 'Data', dataKey: 'data' },
                            { header: 'Previsto', dataKey: 'previsto' },
                            { header: 'Realizado', dataKey: 'realizado' },
                            { header: 'Restante', dataKey: 'restante' },
                            { header: 'Progresso', dataKey: 'progresso' }
                        ];
                        
                        titulo = 'Relatório Completo de Liberações';
                        nomeArquivo = `relatorio_liberacoes_${new Date().toISOString().split('T')[0]}.pdf`;
                        break;
                        
                    case 'metas':
                        dados = DB.metas.getAll().map(meta => {
                            const frente = DB.frentes.get(meta.frenteId);
                            const frenteNome = frente ? frente.nome : 'Frente não encontrada';
                            const tipoConfig = Utils.getTipoConfig(meta.tipo);
                            
                            const hoje = new Date().toISOString().split('T')[0];
                            const isAtiva = meta.dataInicio <= hoje && meta.dataFim >= hoje;
                            
                            return {
                                frente: frenteNome,
                                tipo: tipoConfig.texto,
                                periodo: meta.periodo.charAt(0).toUpperCase() + meta.periodo.slice(1),
                                valor: Utils.formatarToneladas(meta.valor),
                                dataInicio: Utils.formatarData(meta.dataInicio),
                                dataFim: Utils.formatarData(meta.dataFim),
                                status: isAtiva ? 'Ativa' : 'Inativa',
                                observacoes: meta.observacoes || '-'
                            };
                        });
                        
                        colunas = [
                            { header: 'Frente', dataKey: 'frente' },
                            { header: 'Tipo', dataKey: 'tipo' },
                            { header: 'Período', dataKey: 'periodo' },
                            { header: 'Meta (T)', dataKey: 'valor' },
                            { header: 'Data Início', dataKey: 'dataInicio' },
                            { header: 'Data Fim', dataKey: 'dataFim' },
                            { header: 'Status', dataKey: 'status' },
                            { header: 'Observações', dataKey: 'observacoes' }
                        ];
                        
                        titulo = 'Relatório Completo de Metas';
                        nomeArquivo = `relatorio_metas_${new Date().toISOString().split('T')[0]}.pdf`;
                        break;
                        
                    case 'colheita':
                        dados = DB.lancamentos.getAll().map(lanc => {
                            const frente = DB.frentes.get(lanc.frenteId);
                            const frenteNome = frente ? frente.nome : 'Frente não encontrada';
                            const tipoConfig = frente ? Utils.getTipoConfig(frente.tipo) : Utils.getTipoConfig('desconhecido');
                            
                            return {
                                data: Utils.formatarData(lanc.data),
                                frente: frenteNome,
                                tipo: tipoConfig.texto,
                                colhido: Utils.formatarToneladas(lanc.colhido),
                                turno: lanc.turno.charAt(0).toUpperCase() + lanc.turno.slice(1),
                                operador: lanc.operador || '-',
                                observacoes: lanc.observacoes || '-'
                            };
                        });
                        
                        colunas = [
                            { header: 'Data', dataKey: 'data' },
                            { header: 'Frente', dataKey: 'frente' },
                            { header: 'Tipo', dataKey: 'tipo' },
                            { header: 'Colhido (T)', dataKey: 'colhido' },
                            { header: 'Turno', dataKey: 'turno' },
                            { header: 'Operador', dataKey: 'operador' },
                            { header: 'Observações', dataKey: 'observacoes' }
                        ];
                        
                        titulo = 'Relatório Completo de Colheita';
                        nomeArquivo = `relatorio_colheita_${new Date().toISOString().split('T')[0]}.pdf`;
                        break;
                }
                
                if (dados.length === 0) {
                    Toast.show('Nenhum dado encontrado para gerar o relatório', 'warning');
                    return;
                }
                
                Utils.exportarPDF(titulo, dados, colunas, nomeArquivo);
            } catch (error) {
                Toast.show('Erro ao gerar relatório: ' + error.message, 'error');
            } finally {
                Utils.showLoading(false);
            }
        }, 500);
    } catch (error) {
        Utils.showLoading(false);
        Toast.show('Erro ao preparar relatório: ' + error.message, 'error');
    }
}

// ===== EVENTOS GLOBAIS =====

// Fechar modais com ESC
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        // Fechar modal de notificações
        const modalNotifications = document.getElementById('modal-notifications');
        if (modalNotifications && !modalNotifications.classList.contains('hidden')) {
            modalNotifications.classList.add('hidden');
        }
        
        // Fechar modal de limpeza
        const modalLimpeza = document.getElementById('modal-limpar-dados');
        if (modalLimpeza && !modalLimpeza.classList.contains('hidden')) {
            fecharModalLimpeza();
        }
        
        // Fechar menu lateral no mobile
        const appContainer = document.getElementById('app-container');
        if (appContainer && appContainer.classList.contains('sidebar-open')) {
            appContainer.classList.remove('sidebar-open');
        }
    }
});

// Atualizar gráficos quando o tema mudar
document.addEventListener('DOMContentLoaded', function() {
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                if (mutation.target === document.documentElement) {
                    setTimeout(() => {
                        ChartManager.updateCharts();
                    }, 100);
                }
            }
        });
    });
    
    observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
    });
});

// Salvar configurações de paginação
window.addEventListener('beforeunload', function() {
    const config = JSON.parse(localStorage.getItem('ggomes_config') || '{}');
    config.preferences = config.preferences || {};
    config.preferences.currentPage = currentLiberacoesPage;
    config.preferences.sortConfig = currentLiberacoesSort;
    localStorage.setItem('ggomes_config', JSON.stringify(config));
});

// Detectar mudanças na conexão (se aplicável)
window.addEventListener('online', function() {
    Toast.show('Conexão restaurada', 'success', 3000);
});

window.addEventListener('offline', function() {
    Toast.show('Sem conexão - modo offline', 'warning', 5000);
});

// Evitar perda de dados não salvos
window.addEventListener('beforeunload', function(event) {
    const formsEditando = document.querySelectorAll('form[data-editing]');
    if (formsEditando.length > 0) {
        const message = 'Você tem alterações não salvas. Deseja realmente sair?';
        event.returnValue = message;
        return message;
    }
});

// Performance: Lazy loading de componentes pesados
let dashboardLoaded = false;
const originalAtualizarDashboard = atualizarDashboard;
atualizarDashboard = function() {
    if (!dashboardLoaded) {
        dashboardLoaded = true;
        setTimeout(() => {
            originalAtualizarDashboard();
        }, 100);
    } else {
        originalAtualizarDashboard();
    }
};

console.log('GGOMES-LOG v2.1 - Sistema de Gestão Agrícola iniciado com sucesso!');
console.log('Desenvolvido com ❤️ pela GGOMES Technologies');
console.log('Novidades da v2.1: Tipo "Desconhecido" adicionado às frentes');

</script>
</body>
</html>
